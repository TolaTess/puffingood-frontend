import{r as e,c as t,j as n,a as r,u as i,b as s,d as o,B as a,D as c,L as l,e as u,f as h,g as d,h as f,A as p,C as m,T as g,I as y,i as v,k as w,l as b,M as _,m as x,n as E,o as I,O as T,p as S,q as C,s as A,G as k,t as j,v as D,w as N,x as P,S as R,y as O,z as L,E as M,F,H as U,J as V,K as B,N as z,Q as q,U as $,V as W,W as G,X as K,Y as H,Z as Q,_ as Y,$ as X,a0 as J,a1 as Z,a2 as ee,a3 as te,a4 as ne,a5 as re,a6 as ie,a7 as se,a8 as oe,a9 as ae,aa as ce,ab as le,ac as ue,ad as he,ae as de,af as fe,ag as pe,ah as me,R as ge}from"./vendor-CXPPTlNK.js";import{l as ye,E as ve,u as we,a as be,P as _e}from"./stripe-s1iVwX5W.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var xe={},Ee=e;xe.createRoot=Ee.createRoot,xe.hydrateRoot=Ee.hydrateRoot;const Ie=t(n.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),Te=t(n.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),Se=t(n.jsx("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),Ce=t(n.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Ae=t(n.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),ke=t(n.jsx("path",{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"ExitToApp"),je=t(n.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),De=t(n.jsx("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),Ne=t(n.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),Pe=t(n.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove"),Re=t(n.jsx("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4"}),"Restaurant"),Oe=t(n.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),Le=t(n.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),Me=t(n.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");var Fe={exports:{}},Ue={},Ve=r;var Be="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ze=Ve.useSyncExternalStore,qe=Ve.useRef,$e=Ve.useEffect,We=Ve.useMemo,Ge=Ve.useDebugValue;Ue.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var s=qe(null);if(null===s.current){var o={hasValue:!1,value:null};s.current=o}else o=s.current;s=We((function(){function e(e){if(!c){if(c=!0,s=e,e=r(e),void 0!==i&&o.hasValue){var t=o.value;if(i(t,e))return a=t}return a=e}if(t=a,Be(s,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(s=e,t):(s=e,a=n)}var s,a,c=!1,l=void 0===n?null:n;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]}),[t,n,r,i]);var a=ze(e,s[0],s[1]);return $e((function(){o.hasValue=!0,o.value=a}),[a]),Ge(a),a},Fe.exports=Ue;var Ke=Fe.exports;var He={notify(){},get:()=>[]};var Qe=(()=>!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement))(),Ye=(()=>"undefined"!=typeof navigator&&"ReactNative"===navigator.product)(),Xe=(()=>Qe||Ye?r.useLayoutEffect:r.useEffect)(),Je=Symbol.for("react-redux-context"),Ze="undefined"!=typeof globalThis?globalThis:{};function et(){if(!r.createContext)return{};const e=Ze[Je]??(Ze[Je]=new Map);let t=e.get(r.createContext);return t||(t=r.createContext(null),e.set(r.createContext,t)),t}var tt=et();var nt=function(e){const{children:t,context:n,serverState:i,store:s}=e,o=r.useMemo((()=>{const e=function(e){let t,n=He,r=0,i=!1;function s(){c.onStateChange&&c.onStateChange()}function o(){r++,t||(t=e.subscribe(s),n=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){(()=>{let t=e;for(;t;)t.callback(),t=t.next})()},get(){const t=[];let n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let r=!0;const i=t={callback:n,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){r&&null!==e&&(r=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function a(){r--,t&&0===r&&(t(),t=void 0,n.clear(),n=He)}const c={addNestedSub:function(e){o();const t=n.subscribe(e);let r=!1;return()=>{r||(r=!0,t(),a())}},notifyNestedSubs:function(){n.notify()},handleChangeWrapper:s,isSubscribed:function(){return i},trySubscribe:function(){i||(i=!0,o())},tryUnsubscribe:function(){i&&(i=!1,a())},getListeners:()=>n};return c}(s);return{store:s,subscription:e,getServerState:i?()=>i:void 0}}),[s,i]),a=r.useMemo((()=>s.getState()),[s]);Xe((()=>{const{subscription:e}=o;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),a!==s.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}}),[o,a]);const c=n||tt;return r.createElement(c.Provider,{value:o},t)};function rt(e=tt){return function(){return r.useContext(e)}}var it=rt();function st(e=tt){const t=e===tt?it:rt(e),n=()=>{const{store:e}=t();return e};return Object.assign(n,{withTypes:()=>n}),n}var ot=st();function at(e=tt){const t=e===tt?ot:st(e),n=()=>t().dispatch;return Object.assign(n,{withTypes:()=>n}),n}var ct=at(),lt=(e,t)=>e===t;function ut(e=tt){const t=e===tt?it:rt(e),n=(e,n={})=>{const{equalityFn:i=lt}="function"==typeof n?{equalityFn:n}:n,s=t(),{store:o,subscription:a,getServerState:c}=s;r.useRef(!0);const l=r.useCallback({[e.name]:t=>e(t)}[e.name],[e]),u=Ke.useSyncExternalStoreWithSelector(a.addNestedSub,o.getState,c||o.getState,l,i);return r.useDebugValue(u),u};return Object.assign(n,{withTypes:()=>n}),n}var ht=ut();function dt(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var ft=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),pt=()=>Math.random().toString(36).substring(7).split("").join("."),mt={INIT:`@@redux/INIT${pt()}`,REPLACE:`@@redux/REPLACE${pt()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${pt()}`};function gt(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function yt(e,t,n){if("function"!=typeof e)throw new Error(dt(2));if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(dt(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(dt(1));return n(yt)(e,t)}let r=e,i=t,s=new Map,o=s,a=0,c=!1;function l(){o===s&&(o=new Map,s.forEach(((e,t)=>{o.set(t,e)})))}function u(){if(c)throw new Error(dt(3));return i}function h(e){if("function"!=typeof e)throw new Error(dt(4));if(c)throw new Error(dt(5));let t=!0;l();const n=a++;return o.set(n,e),function(){if(t){if(c)throw new Error(dt(6));t=!1,l(),o.delete(n),s=null}}}function d(e){if(!gt(e))throw new Error(dt(7));if(void 0===e.type)throw new Error(dt(8));if("string"!=typeof e.type)throw new Error(dt(17));if(c)throw new Error(dt(9));try{c=!0,i=r(i,e)}finally{c=!1}return(s=o).forEach((e=>{e()})),e}d({type:mt.INIT});return{dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(dt(10));r=e,d({type:mt.REPLACE})},[ft]:function(){const e=h;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error(dt(11));function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[ft](){return this}}}}}function vt(e){const t=Object.keys(e),n={};for(let o=0;o<t.length;o++){const r=t[o];"function"==typeof e[r]&&(n[r]=e[r])}const r=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:mt.INIT}))throw new Error(dt(12));if(void 0===n(void 0,{type:mt.PROBE_UNKNOWN_ACTION()}))throw new Error(dt(13))}))}(n)}catch(s){i=s}return function(e={},t){if(i)throw i;let s=!1;const o={};for(let i=0;i<r.length;i++){const a=r[i],c=n[a],l=e[a],u=c(l,t);if(void 0===u)throw t&&t.type,new Error(dt(14));o[a]=u,s=s||u!==l}return s=s||r.length!==Object.keys(e).length,s?o:e}}function wt(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}var bt=Symbol.for("immer-nothing"),_t=Symbol.for("immer-draftable"),xt=Symbol.for("immer-state");function Et(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var It=Object.getPrototypeOf;function Tt(e){return!!e&&!!e[xt]}function St(e){var t;return!!e&&(At(e)||Array.isArray(e)||!!e[_t]||!!(null==(t=e.constructor)?void 0:t[_t])||Pt(e)||Rt(e))}var Ct=Object.prototype.constructor.toString();function At(e){if(!e||"object"!=typeof e)return!1;const t=It(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Ct}function kt(e,t){0===jt(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,r)=>t(r,n,e)))}function jt(e){const t=e[xt];return t?t.type_:Array.isArray(e)?1:Pt(e)?2:Rt(e)?3:0}function Dt(e,t){return 2===jt(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Nt(e,t,n){const r=jt(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function Pt(e){return e instanceof Map}function Rt(e){return e instanceof Set}function Ot(e){return e.copy_||e.base_}function Lt(e,t){if(Pt(e))return new Map(e);if(Rt(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=At(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[xt];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],s=t[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[i]})}return Object.create(It(e),t)}{const t=It(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function Mt(e,t=!1){return Ut(e)||Tt(e)||!St(e)||(jt(e)>1&&(e.set=e.add=e.clear=e.delete=Ft),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>Mt(t,!0)))),e}function Ft(){Et(2)}function Ut(e){return Object.isFrozen(e)}var Vt,Bt={};function zt(e){const t=Bt[e];return t||Et(0),t}function qt(){return Vt}function $t(e,t){t&&(zt("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Wt(e){Gt(e),e.drafts_.forEach(Ht),e.drafts_=null}function Gt(e){e===Vt&&(Vt=e.parent_)}function Kt(e){return Vt={drafts_:[],parent_:Vt,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Ht(e){const t=e[xt];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Qt(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[xt].modified_&&(Wt(t),Et(4)),St(e)&&(e=Yt(t,e),t.parent_||Jt(t,e)),t.patches_&&zt("Patches").generateReplacementPatches_(n[xt].base_,e,t.patches_,t.inversePatches_)):e=Yt(t,n,[]),Wt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==bt?e:void 0}function Yt(e,t,n){if(Ut(t))return t;const r=t[xt];if(!r)return kt(t,((i,s)=>Xt(e,r,t,i,s,n))),t;if(r.scope_!==e)return t;if(!r.modified_)return Jt(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,s=!1;3===r.type_&&(i=new Set(t),t.clear(),s=!0),kt(i,((i,o)=>Xt(e,r,t,i,o,n,s))),Jt(e,t,!1),n&&e.patches_&&zt("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function Xt(e,t,n,r,i,s,o){if(Tt(i)){const o=Yt(e,i,s&&t&&3!==t.type_&&!Dt(t.assigned_,r)?s.concat(r):void 0);if(Nt(n,r,o),!Tt(o))return;e.canAutoFreeze_=!1}else o&&n.add(i);if(St(i)&&!Ut(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Yt(e,i),t&&t.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||Jt(e,i)}}function Jt(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Mt(t,n)}var Zt={get(e,t){if(t===xt)return e;const n=Ot(e);if(!Dt(n,t))return function(e,t,n){var r;const i=nn(t,n);return i?"value"in i?i.value:null==(r=i.get)?void 0:r.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!St(r)?r:r===tn(e.base_,t)?(sn(e),e.copy_[t]=on(r,e)):r},has:(e,t)=>t in Ot(e),ownKeys:e=>Reflect.ownKeys(Ot(e)),set(e,t,n){const r=nn(Ot(e),t);if(null==r?void 0:r.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=tn(Ot(e),t),o=null==r?void 0:r[xt];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((i=n)===(s=r)?0!==i||1/i==1/s:i!=i&&s!=s)&&(void 0!==n||Dt(e.base_,t)))return!0;sn(e),rn(e)}var i,s;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==tn(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,sn(e),rn(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=Ot(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){Et(11)},getPrototypeOf:e=>It(e.base_),setPrototypeOf(){Et(12)}},en={};function tn(e,t){const n=e[xt];return(n?Ot(n):e)[t]}function nn(e,t){if(!(t in e))return;let n=It(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=It(n)}}function rn(e){e.modified_||(e.modified_=!0,e.parent_&&rn(e.parent_))}function sn(e){e.copy_||(e.copy_=Lt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}kt(Zt,((e,t)=>{en[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),en.deleteProperty=function(e,t){return en.set.call(this,e,t,void 0)},en.set=function(e,t,n){return Zt.set.call(this,e[0],t,n,e[0])};function on(e,t){const n=Pt(e)?zt("MapSet").proxyMap_(e,t):Rt(e)?zt("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:qt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,s=Zt;n&&(i=[r],s=en);const{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}(e,t);return(t?t.scope_:qt()).drafts_.push(n),n}function an(e){if(!St(e)||Ut(e))return e;const t=e[xt];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=Lt(e,t.scope_.immer_.useStrictShallowCopy_)}else n=Lt(e,!0);return kt(n,((e,t)=>{Nt(n,e,an(t))})),t&&(t.finalized_=!1),n}var cn=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const r=this;return function(e=n,...i){return r.produce(e,(e=>t.call(this,e,...i)))}}let r;if("function"!=typeof t&&Et(6),void 0!==n&&"function"!=typeof n&&Et(7),St(e)){const i=Kt(this),s=on(e,void 0);let o=!0;try{r=t(s),o=!1}finally{o?Wt(i):Gt(i)}return $t(i,n),Qt(r,i)}if(!e||"object"!=typeof e){if(r=t(e),void 0===r&&(r=e),r===bt&&(r=void 0),this.autoFreeze_&&Mt(r,!0),n){const t=[],i=[];zt("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}Et(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,r;return[this.produce(e,t,((e,t)=>{n=e,r=t})),n,r]},"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof(null==e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){St(e)||Et(8),Tt(e)&&(e=function(e){Tt(e)||Et(10);return an(e)}(e));const t=Kt(this),n=on(e,void 0);return n[xt].isManual_=!0,Gt(t),n}finishDraft(e,t){const n=e&&e[xt];n&&n.isManual_||Et(9);const{scope_:r}=n;return $t(r,t),Qt(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=zt("Patches").applyPatches_;return Tt(e)?r(e,t):this.produce(e,(e=>r(e,t)))}},ln=cn.produce;function un(e){return({dispatch:t,getState:n})=>r=>i=>"function"==typeof i?i(t,n,e):r(i)}cn.produceWithPatches.bind(cn),cn.setAutoFreeze.bind(cn),cn.setUseStrictShallowCopy.bind(cn),cn.applyPatches.bind(cn),cn.createDraft.bind(cn),cn.finishDraft.bind(cn);var hn=un(),dn=un,fn="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?wt:wt.apply(null,arguments)};function pn(e,t){function n(...n){if(t){let r=t(...n);if(!r)throw new Error(Cn(0));return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:n[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>function(e){return gt(e)&&"type"in e&&"string"==typeof e.type}(t)&&t.type===e,n}var mn=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function gn(e){return St(e)?ln(e,(()=>{})):e}function yn(e,t,n){return e.has(t)?e.get(t):e.set(t,n(t)).get(t)}var vn=e=>t=>{setTimeout(t,e)},wn=e=>function(t){const{autoBatch:n=!0}=t??{};let r=new mn(e);return n&&r.push(((e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let i=!0,s=!1,o=!1;const a=new Set,c="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:vn(10):"callback"===e.type?e.queueNotification:vn(e.timeout),l=()=>{o=!1,s&&(s=!1,a.forEach((e=>e())))};return Object.assign({},r,{subscribe(e){const t=r.subscribe((()=>i&&e()));return a.add(e),()=>{t(),a.delete(e)}},dispatch(e){var t;try{return i=!(null==(t=null==e?void 0:e.meta)?void 0:t.RTK_autoBatch),s=!i,s&&(o||(o=!0,c(l))),r.dispatch(e)}finally{i=!0}}})})("object"==typeof n?n:void 0)),r};function bn(e){const t={},n=[];let r;const i={addCase(e,n){const r="string"==typeof e?e:e.type;if(!r)throw new Error(Cn(28));if(r in t)throw new Error(Cn(29));return t[r]=n,i},addMatcher:(e,t)=>(n.push({matcher:e,reducer:t}),i),addDefaultCase:e=>(r=e,i)};return e(i),[t,n,r]}var _n=Symbol.for("rtk-slice-createasyncthunk");function xn(e,t){return`${e}/${t}`}function En({creators:e}={}){var t;const n=null==(t=null==e?void 0:e.asyncThunk)?void 0:t[_n];return function(e){const{name:t,reducerPath:r=t}=e;if(!t)throw new Error(Cn(11));const i=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},s=Object.keys(i),o={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},a={addCase(e,t){const n="string"==typeof e?e:e.type;if(!n)throw new Error(Cn(12));if(n in o.sliceCaseReducersByType)throw new Error(Cn(13));return o.sliceCaseReducersByType[n]=t,a},addMatcher:(e,t)=>(o.sliceMatchers.push({matcher:e,reducer:t}),a),exposeAction:(e,t)=>(o.actionCreators[e]=t,a),exposeCaseReducer:(e,t)=>(o.sliceCaseReducersByName[e]=t,a)};function c(){const[t={},n=[],r]="function"==typeof e.extraReducers?bn(e.extraReducers):[e.extraReducers],i={...t,...o.sliceCaseReducersByType};return function(e,t){let n,[r,i,s]=bn(t);if("function"==typeof e)n=()=>gn(e());else{const t=gn(e);n=()=>t}function o(e=n(),t){let o=[r[t.type],...i.filter((({matcher:e})=>e(t))).map((({reducer:e})=>e))];return 0===o.filter((e=>!!e)).length&&(o=[s]),o.reduce(((e,n)=>{if(n){if(Tt(e)){const r=n(e,t);return void 0===r?e:r}if(St(e))return ln(e,(e=>n(e,t)));{const r=n(e,t);if(void 0===r){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return r}}return e}),e)}return o.getInitialState=n,o}(e.initialState,(e=>{for(let t in i)e.addCase(t,i[t]);for(let t of o.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)}))}s.forEach((r=>{const s=i[r],o={reducerName:r,type:xn(t,r),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(s)?function({type:e,reducerName:t,createNotation:n},r,i){let s,o;if("reducer"in r){if(n&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(r))throw new Error(Cn(17));s=r.reducer,o=r.prepare}else s=r;i.addCase(e,s).exposeCaseReducer(t,s).exposeAction(t,o?pn(e,o):pn(e))}(o,s,a):function({type:e,reducerName:t},n,r,i){if(!i)throw new Error(Cn(18));const{payloadCreator:s,fulfilled:o,pending:a,rejected:c,settled:l,options:u}=n,h=i(e,s,u);r.exposeAction(t,h),o&&r.addCase(h.fulfilled,o);a&&r.addCase(h.pending,a);c&&r.addCase(h.rejected,c);l&&r.addMatcher(h.settled,l);r.exposeCaseReducer(t,{fulfilled:o||Sn,pending:a||Sn,rejected:c||Sn,settled:l||Sn})}(o,s,a,n)}));const l=e=>e,u=new Map;let h;function d(e,t){return h||(h=c()),h(e,t)}function f(){return h||(h=c()),h.getInitialState()}function p(t,n=!1){function r(e){let r=e[t];return void 0===r&&n&&(r=f()),r}function i(t=l){const r=yn(u,n,(()=>new WeakMap));return yn(r,t,(()=>{const r={};for(const[i,s]of Object.entries(e.selectors??{}))r[i]=In(s,t,f,n);return r}))}return{reducerPath:t,getSelectors:i,get selectors(){return i(r)},selectSlice:r}}const m={name:t,reducer:d,actions:o.actionCreators,caseReducers:o.sliceCaseReducersByName,getInitialState:f,...p(r),injectInto(e,{reducerPath:t,...n}={}){const i=t??r;return e.inject({reducerPath:i,reducer:d},n),{...m,...p(i,!0)}}};return m}}function In(e,t,n,r){function i(i,...s){let o=t(i);return void 0===o&&r&&(o=n()),e(o,...s)}return i.unwrapped=e,i}var Tn=En();function Sn(){}function Cn(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}const An=Tn({name:"auth",initialState:{user:null,loading:!1,error:null},reducers:{loginStart:e=>{e.loading=!0,e.error=null},loginSuccess:(e,t)=>{e.loading=!1,e.user=t.payload,e.error=null},loginFailure:(e,t)=>{e.loading=!1,e.error=t.payload},logout:e=>{e.user=null,e.error=null}}}),{loginStart:kn,loginSuccess:jn,loginFailure:Dn,logout:Nn}=An.actions,Pn=An.reducer,Rn="/puffingood-frontend/assets/logo_black2-FTFsv2NL.png",On=()=>{const e=i(),t=s(e.breakpoints.down("md")),S=o(),C=ct(),{user:A}=ht((e=>e.auth)),{items:k}=ht((e=>e.cart)),[j,D]=r.useState(null),[N,P]=r.useState(null),[R,O]=r.useState(!1),L=()=>{P(null)},M=()=>{C(Nn()),L(),S("/")},F=()=>{O(!R)},U=n.jsxs(a,{onClick:F,sx:{textAlign:"center"},children:[n.jsx(a,{sx:{my:2,display:"flex",justifyContent:"center"},children:n.jsx("img",{src:Rn,alt:"PuffinGood Logo",style:{height:"40px"}})}),n.jsx(c,{}),n.jsxs(l,{children:[n.jsxs(u,{button:!0,component:h,to:"/",children:[n.jsx(d,{children:n.jsx(Re,{})}),n.jsx(f,{primary:"Menu"})]}),n.jsxs(u,{button:!0,component:h,to:"/cart",children:[n.jsx(d,{children:n.jsx(Oe,{})}),n.jsx(f,{primary:"Cart"})]}),A?n.jsxs(n.Fragment,{children:[n.jsxs(u,{button:!0,component:h,to:"/orders",children:[n.jsx(d,{children:n.jsx(Ne,{})}),n.jsx(f,{primary:"Orders"})]}),A.isAdmin&&n.jsxs(u,{button:!0,component:h,to:"/admin/dashboard",children:[n.jsx(d,{children:n.jsx(Se,{})}),n.jsx(f,{primary:"Admin Dashboard"})]}),n.jsxs(u,{button:!0,onClick:M,children:[n.jsx(d,{children:n.jsx(ke,{})}),n.jsx(f,{primary:"Logout"})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs(u,{button:!0,component:h,to:"/login",children:[n.jsx(d,{children:n.jsx(Ne,{})}),n.jsx(f,{primary:"Login"})]}),n.jsxs(u,{button:!0,component:h,to:"/register",children:[n.jsx(d,{children:n.jsx(Ne,{})}),n.jsx(f,{primary:"Register"})]})]})]})]});return n.jsxs(a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[n.jsx(p,{position:"static",children:n.jsx(m,{maxWidth:"xl",children:n.jsxs(g,{disableGutters:!0,children:[t&&n.jsx(y,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:F,sx:{mr:2},children:n.jsx(De,{})}),n.jsx(a,{component:h,to:"/",sx:{mr:2,display:{xs:"none",md:"flex"},textDecoration:"none"},children:n.jsx("img",{src:Rn,alt:"PuffinGood Logo",style:{height:"40px"}})}),n.jsxs(a,{sx:{flexGrow:1,display:{xs:"none",md:"flex"}},children:[n.jsx(v,{component:h,to:"/menu",sx:{my:2,color:"white",display:"block"},children:"Menu"}),n.jsxs(v,{component:h,to:"/cart",sx:{my:2,color:"white",display:"block"},children:["Cart (",k.length,")"]})]}),n.jsx(a,{sx:{flexGrow:0},children:A?n.jsxs(n.Fragment,{children:[n.jsx(w,{title:"Open settings",children:n.jsx(y,{onClick:e=>{P(e.currentTarget)},sx:{p:0},children:n.jsx(b,{alt:A.name,src:"/static/images/avatar/2.jpg"})})}),n.jsxs(_,{sx:{mt:"45px"},id:"menu-appbar",anchorEl:N,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(N),onClose:L,children:[n.jsx(x,{component:h,to:"/profile",onClick:L,children:n.jsx(E,{textAlign:"center",children:"Profile"})}),n.jsx(x,{component:h,to:"/orders",onClick:L,children:n.jsx(E,{textAlign:"center",children:"Orders"})}),A.isAdmin&&n.jsx(x,{component:h,to:"/admin/dashboard",onClick:L,children:n.jsx(E,{textAlign:"center",children:"Admin Dashboard"})}),n.jsx(x,{onClick:M,children:n.jsx(E,{textAlign:"center",children:"Logout"})})]})]}):n.jsxs(a,{sx:{display:"flex",gap:1},children:[n.jsx(v,{component:h,to:"/login",sx:{color:"white"},children:"Login"}),n.jsx(v,{component:h,to:"/register",variant:"outlined",sx:{color:"white",borderColor:"white"},children:"Register"})]})})]})})}),n.jsx(I,{variant:"temporary",anchor:"left",open:R,onClose:F,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},children:U}),n.jsx(a,{component:"main",sx:{flexGrow:1,py:3},children:n.jsx(T,{})}),n.jsx(a,{component:"footer",sx:{py:3,px:2,mt:"auto",backgroundColor:e=>"light"===e.palette.mode?e.palette.grey[200]:e.palette.grey[800]},children:n.jsxs(m,{maxWidth:"sm",children:[n.jsxs(E,{variant:"body2",color:"text.secondary",align:"center",children:["© ",n.jsx(h,{to:"/",style:{color:"inherit",textDecoration:"none"},children:"PuffinGood"})," ",(new Date).getFullYear(),". All rights reserved."]}),n.jsx(E,{variant:"body2",color:"text.secondary",align:"center",children:n.jsx(h,{to:"/terms",style:{color:"inherit",textDecoration:"none"},children:"Terms and Conditions"})})]})})]})};var Ln={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Fn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,l=t>>2,u=(3&t)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[l],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Mn(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw new Un;const c=t<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Un extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Vn=function(e){return function(e){const t=Mn(e);return Fn.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Bn=function(e){try{return Fn.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const zn=()=>
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,qn=()=>{try{return zn()||(()=>{if("undefined"==typeof process)return;const e=Ln.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&Bn(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},$n=()=>{var e;return null===(e=qn())||void 0===e?void 0:e.config},Wn=e=>{var t;return null===(t=qn())||void 0===t?void 0:t[`_${e}`]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Gn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Hn(){return!function(){var e;const t=null===(e=qn())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(n){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class Qn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Qn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Yn.prototype.create)}}class Yn{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Xn,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new Qn(r,o,n)}}const Xn=/\{\$([^}]+)}/g;function Jn(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(Zn(n)&&Zn(s)){if(!Jn(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Zn(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function tr(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function nr(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class rr{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ir),void 0===r.error&&(r.error=ir),void 0===r.complete&&(r.complete=ir);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function ir(){}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sr(e){return e&&e._delegate?e._delegate:e}class or{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Gn;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:ar})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e=ar){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=ar){return this.instances.has(e)}getOptions(e=ar){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===ar?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(i){}var r;return n||null}normalizeInstanceIdentifier(e=ar){return this.component?this.component.multipleInstances?e:ar:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class lr{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new cr(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ur,hr;(hr=ur||(ur={}))[hr.DEBUG=0]="DEBUG",hr[hr.VERBOSE=1]="VERBOSE",hr[hr.INFO=2]="INFO",hr[hr.WARN=3]="WARN",hr[hr.ERROR=4]="ERROR",hr[hr.SILENT=5]="SILENT";const dr={debug:ur.DEBUG,verbose:ur.VERBOSE,info:ur.INFO,warn:ur.WARN,error:ur.ERROR,silent:ur.SILENT},fr=ur.INFO,pr={[ur.DEBUG]:"log",[ur.VERBOSE]:"log",[ur.INFO]:"info",[ur.WARN]:"warn",[ur.ERROR]:"error"},mr=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=pr[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class gr{constructor(e){this.name=e,this._logLevel=fr,this._logHandler=mr,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ur))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?dr[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ur.DEBUG,...e),this._logHandler(this,ur.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ur.VERBOSE,...e),this._logHandler(this,ur.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ur.INFO,...e),this._logHandler(this,ur.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ur.WARN,...e),this._logHandler(this,ur.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ur.ERROR,...e),this._logHandler(this,ur.ERROR,...e)}}let yr,vr;const wr=new WeakMap,br=new WeakMap,_r=new WeakMap,xr=new WeakMap,Er=new WeakMap;let Ir={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return br.get(e);if("objectStoreNames"===t)return e.objectStoreNames||_r.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Cr(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Tr(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(vr||(vr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Ar(this),t),Cr(wr.get(this))}:function(...t){return Cr(e.apply(Ar(this),t))}:function(t,...n){const r=e.call(Ar(this),t,...n);return _r.set(r,t.sort?t.sort():[t]),Cr(r)}}function Sr(e){return"function"==typeof e?Tr(e):(e instanceof IDBTransaction&&function(e){if(br.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));br.set(e,t)}(e),t=e,(yr||(yr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,Ir):e);var t}function Cr(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Cr(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&wr.set(t,e)})).catch((()=>{})),Er.set(t,e),t}(e);if(xr.has(e))return xr.get(e);const t=Sr(e);return t!==e&&(xr.set(e,t),Er.set(t,e)),t}const Ar=e=>Er.get(e);const kr=["get","getKey","getAll","getAllKeys","count"],jr=["put","add","delete","clear"],Dr=new Map;function Nr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Dr.get(t))return Dr.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=jr.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!kr.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return Dr.set(t,s),s}Ir=(e=>({...e,get:(t,n,r)=>Nr(t,n)||e.get(t,n,r),has:(t,n)=>!!Nr(t,n)||e.has(t,n)}))(Ir);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Pr{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Rr="@firebase/app",Or="0.10.13",Lr=new gr("@firebase/app"),Mr="@firebase/app-compat",Fr="@firebase/analytics-compat",Ur="@firebase/analytics",Vr="@firebase/app-check-compat",Br="@firebase/app-check",zr="@firebase/auth",qr="@firebase/auth-compat",$r="@firebase/database",Wr="@firebase/data-connect",Gr="@firebase/database-compat",Kr="@firebase/functions",Hr="@firebase/functions-compat",Qr="@firebase/installations",Yr="@firebase/installations-compat",Xr="@firebase/messaging",Jr="@firebase/messaging-compat",Zr="@firebase/performance",ei="@firebase/performance-compat",ti="@firebase/remote-config",ni="@firebase/remote-config-compat",ri="@firebase/storage",ii="@firebase/storage-compat",si="@firebase/firestore",oi="@firebase/vertexai-preview",ai="@firebase/firestore-compat",ci="firebase",li="[DEFAULT]",ui={[Rr]:"fire-core",[Mr]:"fire-core-compat",[Ur]:"fire-analytics",[Fr]:"fire-analytics-compat",[Br]:"fire-app-check",[Vr]:"fire-app-check-compat",[zr]:"fire-auth",[qr]:"fire-auth-compat",[$r]:"fire-rtdb",[Wr]:"fire-data-connect",[Gr]:"fire-rtdb-compat",[Kr]:"fire-fn",[Hr]:"fire-fn-compat",[Qr]:"fire-iid",[Yr]:"fire-iid-compat",[Xr]:"fire-fcm",[Jr]:"fire-fcm-compat",[Zr]:"fire-perf",[ei]:"fire-perf-compat",[ti]:"fire-rc",[ni]:"fire-rc-compat",[ri]:"fire-gcs",[ii]:"fire-gcs-compat",[si]:"fire-fst",[ai]:"fire-fst-compat",[oi]:"fire-vertex","fire-js":"fire-js",[ci]:"fire-js-all"},hi=new Map,di=new Map,fi=new Map;function pi(e,t){try{e.container.addComponent(t)}catch(n){Lr.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function mi(e){const t=e.name;if(fi.has(t))return Lr.debug(`There were multiple attempts to register component ${t}.`),!1;fi.set(t,e);for(const n of hi.values())pi(n,e);for(const n of di.values())pi(n,e);return!0}function gi(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function yi(e){return void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi=new Yn("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class wi{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new or("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vi.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bi="10.14.1";function _i(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:li,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw vi.create("bad-app-name",{appName:String(i)});if(n||(n=$n()),!n)throw vi.create("no-options");const s=hi.get(i);if(s){if(Jn(n,s.options)&&Jn(r,s.config))return s;throw vi.create("duplicate-app",{appName:i})}const o=new lr(i);for(const c of fi.values())o.addComponent(c);const a=new wi(n,r,o);return hi.set(i,a),a}function xi(e,t,n){var r;let i=null!==(r=ui[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Lr.warn(e.join(" "))}mi(new or(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ei="firebase-heartbeat-store";let Ii=null;function Ti(){return Ii||(Ii=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Cr(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Cr(o.result),e.oldVersion,e.newVersion,Cr(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ei)}catch(n){console.warn(n)}}}).catch((e=>{throw vi.create("idb-open",{originalErrorMessage:e.message})}))),Ii}async function Si(e,t){try{const n=(await Ti()).transaction(Ei,"readwrite"),r=n.objectStore(Ei);await r.put(t,Ci(e)),await n.done}catch(n){if(n instanceof Qn)Lr.warn(n.message);else{const e=vi.create("idb-set",{originalErrorMessage:null==n?void 0:n.message});Lr.warn(e.message)}}}function Ci(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ji(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ki();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(n){Lr.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ki(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Di(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Di(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=Vn(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Lr.warn(t),""}}}function ki(){return(new Date).toISOString().substring(0,10)}class ji{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ti()).transaction(Ei),n=await t.objectStore(Ei).get(Ci(e));return await t.done,n}catch(t){if(t instanceof Qn)Lr.warn(t.message);else{const e=vi.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Lr.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Si(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Si(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Di(e){return Vn(JSON.stringify({version:2,heartbeats:e})).length}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ni;Ni="",mi(new or("platform-logger",(e=>new Pr(e)),"PRIVATE")),mi(new or("heartbeat",(e=>new Ai(e)),"PRIVATE")),xi(Rr,Or,Ni),xi(Rr,Or,"esm2017"),xi("fire-js","");var Pi,Ri,Oi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var e;
/** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function s(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new r([0|e],0>e?-1:0)})):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var a=s(0),c=s(1),l=s(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(a,a);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!u(r);){var l=s.add(r);0>=l.l(e)&&(i=i.add(n),s=l),r=v(r,1),n=v(n,1)}return t=f(e,i.j(t)),new m(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),l=(s=o(n)).j(t);h(l)||0<l.l(e);)l=(s=o(n-=r)).j(t);u(s)&&(s=c),i=i.add(s),e=f(e,l)}return new m(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],o=0;o<i;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,s=((0<(n=f(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var o=i+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(l)&&0>e.l(l))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),m=e.i(s)>>>16,g=65535&e.i(s);n[2*i+2*s]+=f*g,p(n,2*i+2*s),n[2*i+2*s+1]+=c*g,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*m,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*m,p(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Ri=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<t.length;s+=8){var c=Math.min(8,t.length-s),l=parseInt(t.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(l))):i=(i=i.j(r)).add(o(l))}return i},Pi=r}).apply(void 0!==Oi?Oi:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Li,Mi,Fi,Ui,Vi,Bi,zi,qi,$i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof $i&&$i];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));
/** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */
var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(s(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function w(e){const t={};for(const n in e)t[n]=e[n];return t}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<b.length;t++)n=b[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function x(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function E(e){i.setTimeout((()=>{throw e}),0)}function I(){var e=k;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var T=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new S),(e=>e.reset()));class S{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,k=new class{constructor(){this.h=this.g=null}add(e,t){const n=T.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},j=()=>{const e=i.Promise.resolve(void 0);C=()=>{e.then(D)}};var D=()=>{for(var e;e=I();){try{e.h.call(e.g)}catch(n){E(n)}var t=T;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}A=!1};function N(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function O(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:L[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&O.aa.h.call(this)}}h(O,P);var L={2:"touch",3:"pen",4:"mouse"};O.prototype.h=function(){O.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),F=0;function U(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function z(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(V(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function q(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}B.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=q(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new U(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var $="closure_lm_"+(1e6*Math.random()|0),W={};function G(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)G(e,t[s],n,r,i);return null}return n=Z(n),e&&e[M]?e.K(t,n,!!o(r)&&!!r.capture,i):function(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=X(e);if(c||(e[$]=c=new B(e)),n=c.add(t,n,r,a,s),n.proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=Y;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}(e,t,n,!1,r,i)}function K(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)K(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=Z(n),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=q(s=e.g[t],n,r,i))&&(V(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=X(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,n,r,i)),(n=-1<e?t[e]:null)&&H(n))}function H(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])z(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Q(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=X(t))?(z(n,e),0==n.h&&(n.src=null,t[$]=null)):V(e)}}}function Q(e){return e in W?W[e]:W[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new O(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&H(e),e=n.call(r,t)}return e}function X(e){return(e=e[$])instanceof B?e:null}var J="__closure_events_fn_"+(1e9*Math.random()>>>0);function Z(e){return"function"==typeof e?e:(e[J]||(e[J]=function(t){return e.handleEvent(t)}),e[J])}function ee(){N.call(this),this.i=new B(this),this.M=this,this.F=null}function te(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;_(t=new P(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=ne(o,r,!0,t)&&i}if(i=ne(o=t.g=e,r,!0,t)&&i,i=ne(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=ne(o=t.g=n[s],r,!1,t)&&i}function ne(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&z(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function re(e,t,n){if("function"==typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ie(e){e.g=re((()=>{e.g=null,e.i&&(e.i=!1,ie(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ee,N),ee.prototype[M]=!0,ee.prototype.removeEventListener=function(e,t,n,r){K(this,e,t,n,r)},ee.prototype.N=function(){if(ee.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)V(n[r]);delete t.g[e],t.h--}}this.F=null},ee.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ee.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class se extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ie(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(e){N.call(this),this.h=e,this.g={}}h(oe,N);var ae=[];function ce(e){v(e.g,(function(e,t){this.g.hasOwnProperty(t)&&H(e)}),e),e.g={}}oe.prototype.N=function(){oe.aa.N.call(this),ce(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var le=i.JSON.stringify,ue=i.JSON.parse,he=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function de(){}function fe(e){return e.h||(e.h=e.i())}function pe(){}de.prototype.h=null;var me={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ge(){P.call(this,"d")}function ye(){P.call(this,"c")}h(ge,P),h(ye,P);var ve={},we=null;function be(){return we=we||new ee}function _e(e){P.call(this,ve.La,e)}function xe(e){const t=be();te(t,new _e(t))}function Ee(e,t){P.call(this,ve.STAT_EVENT,e),this.stat=t}function Ie(e){const t=be();te(t,new Ee(t,e))}function Te(e,t){P.call(this,ve.Ma,e),this.size=t}function Se(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ce(){this.g=!0}function Ae(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return le(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}ve.La="serverreachability",h(_e,P),ve.STAT_EVENT="statevent",h(Ee,P),ve.Ma="timingevent",h(Te,P),Ce.prototype.xa=function(){this.g=!1},Ce.prototype.info=function(){};var ke,je={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},De={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ne(){}function Pe(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new oe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}h(Ne,de),Ne.prototype.g=function(){return new XMLHttpRequest},Ne.prototype.i=function(){return{}},ke=new Ne;var Oe={},Le={};function Me(e,t,n){e.L=1,e.v=lt(it(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),Be(e),e.A=it(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),xt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Re,e.g=un(e.j,n?t:null,!e.m),0<e.O&&(e.M=new se(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ae[0]=i.toString()),i=ae);for(var s=0;s<i.length;s++){var o=G(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),xe(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ue(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ve(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Le:(n=Number(t.substring(n,r)),isNaN(n)?Oe:(r+=1)+n>t.length?Le:(t=t.slice(r,r+n),e.C=r+n,t))}function Be(e){e.S=Date.now()+e.I,ze(e,e.I)}function ze(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Se(l(e.ba,e),t)}function qe(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function $e(e){0==e.j.G||e.J||sn(e.j,e)}function We(e){qe(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ce(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Xe(n.h,e)))if(!e.K&&Xe(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;rn(n),Kt(n)}en(n),Ie(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Se(l(n.Za,n),6e3));if(1>=Ye(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else an(n,11)}else if((e.K||n.g==e)&&rn(n),!p(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=l[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Je(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ct(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=ln(r,r.J?r.ia:null,r.W),o.K){Ze(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(qe(a),Be(a)),r.g=o}else Zt(r);0<n.i.length&&Qt(n)}else"stop"!=l[0]&&"close"!=l[0]||an(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?an(n,7):Gt(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}xe()}catch(u){}}Pe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==zt(e)?t.j():this.Y(e)},Pe.prototype.Y=function(e){try{if(e==this.g)e:{const d=zt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||qt(this.g)))){this.J||4!=d||7==t||xe(),qe(this);var n=this.g.Z();this.X=n;t:if(Ue(this)){var r=qt(this.g);e="";var s=r.length,o=4==zt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){We(this),$e(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var u=c;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Ie(12),We(this),$e(this);break e}Ae(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=Ve(this,a),e==Le){4==d&&(this.s=4,Ie(14),n=!1),Ae(this.i,this.l,null,"[Incomplete Response]");break}if(e==Oe){this.s=4,Ie(15),Ae(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ae(this.i,this.l,e,null),Ge(this,e)}if(Ue(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ie(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tn(h),h.M=!0,Ie(11))}}else Ae(this.i,this.l,a,"[Invalid Chunked Response]"),We(this),$e(this)}else Ae(this.i,this.l,a,null),Ge(this,a);4==d&&We(this),this.o&&!this.J&&(4==d?sn(this.j,this):(this.o=!1,Be(this)))}else(function(e){const t={};e=(e.g&&2<=zt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=x(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ie(12)):(this.s=0,Ie(13)),We(this),$e(this)}}}catch(d){}},Pe.prototype.cancel=function(){this.J=!0,We(this)},Pe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(xe(),Ie(17)),We(this),this.s=2,$e(this)):ze(this,this.S-e)};var Ke=class{constructor(e,t){this.g=e,this.map=t}};function He(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ye(e){return e.h?1:e.g?e.g.size:0}function Xe(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Je(e,t){e.g?e.g.add(t):e.h=t}function Ze(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function et(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}He.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof rt){this.h=e.h,st(this,e.j),this.o=e.o,this.g=e.g,ot(this,e.s),this.l=e.l;var t=e.i,n=new vt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),at(this,n),this.m=e.m}else e&&(t=String(e).match(nt))?(this.h=!1,st(this,t[1]||"",!0),this.o=ut(t[2]||""),this.g=ut(t[3]||"",!0),ot(this,t[4]),this.l=ut(t[5]||"",!0),at(this,t[6]||"",!0),this.m=ut(t[7]||"")):(this.h=!1,this.i=new vt(null,this.h))}function it(e){return new rt(e)}function st(e,t,n){e.j=n?ut(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function at(e,t,n){t instanceof vt?(e.i=t,function(e,t){t&&!e.j&&(wt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(bt(this,t),xt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=ht(t,gt)),e.i=new vt(t,e.h))}function ct(e,t,n){e.i.set(t,n)}function lt(e){return ct(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ut(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ht(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,dt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function dt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}rt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ht(t,ft,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ht(t,ft,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ht(n,"/"==n.charAt(0)?mt:pt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ht(n,yt)),e.join("")};var ft=/[#\/\?@]/g,pt=/[#\?:]/g,mt=/[#\?]/g,gt=/[#\?@]/g,yt=/#/g;function vt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function wt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function bt(e,t){wt(e),t=Et(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function _t(e,t){return wt(e),t=Et(e,t),e.g.has(t)}function xt(e,t,n){bt(e,t),0<n.length&&(e.i=null,e.g.set(Et(e,t),d(n)),e.h+=n.length)}function Et(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function It(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function Tt(){this.g=new he}function St(e,t,n){const r=n||"";try{tt(e,(function(e,n){let i=e;o(e)&&(i=le(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ct(e){this.l=e.Ub||null,this.j=e.eb||!1}function At(e,t){ee.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function kt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function jt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Dt(e)}function Dt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Nt(e){let t="";return v(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Pt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Nt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ct(e,t,n))}function Rt(e){ee.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=vt.prototype).add=function(e,t){wt(this),this.i=null,e=Et(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){wt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){wt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){wt(this);let t=[];if("string"==typeof e)_t(this,e)&&(t=t.concat(this.g.get(Et(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return wt(this),this.i=null,_t(this,e=Et(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},h(Ct,de),Ct.prototype.g=function(){return new At(this.l,this.j)},Ct.prototype.i=function(e){return function(){return e}}({}),h(At,ee),(e=At.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Dt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;kt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?jt(this):Dt(this),3==this.readyState&&kt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,jt(this))},e.Qa=function(e){this.g&&(this.response=e,jt(this))},e.ga=function(){this.g&&jt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(At.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Rt,ee);var Ot=/^https?$/i,Lt=["POST","PUT"];function Mt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),Vt(e)}function Ft(e){e.A||(e.A=!0,te(e,"complete"),te(e,"error"))}function Ut(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=zt(e)||2!=e.Z()))if(e.u&&4==zt(e))re(e.Ea,0,e);else if(te(e,"readystatechange"),4==zt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var o=String(e.D).match(nt)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Ot.test(o?o.toLowerCase():"")}n=s}if(n)te(e,"complete"),te(e,"success");else{e.m=6;try{var a=2<zt(e)?e.g.statusText:""}catch(c){a=""}e.l=a+" ["+e.Z()+"]",Ft(e)}}finally{Vt(e)}}}function Vt(e,t){if(e.g){Bt(e);const r=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||te(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function Bt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function zt(e){return e.g?e.g.readyState:0}function qt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function $t(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Wt(e){this.Aa=0,this.i=[],this.j=new Ce,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=$t("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=$t("baseRetryDelayMs",5e3,e),this.cb=$t("retryDelaySeedMs",1e4,e),this.Wa=$t("forwardChannelMaxRetries",2,e),this.wa=$t("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new He(e&&e.concurrentRequestLimit),this.Da=new Tt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Gt(e){if(Ht(e),3==e.G){var t=e.U++,n=it(e.I);if(ct(n,"SID",e.K),ct(n,"RID",t),ct(n,"TYPE","terminate"),Xt(e,n),(t=new Pe(e,e.j,t)).L=2,t.v=lt(it(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=un(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Be(t)}cn(e)}function Kt(e){e.g&&(tn(e),e.g.cancel(),e.g=null)}function Ht(e){Kt(e),e.u&&(i.clearTimeout(e.u),e.u=null),rn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Qt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||j(),A||(C(),A=!0),k.add(t,e),e.B=0}}function Yt(e,t){var n;n=t?t.l:e.U++;const r=it(e.I);ct(r,"SID",e.K),ct(r,"RID",n),ct(r,"AID",e.T),Xt(e,r),e.m&&e.o&&Pt(r,e.m,e.o),n=new Pe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=Jt(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),Je(e.h,n),Me(n,r,t)}function Xt(e,t){e.H&&v(e.H,(function(e,n){ct(t,n,e)})),e.l&&tt({},(function(e,n){ct(t,n,e)}))}function Jt(e,t,n){n=Math.min(e.i.length,n);var r=e.l?l(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<n;a++){let n=i[a].g;const c=i[a].map;if(n-=t,0>n)t=Math.max(0,i[a].g-100),o=!1;else try{St(c,e,"req"+n+"_")}catch(s){r&&r(c)}}if(o){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function Zt(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||j(),A||(C(),A=!0),k.add(t,e),e.v=0}}function en(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Se(l(e.Fa,e),on(e,e.v)),e.v++,!0)}function tn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function nn(e){e.g=new Pe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=it(e.qa);ct(t,"RID","rpc"),ct(t,"SID",e.K),ct(t,"AID",e.T),ct(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ct(t,"TO",e.ja),ct(t,"TYPE","xmlhttp"),Xt(e,t),e.m&&e.o&&Pt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=lt(it(t)),n.m=null,n.P=!0,Fe(n,e)}function rn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function sn(e,t){var n=null;if(e.g==t){rn(e),tn(e),e.g=null;var r=2}else{if(!Xe(e.h,t))return;n=t.D,Ze(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;te(r=be(),new Te(r,n)),Qt(e)}else Zt(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Ye(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Se(l(e.Ga,e,t),on(e,e.B)),e.B++,0)))}(e,t)||2==r&&en(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:an(e,5);break;case 4:an(e,10);break;case 3:an(e,6);break;default:an(e,2)}}function on(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function an(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),r=e.Xa;const t=!r;r=new rt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||st(r,"https"),lt(r),t?function(e,t){const n=new Ce;if(i.Image){const r=new Image;r.onload=u(It,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(It,n,"TestLoadImage: error",!1,t,r),r.onabort=u(It,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(It,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ce;const n=new AbortController,r=setTimeout((()=>{n.abort(),It(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?It(0,0,!0,t):It(0,0,!1,t)})).catch((()=>{clearTimeout(r),It(0,0,!1,t)}))}(r.toString(),n)}else Ie(2);e.G=0,e.l&&e.l.sa(t),cn(e),Ht(e)}function cn(e){if(e.G=0,e.ka=[],e.l){const t=et(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function ln(e,t,n){var r=n instanceof rt?it(n):new rt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ot(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var o=new rt(null);r&&st(o,r),t&&(o.g=t),s&&ot(o,s),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&ct(r,n,t),ct(r,"VER",e.la),Xt(e,r),r}function un(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Rt(new Ct({eb:n})):new Rt(e.pa)).Ha(e.J),t}function hn(){}function dn(){}function fn(e,t){ee.call(this),this.g=new Wt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new gn(this)}function pn(e){ge.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function mn(){ye.call(this),this.status=1}function gn(e){this.g=e}(e=Rt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ke.g(),this.v=this.o?fe(this.o):fe(ke),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Mt(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Lt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Bt(this),this.u=!0,this.g.send(e),this.u=!1}catch(o){Mt(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,te(this,"complete"),te(this,"abort"),Vt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vt(this,!0)),Rt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Ut(this):this.bb())},e.bb=function(){Ut(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<zt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ue(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Wt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ie(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=ln(this,null,this.W),Qt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Pe(this,this.j,e);let s=this.o;if(this.S&&(s?(s=w(s),_(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Jt(this,i,t),ct(n=it(this.I),"RID",e),ct(n,"CVER",22),this.D&&ct(n,"X-HTTP-Session-Id",this.D),Xt(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Nt(s)))+"&"+t:this.m&&Pt(n,this.m,s)),Je(this.h,i),this.Ua&&ct(n,"TYPE","init"),this.P?(ct(n,"$req",t),ct(n,"SID","null"),i.T=!0,Me(i,n,null)):Me(i,n,t),this.G=2}}else 3==this.G&&(e?Yt(this,e):0==this.i.length||Qe(this.h)||Yt(this))},e.Fa=function(){if(this.u=null,nn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Se(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ie(10),Kt(this),nn(this))},e.Za=function(){null!=this.C&&(this.C=null,Kt(this),en(this),Ie(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=hn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},dn.prototype.g=function(e,t){return new fn(e,t)},h(fn,ee),fn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fn.prototype.close=function(){Gt(this.g)},fn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=le(e),e=n);t.i.push(new Ke(t.Ya++,e)),3==t.G&&Qt(t)},fn.prototype.N=function(){this.g.l=null,delete this.j,Gt(this.g),delete this.g,fn.aa.N.call(this)},h(pn,ge),h(mn,ye),h(gn,hn),gn.prototype.ua=function(){te(this.g,"a")},gn.prototype.ta=function(e){te(this.g,new pn(e))},gn.prototype.sa=function(e){te(this.g,new mn)},gn.prototype.ra=function(){te(this.g,"b")},dn.prototype.createWebChannel=dn.prototype.g,fn.prototype.send=fn.prototype.o,fn.prototype.open=fn.prototype.m,fn.prototype.close=fn.prototype.close,qi=function(){return new dn},zi=function(){return be()},Bi=ve,Vi={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,Ui=je,De.COMPLETE="complete",Fi=De,pe.EventType=me,me.OPEN="a",me.CLOSE="b",me.ERROR="c",me.MESSAGE="d",ee.prototype.listen=ee.prototype.K,Mi=pe,Rt.prototype.listenOnce=Rt.prototype.L,Rt.prototype.getLastError=Rt.prototype.Ka,Rt.prototype.getLastErrorCode=Rt.prototype.Ba,Rt.prototype.getStatus=Rt.prototype.Z,Rt.prototype.getResponseJson=Rt.prototype.Oa,Rt.prototype.getResponseText=Rt.prototype.oa,Rt.prototype.send=Rt.prototype.ea,Rt.prototype.setWithCredentials=Rt.prototype.Ha,Li=Rt}).apply(void 0!==$i?$i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Wi="@firebase/firestore";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Gi.UNAUTHENTICATED=new Gi(null),Gi.GOOGLE_CREDENTIALS=new Gi("google-credentials-uid"),Gi.FIRST_PARTY=new Gi("first-party-uid"),Gi.MOCK_USER=new Gi("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Ki="10.14.0";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=new gr("@firebase/firestore");function Qi(){return Hi.logLevel}function Yi(e,...t){if(Hi.logLevel<=ur.DEBUG){const n=t.map(Zi);Hi.debug(`Firestore (${Ki}): ${e}`,...n)}}function Xi(e,...t){if(Hi.logLevel<=ur.ERROR){const n=t.map(Zi);Hi.error(`Firestore (${Ki}): ${e}`,...n)}}function Ji(e,...t){if(Hi.logLevel<=ur.WARN){const n=t.map(Zi);Hi.warn(`Firestore (${Ki}): ${e}`,...n)}}function Zi(e){if("string"==typeof e)return e;try{
/**
    * @license
    * Copyright 2020 Google LLC
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *   http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    */
return t=e,JSON.stringify(t)}catch(n){return e}var t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(e="Unexpected state"){const t=`FIRESTORE (${Ki}) INTERNAL ASSERTION FAILED: `+e;throw Xi(t),new Error(t)}function ts(e,t){e||es()}function ns(e,t){return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class is extends Qn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class as{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Gi.UNAUTHENTICATED)))}shutdown(){}}class cs{constructor(e){this.t=e,this.currentUser=Gi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ts(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new ss;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ss,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Yi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Yi("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ss)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Yi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ts("string"==typeof t.accessToken),new os(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ts(null===e||"string"==typeof e),new Gi(e)}}class ls{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Gi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class us{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ls(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Gi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class hs{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ds{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ts(void 0===this.o);const n=e=>{null!=e.error&&Yi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Yi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Yi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):Yi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ts("string"==typeof e.token),this.R=e.token,new hs(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fs(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=fs(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function ms(e,t){return e<t?-1:e>t?1:0}function gs(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new is(rs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new is(rs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new is(rs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new is(rs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ys.fromMillis(Date.now())}static fromDate(e){return ys.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ys(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ms(this.nanoseconds,e.nanoseconds):ms(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(e){this.timestamp=e}static fromTimestamp(e){return new vs(e)}static min(){return new vs(new ys(0,0))}static max(){return new vs(new ys(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t,n){void 0===t?t=0:t>e.length&&es(),void 0===n?n=e.length-t:n>e.length-t&&es(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ws.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ws?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class bs extends ws{construct(e,t,n){return new bs(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new is(rs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new bs(t)}static emptyPath(){return new bs([])}}const _s=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class xs extends ws{construct(e,t,n){return new xs(e,t,n)}static isValidIdentifier(e){return _s.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),xs.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new xs(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new is(rs.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new is(rs.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new is(rs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new is(rs.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new xs(t)}static emptyPath(){return new xs([])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e){this.path=e}static fromPath(e){return new Es(bs.fromString(e))}static fromName(e){return new Es(bs.fromString(e).popFirst(5))}static empty(){return new Es(bs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===bs.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return bs.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Es(new bs(e.slice()))}}function Is(e){return new Ts(e.readTime,e.key,-1)}class Ts{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ts(vs.min(),Es.empty(),-1)}static max(){return new Ts(vs.max(),Es.empty(),-1)}}function Ss(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Es.comparator(e.documentKey,t.documentKey),0!==n?n:ms(e.largestBatchId,t.largestBatchId)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)}class Cs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function As(e){if(e.code!==rs.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;Yi("LocalStore","Unexpectedly lost primary lease")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&es(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ks(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ks?t:ks.resolve(t)}catch(t){return ks.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ks.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ks.reject(t)}static resolve(e){return new ks(((t,n)=>{t(e)}))}static reject(e){return new ks(((t,n)=>{n(e)}))}static waitFor(e){return new ks(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=ks.resolve(!1);for(const n of e)t=t.next((e=>e?ks.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new ks(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new ks(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function js(e){return"IndexedDbTransactionError"===e.name}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Ns(e){return null==e}function Ps(e){return 0===e&&1/e==-1/0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Rs(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Os(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ls(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ds.oe=-1;class Ms{constructor(e,t){this.comparator=e,this.root=t||Us.EMPTY}insert(e,t){return new Ms(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Us.BLACK,null,null))}remove(e){return new Ms(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Us.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Fs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Fs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Fs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Fs(this.root,e,this.comparator,!0)}}class Fs{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Us{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Us.RED,this.left=null!=r?r:Us.EMPTY,this.right=null!=i?i:Us.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Us(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Us.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Us.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Us.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Us.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw es();if(this.right.isRed())throw es();const e=this.left.check();if(e!==this.right.check())throw es();return e+(this.isRed()?0:1)}}Us.EMPTY=null,Us.RED=!0,Us.BLACK=!1,Us.EMPTY=new class{constructor(){this.size=0}get key(){throw es()}get value(){throw es()}get color(){throw es()}get left(){throw es()}get right(){throw es()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Us(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Vs{constructor(e){this.comparator=e,this.data=new Ms(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bs(this.data.getIterator())}getIteratorFrom(e){return new Bs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Vs))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Vs(this.comparator);return t.data=e,t}}class Bs{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e){this.fields=e,e.sort(xs.comparator)}static empty(){return new zs([])}unionWith(e){let t=new Vs(xs.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new zs(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gs(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new qs("Invalid base64 string: "+t):t}}(e);return new $s(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new $s(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ms(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$s.EMPTY_BYTE_STRING=new $s("");const Ws=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gs(e){if(ts(!!e),"string"==typeof e){let t=0;const n=Ws.exec(e);if(ts(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ks(e.seconds),nanos:Ks(e.nanos)}}function Ks(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Hs(e){return"string"==typeof e?$s.fromBase64String(e):$s.fromUint8Array(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qs(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ys(e){const t=e.mapValue.fields.__previous_value__;return Qs(t)?Ys(t):t}function Xs(e){const t=Gs(e.mapValue.fields.__local_write_time__.timestampValue);return new ys(t.seconds,t.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Zs{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Zs("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Zs&&e.projectId===this.projectId&&e.database===this.database}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eo={};function to(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Qs(e)?4:function(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)?9007199254740991:function(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}(e)?10:11:es()}function no(e,t){if(e===t)return!0;const n=to(e);if(n!==to(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Xs(e).isEqual(Xs(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Gs(e.timestampValue),r=Gs(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,Hs(e.bytesValue).isEqual(Hs(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ks(e.geoPointValue.latitude)===Ks(t.geoPointValue.latitude)&&Ks(e.geoPointValue.longitude)===Ks(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ks(e.integerValue)===Ks(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ks(e.doubleValue),r=Ks(t.doubleValue);return n===r?Ps(n)===Ps(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return gs(e.arrayValue.values||[],t.arrayValue.values||[],no);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Rs(n)!==Rs(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!no(n[i],r[i])))return!1;return!0}(e,t);default:return es()}var r}function ro(e,t){return void 0!==(e.values||[]).find((e=>no(e,t)))}function io(e,t){if(e===t)return 0;const n=to(e),r=to(t);if(n!==r)return ms(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ms(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ks(e.integerValue||e.doubleValue),r=Ks(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return so(e.timestampValue,t.timestampValue);case 4:return so(Xs(e),Xs(t));case 5:return ms(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Hs(e),r=Hs(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=ms(n[i],r[i]);if(0!==e)return e}return ms(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=ms(Ks(e.latitude),Ks(t.latitude));return 0!==n?n:ms(Ks(e.longitude),Ks(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return oo(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},c=null===(n=o.value)||void 0===n?void 0:n.arrayValue,l=null===(r=a.value)||void 0===r?void 0:r.arrayValue,u=ms((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==l?void 0:l.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:oo(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===eo&&t===eo)return 0;if(e===eo)return 1;if(t===eo)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=ms(r[o],s[o]);if(0!==e)return e;const t=io(n[r[o]],i[s[o]]);if(0!==t)return t}return ms(r.length,s.length)}(e.mapValue,t.mapValue);default:throw es()}}function so(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ms(e,t);const n=Gs(e),r=Gs(t),i=ms(n.seconds,r.seconds);return 0!==i?i:ms(n.nanos,r.nanos)}function oo(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=io(n[i],r[i]);if(e)return e}return ms(n.length,r.length)}function ao(e){return co(e)}function co(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Gs(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Hs(e.bytesValue).toBase64():"referenceValue"in e?function(e){return Es.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=co(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${co(e.fields[i])}`;return n+"}"}(e.mapValue):es()}function lo(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function uo(e){return!!e&&"integerValue"in e}function ho(e){return!!e&&"arrayValue"in e}function fo(e){return!!e&&"nullValue"in e}function po(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function mo(e){return!!e&&"mapValue"in e}function go(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Os(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=go(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=go(e.arrayValue.values[n]);return t}return Object.assign({},e)}class yo{constructor(e){this.value=e}static empty(){return new yo({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!mo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=go(t)}setAll(e){let t=xs.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=go(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());mo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return no(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];mo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Os(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new yo(go(this.value))}}function vo(e){const t=[];return Os(e.fields,((e,n)=>{const r=new xs([e]);if(mo(n)){const e=vo(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new zs(t)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class wo{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new wo(e,0,vs.min(),vs.min(),vs.min(),yo.empty(),0)}static newFoundDocument(e,t,n,r){return new wo(e,1,t,vs.min(),n,r,0)}static newNoDocument(e,t){return new wo(e,2,t,vs.min(),vs.min(),yo.empty(),0)}static newUnknownDocument(e,t){return new wo(e,3,t,vs.min(),vs.min(),yo.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(vs.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yo.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=vs.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof wo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(e,t){this.position=e,this.inclusive=t}}function _o(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Es.comparator(Es.fromName(o.referenceValue),n.key):io(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function xo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!no(e.position[n],t.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e,t="asc"){this.field=e,this.dir=t}}function Io(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{}class So extends To{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Po(e,t,n):"array-contains"===t?new Mo(e,n):"in"===t?new Fo(e,n):"not-in"===t?new Uo(e,n):"array-contains-any"===t?new Vo(e,n):new So(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ro(e,n):new Oo(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(io(t,this.value)):null!==t&&to(this.value)===to(t)&&this.matchesComparison(io(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return es()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Co extends To{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Co(e,t)}matches(e){return Ao(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ao(e){return"and"===e.op}function ko(e){return function(e){for(const t of e.filters)if(t instanceof Co)return!1;return!0}(e)&&Ao(e)}function jo(e){if(e instanceof So)return e.field.canonicalString()+e.op.toString()+ao(e.value);if(ko(e))return e.filters.map((e=>jo(e))).join(",");{const t=e.filters.map((e=>jo(e))).join(",");return`${e.op}(${t})`}}function Do(e,t){return e instanceof So?(n=e,(r=t)instanceof So&&n.op===r.op&&n.field.isEqual(r.field)&&no(n.value,r.value)):e instanceof Co?function(e,t){return t instanceof Co&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Do(n,t.filters[r])),!0)}(e,t):void es();var n,r}function No(e){return e instanceof So?`${(t=e).field.canonicalString()} ${t.op} ${ao(t.value)}`:e instanceof Co?function(e){return e.op.toString()+" {"+e.getFilters().map(No).join(" ,")+"}"}(e):"Filter";var t}class Po extends So{constructor(e,t,n){super(e,t,n),this.key=Es.fromName(n.referenceValue)}matches(e){const t=Es.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ro extends So{constructor(e,t){super(e,"in",t),this.keys=Lo("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Oo extends So{constructor(e,t){super(e,"not-in",t),this.keys=Lo("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Lo(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Es.fromName(e.referenceValue)))}class Mo extends So{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ho(t)&&ro(t.arrayValue,this.value)}}class Fo extends So{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ro(this.value.arrayValue,t)}}class Uo extends So{constructor(e,t){super(e,"not-in",t)}matches(e){if(ro(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!ro(this.value.arrayValue,t)}}class Vo extends So{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>ro(this.value.arrayValue,e)))}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ue=null}}function zo(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Bo(e,t,n,r,i,s,o)}function qo(e){const t=ns(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>jo(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>{return(t=e).field.canonicalString()+t.dir;var t})).join(","),Ns(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>ao(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>ao(e))).join(",")),t.ue=e}return t.ue}function $o(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Io(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Do(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!xo(e.startAt,t.startAt)&&xo(e.endAt,t.endAt)}function Wo(e){return Es.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ko(e){return new Go(e)}function Ho(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Qo(e){return null!==e.collectionGroup}function Yo(e){const t=ns(e);if(null===t.ce){t.ce=[];const e=new Set;for(const r of t.explicitOrderBy)t.ce.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Vs(xs.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t})(t).forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new Eo(r,n))})),e.has(xs.keyField().canonicalString())||t.ce.push(new Eo(xs.keyField(),n))}return t.ce}function Xo(e){const t=ns(e);return t.le||(t.le=function(e,t){if("F"===e.limitType)return zo(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Eo(e.field,t)}));const n=e.endAt?new bo(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new bo(e.startAt.position,e.startAt.inclusive):null;return zo(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Yo(e))),t.le}function Jo(e,t){const n=e.filters.concat([t]);return new Go(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Zo(e,t,n){return new Go(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ea(e,t){return $o(Xo(e),Xo(t))&&e.limitType===t.limitType}function ta(e){return`${qo(Xo(e))}|lt:${e.limitType}`}function na(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>No(e))).join(", ")}]`),Ns(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t})).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>ao(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>ao(e))).join(",")),`Target(${t})`}(Xo(e))}; limitType=${e.limitType})`}function ra(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Es.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Yo(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!function(e,t,n){const r=_o(e,t,n);return e.inclusive?r<=0:r<0}(n.startAt,Yo(n),r)||n.endAt&&!function(e,t,n){const r=_o(e,t,n);return e.inclusive?r>=0:r>0}(n.endAt,Yo(n),r)));var n,r}function ia(e){return(t,n)=>{let r=!1;for(const i of Yo(e)){const e=sa(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function sa(e,t,n){const r=e.field.isKeyField()?Es.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?io(r,i):es()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return es()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Os(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return Ls(this.inner)}size(){return this.innerSize}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aa=new Ms(Es.comparator);function ca(){return aa}const la=new Ms(Es.comparator);function ua(...e){let t=la;for(const n of e)t=t.insert(n.key,n);return t}function ha(e){let t=la;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function da(){return pa()}function fa(){return pa()}function pa(){return new oa((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ma=new Ms(Es.comparator),ga=new Vs(Es.comparator);function ya(...e){let t=ga;for(const n of e)t=t.add(n);return t}const va=new Vs(ms);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function wa(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ps(t)?"-0":t}}function ba(e){return{integerValue:""+e}}function _a(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ps(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?ba(t):wa(e,t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this._=void 0}}function Ea(e,t,n){return e instanceof Sa?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Qs(t)&&(t=Ys(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Ca?Aa(e,t):e instanceof ka?ja(e,t):function(e,t){const n=Ta(e,t),r=Na(n)+Na(e.Pe);return uo(n)&&uo(e.Pe)?ba(r):wa(e.serializer,r)}(e,t)}function Ia(e,t,n){return e instanceof Ca?Aa(e,t):e instanceof ka?ja(e,t):n}function Ta(e,t){return e instanceof Da?uo(n=t)||(r=n)&&"doubleValue"in r?t:{integerValue:0}:null;var n,r}class Sa extends xa{}class Ca extends xa{constructor(e){super(),this.elements=e}}function Aa(e,t){const n=Pa(t);for(const r of e.elements)n.some((e=>no(e,r)))||n.push(r);return{arrayValue:{values:n}}}class ka extends xa{constructor(e){super(),this.elements=e}}function ja(e,t){let n=Pa(t);for(const r of e.elements)n=n.filter((e=>!no(e,r)));return{arrayValue:{values:n}}}class Da extends xa{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Na(e){return Ks(e.integerValue||e.doubleValue)}function Pa(e){return ho(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e,t){this.field=e,this.transform=t}}class Oa{constructor(e,t){this.version=e,this.transformResults=t}}class La{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new La}static exists(e){return new La(void 0,e)}static updateTime(e){return new La(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ma(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Fa{}function Ua(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Qa(e.key,La.none()):new $a(e.key,e.data,La.none());{const n=e.data,r=yo.empty();let i=new Vs(xs.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Wa(e.key,r,new zs(i.toArray()),La.none())}}function Va(e,t,n){var r;e instanceof $a?function(e,t,n){const r=e.value.clone(),i=Ka(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Wa?function(e,t,n){if(!Ma(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Ka(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ga(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):(r=n,t.convertToNoDocument(r.version).setHasCommittedMutations())}function Ba(e,t,n,r){return e instanceof $a?function(e,t,n,r){if(!Ma(e.precondition,t))return n;const i=e.value.clone(),s=Ha(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Wa?function(e,t,n,r){if(!Ma(e.precondition,t))return n;const i=Ha(e.fieldTransforms,r,t),s=t.data;return s.setAll(Ga(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):(i=t,s=n,Ma(e.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):s);var i,s}function za(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Ta(r.transform,e||null);null!=i&&(null===n&&(n=yo.empty()),n.set(r.field,i))}return n||null}function qa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&gs(n,r,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof Ca&&r instanceof Ca||n instanceof ka&&r instanceof ka?gs(n.elements,r.elements,no):n instanceof Da&&r instanceof Da?no(n.Pe,r.Pe):n instanceof Sa&&r instanceof Sa);var n,r}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class $a extends Fa{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Wa extends Fa{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ga(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Ka(e,t,n){const r=new Map;ts(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Ia(o,a,n[i]))}return r}function Ha(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ea(e,s,t))}return r}class Qa extends Fa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ya extends Fa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Va(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ba(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ba(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=fa();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Ua(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(vs.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ya())}isEqual(e){return this.batchId===e.batchId&&gs(this.mutations,e.mutations,((e,t)=>qa(e,t)))&&gs(this.baseMutations,e.baseMutations,((e,t)=>qa(e,t)))}}class Ja{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ts(e.mutations.length===n.length);let r=function(){return ma}();const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Ja(e,t,n,r)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e,t){this.count=e,this.unchangedNames=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tc,nc;function rc(e){if(void 0===e)return Xi("GRPC error has no .code"),rs.UNKNOWN;switch(e){case tc.OK:return rs.OK;case tc.CANCELLED:return rs.CANCELLED;case tc.UNKNOWN:return rs.UNKNOWN;case tc.DEADLINE_EXCEEDED:return rs.DEADLINE_EXCEEDED;case tc.RESOURCE_EXHAUSTED:return rs.RESOURCE_EXHAUSTED;case tc.INTERNAL:return rs.INTERNAL;case tc.UNAVAILABLE:return rs.UNAVAILABLE;case tc.UNAUTHENTICATED:return rs.UNAUTHENTICATED;case tc.INVALID_ARGUMENT:return rs.INVALID_ARGUMENT;case tc.NOT_FOUND:return rs.NOT_FOUND;case tc.ALREADY_EXISTS:return rs.ALREADY_EXISTS;case tc.PERMISSION_DENIED:return rs.PERMISSION_DENIED;case tc.FAILED_PRECONDITION:return rs.FAILED_PRECONDITION;case tc.ABORTED:return rs.ABORTED;case tc.OUT_OF_RANGE:return rs.OUT_OF_RANGE;case tc.UNIMPLEMENTED:return rs.UNIMPLEMENTED;case tc.DATA_LOSS:return rs.DATA_LOSS;default:return es()}}(nc=tc||(tc={}))[nc.OK=0]="OK",nc[nc.CANCELLED=1]="CANCELLED",nc[nc.UNKNOWN=2]="UNKNOWN",nc[nc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nc[nc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nc[nc.NOT_FOUND=5]="NOT_FOUND",nc[nc.ALREADY_EXISTS=6]="ALREADY_EXISTS",nc[nc.PERMISSION_DENIED=7]="PERMISSION_DENIED",nc[nc.UNAUTHENTICATED=16]="UNAUTHENTICATED",nc[nc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nc[nc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nc[nc.ABORTED=10]="ABORTED",nc[nc.OUT_OF_RANGE=11]="OUT_OF_RANGE",nc[nc.UNIMPLEMENTED=12]="UNIMPLEMENTED",nc[nc.INTERNAL=13]="INTERNAL",nc[nc.UNAVAILABLE=14]="UNAVAILABLE",nc[nc.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ic=new Pi([4294967295,4294967295],0);function sc(e){const t=(new TextEncoder).encode(e),n=new Ri;return n.update(t),new Uint8Array(n.digest())}function oc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Pi([n,r],0),new Pi([i,s],0)]}class ac{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new cc(`Invalid padding: ${t}`);if(n<0)throw new cc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new cc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new cc(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Pi.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(Pi.fromNumber(n)));return 1===r.compare(ic)&&(r=new Pi([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=sc(e),[n,r]=oc(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);if(!this.de(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new ac(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Ie)return;const t=sc(e),[n,r]=oc(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class cc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,uc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new lc(vs.min(),r,new Ms(ms),ca(),ya())}}class uc{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new uc(n,t,ya(),ya(),ya())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class dc{constructor(e,t){this.targetId=e,this.me=t}}class fc{constructor(e,t,n=$s.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class pc{constructor(){this.fe=0,this.ge=yc(),this.pe=$s.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ya(),t=ya(),n=ya();return this.ge.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:es()}})),new uc(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=yc()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ts(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class mc{constructor(e){this.Le=e,this.Be=new Map,this.ke=ca(),this.qe=gc(),this.Qe=new Ms(ms)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:es()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((e,n)=>{this.ze(n)&&t(n)}))}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(Wo(i))if(0===n){const e=new Es(i.path);this.Ue(t,e,wo.newNoDocument(e,vs.min()))}else ts(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Hs(n).toUint8Array()}catch(a){if(a instanceof qs)return Ji("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new ac(s,r,i)}catch(a){return Ji(a instanceof cc?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.Ie?null:o}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,n,null),r++)})),r}rt(e){const t=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&Wo(i.target)){const t=new Es(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,wo.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}}));let n=ya();this.qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.ke.forEach(((t,n)=>n.setReadTime(e)));const r=new lc(e,t,this.Qe,this.ke,n);return this.ke=ca(),this.qe=gc(),this.Qe=new Ms(ms),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new pc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Vs(ms),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||Yi("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new pc),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function gc(){return new Ms(Es.comparator)}function yc(){return new Ms(Es.comparator)}const vc=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),wc=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),bc=(()=>({and:"AND",or:"OR"}))();class _c{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xc(e,t){return e.useProto3Json||Ns(t)?t:{value:t}}function Ec(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ic(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Tc(e,t){return Ec(e,t.toTimestamp())}function Sc(e){return ts(!!e),vs.fromTimestamp(function(e){const t=Gs(e);return new ys(t.seconds,t.nanos)}(e))}function Cc(e,t){return Ac(e,t).canonicalString()}function Ac(e,t){const n=(r=e,new bs(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===t?n:n.child(t)}function kc(e){const t=bs.fromString(e);return ts(Kc(t)),t}function jc(e,t){return Cc(e.databaseId,t.path)}function Dc(e,t){const n=kc(t);if(n.get(1)!==e.databaseId.projectId)throw new is(rs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new is(rs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Es(Rc(n))}function Nc(e,t){return Cc(e.databaseId,t)}function Pc(e){return new bs(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Rc(e){return ts(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oc(e,t,n){return{name:jc(e,t),fields:n.value.mapValue.fields}}function Lc(e,t){return{documents:[Nc(e,t.path)]}}function Mc(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Nc(e,i);const s=function(e){if(0!==e.length)return Wc(Co.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>{return{field:qc((t=e).field),direction:Vc(t.dir)};var t}))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=xc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i};var c}function Fc(e){let t=function(e){const t=kc(e);return 4===t.length?bs.emptyPath():Rc(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ts(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Uc(e);return t instanceof Co&&ko(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>{return new Eo($c((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t})));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ns(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new bo(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new bo(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new Go(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,l)}function Uc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=$c(e.unaryFilter.field);return So.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=$c(e.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=$c(e.unaryFilter.field);return So.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=$c(e.unaryFilter.field);return So.create(i,"!=",{nullValue:"NULL_VALUE"});default:return es()}}(e):void 0!==e.fieldFilter?(t=e,So.create($c(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return es()}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Co.create(e.compositeFilter.filters.map((e=>Uc(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return es()}}(e.compositeFilter.op))}(e):es();var t}function Vc(e){return vc[e]}function Bc(e){return wc[e]}function zc(e){return bc[e]}function qc(e){return{fieldPath:e.canonicalString()}}function $c(e){return xs.fromServerFormat(e.fieldPath)}function Wc(e){return e instanceof So?function(e){if("=="===e.op){if(po(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NAN"}};if(fo(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(po(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NOT_NAN"}};if(fo(e.value))return{unaryFilter:{field:qc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qc(e.field),op:Bc(e.op),value:e.value}}}(e):e instanceof Co?function(e){const t=e.getFilters().map((e=>Wc(e)));return 1===t.length?t[0]:{compositeFilter:{op:zc(e.op),filters:t}}}(e):es()}function Gc(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Kc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,t,n,r,i=vs.min(),s=vs.min(),o=$s.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Hc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Hc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e){this.ct=e}}function Yc(e){const t=Fc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Zo(t,t.limit,"L"):t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(){this.un=new Jc}addToCollectionParentIndex(e,t){return this.un.add(t),ks.resolve()}getCollectionParents(e,t){return ks.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ks.resolve()}deleteFieldIndex(e,t){return ks.resolve()}deleteAllFieldIndexes(e){return ks.resolve()}createTargetIndexes(e,t){return ks.resolve()}getDocumentsMatchingTarget(e,t){return ks.resolve(null)}getIndexType(e,t){return ks.resolve(0)}getFieldIndexes(e,t){return ks.resolve([])}getNextCollectionGroupToUpdate(e){return ks.resolve(null)}getMinOffset(e,t){return ks.resolve(Ts.min())}getMinOffsetFromCollectionGroup(e,t){return ks.resolve(Ts.min())}updateCollectionGroup(e,t,n){return ks.resolve()}updateIndexEntries(e,t){return ks.resolve()}}class Jc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Vs(bs.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Vs(bs.comparator)).toArray()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Zc(0)}static kn(){return new Zc(-1)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(){this.changes=new oa((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,wo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ks.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Ba(n.mutation,e,zs.empty(),ys.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ya()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ya()){const r=da();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=ua();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=da();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ya())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=ca();const s=pa(),o=pa();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Wa)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Ba(o.mutation,t,o.mutation.getFieldMask(),ys.now())):s.set(t.key,zs.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new tl(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=pa();let r=new Ms(((e,t)=>e-t)),i=ya();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||zs.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||ya()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,l=fa();c.forEach((e=>{if(!i.has(e)){const r=Ua(t.get(e),n.get(e));null!==r&&l.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,l))}return ks.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return i=t,Es.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Qo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r);var i}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ks.resolve(da());let o=-1,a=i;return s.next((t=>ks.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ks.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,ya()))).next((e=>({batchId:o,changes:ha(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Es(t)).next((e=>{let t=ua();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=ua();return this.indexManager.getCollectionParents(e,i).next((o=>ks.forEach(o,(o=>{const a=(c=t,l=o.child(i),new Go(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,wo.newInvalidDocument(r)))}));let n=ua();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Ba(s.mutation,r,zs.empty(),ys.now()),ra(t,r)&&(n=n.insert(e,r))})),n}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ks.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(n=t).id,version:n.version,createTime:Sc(n.createTime)}),ks.resolve();var n}getNamedQuery(e,t){return ks.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(n=t).name,query:Yc(n.bundledQuery),readTime:Sc(n.readTime)}),ks.resolve();var n}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(){this.overlays=new Ms(Es.comparator),this.Ir=new Map}getOverlay(e,t){return ks.resolve(this.overlays.get(t))}getOverlays(e,t){const n=da();return ks.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),ks.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ir.delete(n)),ks.resolve()}getOverlaysForCollection(e,t,n){const r=da(),i=t.length+1,s=new Es(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ks.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Ms(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=da(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=da(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return ks.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Za(t,n));let i=this.Ir.get(t);void 0===i&&(i=ya(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(){this.sessionToken=$s.EMPTY_BYTE_STRING}getSessionToken(e){return ks.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ks.resolve()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(){this.Tr=new Vs(al.Er),this.dr=new Vs(al.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new al(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Vr(new al(e,t))}mr(e,t){e.forEach((e=>this.removeReference(e,t)))}gr(e){const t=new Es(new bs([])),n=new al(t,e),r=new al(t,e+1),i=[];return this.dr.forEachInRange([n,r],(e=>{this.Vr(e),i.push(e.key)})),i}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Es(new bs([])),n=new al(t,e),r=new al(t,e+1);let i=ya();return this.dr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new al(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class al{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Es.comparator(e.key,t.key)||ms(e.wr,t.wr)}static Ar(e,t){return ms(e.wr,t.wr)||Es.comparator(e.key,t.key)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Vs(al.Er)}checkEmpty(e){return ks.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Xa(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.br=this.br.add(new al(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ks.resolve(s)}lookupMutationBatch(e,t){return ks.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return ks.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ks.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return ks.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new al(t,0),r=new al(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],(e=>{const t=this.Dr(e.wr);i.push(t)})),ks.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Vs(ms);return t.forEach((e=>{const t=new al(e,0),r=new al(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],(e=>{n=n.add(e.wr)}))})),ks.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Es.isDocumentKey(i)||(i=i.child(""));const s=new al(new Es(i),0);let o=new Vs(ms);return this.br.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.wr)),!0)}),s),ks.resolve(this.Cr(o))}Cr(e){const t=[];return e.forEach((e=>{const n=this.Dr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ts(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return ks.forEach(t.mutations,(r=>{const i=new al(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.br=n}))}On(e){}containsKey(e,t){const n=new al(t,0),r=this.br.firstAfterOrEqual(n);return ks.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ks.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e){this.Mr=e,this.docs=new Ms(Es.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ks.resolve(n?n.document.mutableCopy():wo.newInvalidDocument(t))}getEntries(e,t){let n=ca();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():wo.newInvalidDocument(e))})),ks.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ca();const s=t.path,o=new Es(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Ss(Is(o),n)<=0||(r.has(o.key)||ra(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ks.resolve(i)}getAllFromCollectionGroup(e,t,n,r){es()}Or(e,t){return ks.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new ul(this)}getSize(e){return ks.resolve(this.size)}}class ul extends el{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)})),ks.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this.persistence=e,this.Nr=new oa((e=>qo(e)),$o),this.lastRemoteSnapshotVersion=vs.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ol,this.targetCount=0,this.kr=Zc.Bn()}forEachTarget(e,t){return this.Nr.forEach(((e,n)=>t(n))),ks.resolve()}getLastRemoteSnapshotVersion(e){return ks.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ks.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ks.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),ks.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Zc(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ks.resolve()}updateTargetData(e,t){return this.Kn(t),ks.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ks.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),ks.waitFor(i).next((()=>r))}getTargetCount(e){return ks.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return ks.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),ks.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),ks.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ks.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return ks.resolve(n)}containsKey(e,t){return ks.resolve(this.Br.containsKey(t))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Ds(0),this.Kr=!1,this.Kr=!0,this.$r=new sl,this.referenceDelegate=e(this),this.Ur=new hl(this),this.indexManager=new Xc,this.remoteDocumentCache=new ll((e=>this.referenceDelegate.Wr(e))),this.serializer=new Qc(t),this.Gr=new rl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new il,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new cl(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){Yi("MemoryPersistence","Starting transaction:",e);const r=new fl(this.Qr.next());return this.referenceDelegate.zr(),n(r).next((e=>this.referenceDelegate.jr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Hr(e,t){return ks.or(Object.values(this.qr).map((n=>()=>n.containsKey(e,t))))}}class fl extends Cs{constructor(e){super(),this.currentSequenceNumber=e}}class pl{constructor(e){this.persistence=e,this.Jr=new ol,this.Yr=null}static Zr(e){return new pl(e)}get Xr(){if(this.Yr)return this.Yr;throw es()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),ks.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),ks.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ks.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((e=>this.Xr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ks.forEach(this.Xr,(n=>{const r=Es.fromPath(n);return this.ei(e,r).next((e=>{e||t.removeEntry(r,vs.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return ks.or([()=>ks.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=ya(),r=ya();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new ml(e,t.fromCache,n,r)}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=Hn()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(Kn())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Zi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new gl;return this.Xi(e,t,n).next((r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)}))})).next((()=>i.result))}es(e,t,n,r){return n.documentReadCount<this.ji?(Qi()<=ur.DEBUG&&Yi("QueryEngine","SDK will not create cache indexes for query:",na(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ks.resolve()):(Qi()<=ur.DEBUG&&Yi("QueryEngine","Query:",na(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(Qi()<=ur.DEBUG&&Yi("QueryEngine","The SDK decides to create cache indexes for query:",na(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xo(t))):ks.resolve())}Yi(e,t){if(Ho(t))return ks.resolve(null);let n=Xo(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Zo(t,null,"F"),n=Xo(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=ya(...r);return this.Ji.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ts(t,r);return this.ns(t,s,i,n.readTime)?this.Yi(e,Zo(t,null,"F")):this.rs(e,s,t,n)}))))})))))}Zi(e,t,n,r){return Ho(t)||r.isEqual(vs.min())?ks.resolve(null):this.Ji.getDocuments(e,n).next((i=>{const s=this.ts(t,i);return this.ns(t,s,n,r)?ks.resolve(null):(Qi()<=ur.DEBUG&&Yi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),na(t)),this.rs(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=vs.fromTimestamp(1e9===r?new ys(n+1,0):new ys(n,r));return new Ts(i,Es.empty(),t)}(r,-1)).next((e=>e)))}))}ts(e,t){let n=new Vs(ia(e));return t.forEach(((t,r)=>{ra(e,r)&&(n=n.add(r))})),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return Qi()<=ur.DEBUG&&Yi("QueryEngine","Using full collection scan to execute query:",na(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ts.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new Ms(ms),this._s=new oa((e=>qo(e)),$o),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new nl(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}async function wl(e,t){const n=ns(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=ya();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({hs:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function bl(e){const t=ns(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ur.getLastRemoteSnapshotVersion(e)))}function _l(e,t){const n=ns(e),r=t.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ur.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Ur.addMatchingKeys(e,s.addedDocuments,a))));let l=c.withSequenceNumber(e.currentSequenceNumber);var u,h,d;null!==t.targetMismatches.get(a)?l=l.withResumeToken($s.EMPTY_BYTE_STRING,vs.min()).withLastLimboFreeSnapshotVersion(vs.min()):s.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(s.resumeToken,r)),i=i.insert(a,l),h=l,d=s,(0===(u=c).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.Ur.updateTargetData(e,l))}));let a=ca(),c=ya();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=ya(),i=ya();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=ca();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(vs.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Yi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Ps:r,Is:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.Ps,c=e.Is}))),!r.isEqual(vs.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next((t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return ks.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.os=i,e)))}function xl(e,t){const n=ns(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function El(e,t,n){const r=ns(e),i=r.os.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(o){if(!js(o))throw o;Yi("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.os=r.os.remove(t),r._s.delete(i.target)}function Il(e,t,n){const r=ns(e);let i=vs.min(),s=ya();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=ns(e),i=r._s.get(n);return void 0!==i?ks.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,Xo(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ss.getDocumentsMatchingQuery(e,t,n?i:vs.min(),n?s:ya()))).next((e=>(function(e,t,n){let r=e.us.get(t)||vs.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.us.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Ts:s})))))}class Tl{constructor(){this.activeTargetIds=va}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Sl{constructor(){this.so=new Tl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Tl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{_o(e){}shutdown(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Yi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Yi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kl=null;function jl(){return null===kl?kl=268435456+Math.round(2147483648*Math.random()):kl++,"0x"+kl.toString(16)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const Dl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl="WebChannelConnection";class Rl extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${r}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Fo(){return!1}Mo(e,t,n,r,i){const s=jl(),o=this.xo(e,t.toUriEncodedString());Yi("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(a,r,i),this.No(e,o,a,n).then((t=>(Yi("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Ji("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}Lo(e,t,n,r,i,s){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ki,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}xo(e,t){const n=Dl[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=jl();return new Promise(((s,o)=>{const a=new Li;a.setWithCredentials(!0),a.listenOnce(Fi.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Ui.NO_ERROR:const t=a.getResponseJson();Yi(Pl,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Ui.TIMEOUT:Yi(Pl,`RPC '${e}' ${i} timed out`),o(new is(rs.DEADLINE_EXCEEDED,"Request time out"));break;case Ui.HTTP_ERROR:const n=a.getStatus();if(Yi(Pl,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(rs).indexOf(t)>=0?t:rs.UNKNOWN}(t.status);o(new is(e,t.message))}else o(new is(rs.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new is(rs.UNAVAILABLE,"Connection failed."));break;default:es()}}finally{Yi(Pl,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);Yi(Pl,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Bo(e,t,n){const r=jl(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=qi(),o=zi(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Oo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=i.join("");Yi(Pl,`Creating RPC '${e}' stream ${r}: ${l}`,a);const u=s.createWebChannel(l,a);let h=!1,d=!1;const f=new Nl({Io:t=>{d?Yi(Pl,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Yi(Pl,`Opening RPC '${e}' stream ${r} transport.`),u.open(),h=!0),Yi(Pl,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},To:()=>u.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,Mi.EventType.OPEN,(()=>{d||(Yi(Pl,`RPC '${e}' stream ${r} transport opened.`),f.yo())})),p(u,Mi.EventType.CLOSE,(()=>{d||(d=!0,Yi(Pl,`RPC '${e}' stream ${r} transport closed`),f.So())})),p(u,Mi.EventType.ERROR,(t=>{d||(d=!0,Ji(Pl,`RPC '${e}' stream ${r} transport errored:`,t),f.So(new is(rs.UNAVAILABLE,"The operation could not be completed")))})),p(u,Mi.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];ts(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Yi(Pl,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=tc[e];if(void 0!==t)return rc(t)}(t),i=o.message;void 0===n&&(n=rs.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.So(new is(n,i)),u.close()}else Yi(Pl,`RPC '${e}' stream ${r} received:`,i),f.bo(i)}})),p(o,Bi.STAT_EVENT,(t=>{t.stat===Vi.PROXY?Yi(Pl,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Vi.NOPROXY&&Yi(Pl,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.wo()}),0),f}}function Ol(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(e){return new _c(e,!0)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&Yi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(e,t,n,r,i,s,o,a){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ml(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===rs.RESOURCE_EXHAUSTED?(Xi(t.toString()),Xi("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===rs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Yo===t&&this.P_(e,n)}),(t=>{e((()=>{const e=new is(rs.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)}))}))}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((e=>{n((()=>this.I_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.e_?this.E_(e):this.onNext(e)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return Yi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(Yi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ul extends Fl{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:es(),s=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(ts(void 0===t||"string"==typeof t),$s.fromBase64String(t||"")):(ts(void 0===t||t instanceof Buffer||t instanceof Uint8Array),$s.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(e){const t=void 0===e.code?rs.UNKNOWN:rc(e.code);return new is(t,e.message||"")}(a);n=new fc(i,s,o,c||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Dc(e,r.document.name),s=Sc(r.document.updateTime),o=r.document.createTime?Sc(r.document.createTime):vs.min(),a=new yo({mapValue:{fields:r.document.fields}}),c=wo.newFoundDocument(i,s,o,a),l=r.targetIds||[],u=r.removedTargetIds||[];n=new hc(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Dc(e,r.document),s=r.readTime?Sc(r.readTime):vs.min(),o=wo.newNoDocument(i,s),a=r.removedTargetIds||[];n=new hc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Dc(e,r.document),s=r.removedTargetIds||[];n=new hc([],s,i,null)}else{if(!("filter"in t))return es();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new ec(r,i),o=e.targetId;n=new dc(o,s)}}var r;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return vs.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?vs.min():t.readTime?Sc(t.readTime):vs.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Pc(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Wo(r)?{documents:Lc(e,r)}:{query:Mc(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ic(e,t.resumeToken);const r=xc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(vs.min())>0){n.readTime=Ec(e,t.snapshotVersion.toTimestamp());const r=xc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return es()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Pc(this.serializer),t.removeTarget=e,this.a_(t)}}class Vl extends Fl{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ts(!!e.streamToken),this.lastStreamToken=e.streamToken,ts(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){ts(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(ts(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Sc(e.updateTime):Sc(t);return n.isEqual(vs.min())&&(n=Sc(t)),new Oa(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Sc(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Pc(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof $a)n={update:Oc(e,t.key,t.value)};else if(t instanceof Qa)n={delete:jc(e,t.key)};else if(t instanceof Wa)n={update:Oc(e,t.key,t.data),updateMask:Gc(t.fieldMask)};else{if(!(t instanceof Ya))return es();n={verify:jc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Sa)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ca)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ka)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Da)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw es()}(0,e)))),t.precondition.isNone||(n.currentDocument=(r=e,void 0!==(i=t.precondition).updateTime?{updateTime:Tc(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:es())),n;var r,i}(this.serializer,e)))};this.a_(t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new is(rs.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Mo(e,Ac(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===rs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new is(rs.UNKNOWN,e.toString())}))}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Lo(e,Ac(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===rs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new is(rs.UNKNOWN,e.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class zl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xi(t),this.D_=!1):Yi("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o((e=>{n.enqueueAndForget((async()=>{Jl(this)&&(Yi("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=ns(e);t.L_.add(4),await Wl(t),t.q_.set("Unknown"),t.L_.delete(4),await $l(t)}(this))}))})),this.q_=new zl(n,r)}}async function $l(e){if(Jl(e))for(const t of e.B_)await t(!0)}async function Wl(e){for(const t of e.B_)await t(!1)}function Gl(e,t){const n=ns(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),Xl(n)?Yl(n):gu(n).r_()&&Hl(n,t))}function Kl(e,t){const n=ns(e),r=gu(n);n.N_.delete(t),r.r_()&&Ql(n,t),0===n.N_.size&&(r.r_()?r.o_():Jl(n)&&n.q_.set("Unknown"))}function Hl(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(vs.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}gu(e).A_(t)}function Ql(e,t){e.Q_.xe(t),gu(e).R_(t)}function Yl(e){e.Q_=new mc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),gu(e).start(),e.q_.v_()}function Xl(e){return Jl(e)&&!gu(e).n_()&&e.N_.size>0}function Jl(e){return 0===ns(e).L_.size}function Zl(e){e.Q_=void 0}async function eu(e){e.q_.set("Online")}async function tu(e){e.N_.forEach(((t,n)=>{Hl(e,t)}))}async function nu(e,t){Zl(e),Xl(e)?(e.q_.M_(t),Yl(e)):e.q_.set("Unknown")}async function ru(e,t,n){if(e.q_.set("Online"),t instanceof fc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))}(e,t)}catch(r){Yi("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),await iu(e,r)}else if(t instanceof hc?e.Q_.Ke(t):t instanceof dc?e.Q_.He(t):e.Q_.We(t),!n.isEqual(vs.min()))try{const t=await bl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.N_.get(t);if(!r)return;e.N_.set(t,r.withResumeToken($s.EMPTY_BYTE_STRING,r.snapshotVersion)),Ql(e,t);const i=new Hc(r.target,t,n,r.sequenceNumber);Hl(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(i){Yi("RemoteStore","Failed to raise snapshot:",i),await iu(e,i)}}async function iu(e,t,n){if(!js(t))throw t;e.L_.add(1),await Wl(e),e.q_.set("Offline"),n||(n=()=>bl(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Yi("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await $l(e)}))}function su(e,t){return t().catch((n=>iu(e,n,t)))}async function ou(e){const t=ns(e),n=yu(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;au(t);)try{const e=await xl(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,cu(t,e)}catch(i){await iu(t,i)}lu(t)&&uu(t)}function au(e){return Jl(e)&&e.O_.length<10}function cu(e,t){e.O_.push(t);const n=yu(e);n.r_()&&n.V_&&n.m_(t.mutations)}function lu(e){return Jl(e)&&!yu(e).n_()&&e.O_.length>0}function uu(e){yu(e).start()}async function hu(e){yu(e).p_()}async function du(e){const t=yu(e);for(const n of e.O_)t.m_(n.mutations)}async function fu(e,t,n){const r=e.O_.shift(),i=Ja.from(r,t,n);await su(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await ou(e)}async function pu(e,t){t&&yu(e).V_&&await async function(e,t){if(function(e){switch(e){default:return es();case rs.CANCELLED:case rs.UNKNOWN:case rs.DEADLINE_EXCEEDED:case rs.RESOURCE_EXHAUSTED:case rs.INTERNAL:case rs.UNAVAILABLE:case rs.UNAUTHENTICATED:return!1;case rs.INVALID_ARGUMENT:case rs.NOT_FOUND:case rs.ALREADY_EXISTS:case rs.PERMISSION_DENIED:case rs.FAILED_PRECONDITION:case rs.ABORTED:case rs.OUT_OF_RANGE:case rs.UNIMPLEMENTED:case rs.DATA_LOSS:return!0}}(n=t.code)&&n!==rs.ABORTED){const n=e.O_.shift();yu(e).s_(),await su(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await ou(e)}var n}(e,t),lu(e)&&uu(e)}async function mu(e,t){const n=ns(e);n.asyncQueue.verifyOperationInProgress(),Yi("RemoteStore","RemoteStore received new credentials");const r=Jl(n);n.L_.add(3),await Wl(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await $l(n)}function gu(e){return e.K_||(e.K_=function(e,t,n){const r=ns(e);return r.w_(),new Ul(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:eu.bind(null,e),Ro:tu.bind(null,e),mo:nu.bind(null,e),d_:ru.bind(null,e)}),e.B_.push((async t=>{t?(e.K_.s_(),Xl(e)?Yl(e):e.q_.set("Unknown")):(await e.K_.stop(),Zl(e))}))),e.K_}function yu(e){return e.U_||(e.U_=function(e,t,n){const r=ns(e);return r.w_(),new Vl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:hu.bind(null,e),mo:pu.bind(null,e),f_:du.bind(null,e),g_:fu.bind(null,e)}),e.B_.push((async t=>{t?(e.U_.s_(),await ou(e)):(await e.U_.stop(),e.O_.length>0&&(Yi("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class vu{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ss,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new vu(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new is(rs.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wu(e,t){if(Xi("AsyncQueue",`${t}: ${e}`),js(e))return new is(rs.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Es.comparator(t.key,n.key):(e,t)=>Es.comparator(e.key,t.key),this.keyedMap=ua(),this.sortedSet=new Ms(this.comparator)}static emptySet(e){return new bu(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new bu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(){this.W_=new Ms(Es.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):es():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class xu{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new xu(e,t,bu.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ea(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class Iu{constructor(){this.queries=Tu(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=ns(e),r=n.queries;n.queries=Tu(),r.forEach(((e,n)=>{for(const r of n.j_)r.onError(t)}))}(this,new is(rs.ABORTED,"Firestore shutting down"))}}function Tu(){return new oa((e=>ta(e)),ea)}async function Su(e,t){const n=ns(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.H_()&&t.J_()&&(r=2):(s=new Eu,r=t.J_()?0:1);try{switch(r){case 0:s.z_=await n.onListen(i,!0);break;case 1:s.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const e=wu(o,`Initialization of query '${na(t.query)}' failed`);return void t.onError(e)}n.queries.set(i,s),s.j_.push(t),t.Z_(n.onlineState),s.z_&&t.X_(s.z_)&&ju(n)}async function Cu(e,t){const n=ns(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.j_.indexOf(t);e>=0&&(s.j_.splice(e,1),0===s.j_.length?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Au(e,t){const n=ns(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.j_)e.X_(i)&&(r=!0);t.z_=i}}r&&ju(n)}function ku(e,t,n){const r=ns(e),i=r.queries.get(t);if(i)for(const s of i.j_)s.onError(n);r.queries.delete(t)}function ju(e){e.Y_.forEach((e=>{e.next()}))}var Du,Nu;(Nu=Du||(Du={})).ea="default",Nu.Cache="cache";class Pu{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new xu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=xu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Du.Cache}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(e){this.key=e}}class Ou{constructor(e){this.key=e}}class Lu{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ya(),this.mutatedKeys=ya(),this.Aa=ia(e),this.Ra=new bu(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new _u,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const l=r.get(e),u=ra(this.query,t)?t:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.ga(l,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Aa(u,a)>0||c&&this.Aa(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),f=!0):l&&!u&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ra:s,fa:n,ns:o,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const s=e.fa.G_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return es()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc))),this.pa(n),r=null!=r&&r;const o=t&&!r?this.ya():[],a=0===this.da.size&&this.current&&!r?1:0,c=a!==this.Ea;return this.Ea=a,0!==s.length||c?{snapshot:new xu(this.query,e.Ra,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new _u,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((e=>this.Ta=this.Ta.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ta=this.Ta.delete(e))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ya(),this.Ra.forEach((e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))}));const t=[];return e.forEach((e=>{this.da.has(e)||t.push(new Ou(e))})),this.da.forEach((n=>{e.has(n)||t.push(new Ru(n))})),t}ba(e){this.Ta=e.Ts,this.da=ya();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return xu.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Mu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Fu{constructor(e){this.key=e,this.va=!1}}class Uu{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new oa((e=>ta(e)),ea),this.Ma=new Map,this.xa=new Set,this.Oa=new Ms(Es.comparator),this.Na=new Map,this.La=new ol,this.Ba={},this.ka=new Map,this.qa=Zc.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function Vu(e,t,n=!0){const r=ah(e);let i;const s=r.Fa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await zu(r,t,n,!0),i}async function Bu(e,t){const n=ah(e);await zu(n,t,!0,!1)}async function zu(e,t,n,r){const i=await function(e,t){const n=ns(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Ur.getTargetData(e,t).next((i=>i?(r=i,ks.resolve(r)):n.Ur.allocateTargetId(e).next((i=>(r=new Hc(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e}))}(e.localStore,Xo(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(e,t,n,r,i){e.Ka=(t,n,r)=>async function(e,t,n,r){let i=t.view.ma(n);i.ns&&(i=await Il(e.localStore,t.query,!1).then((({documents:e})=>t.view.ma(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return th(e,t.targetId,a.wa),a.snapshot}(e,t,n,r);const s=await Il(e.localStore,t,!0),o=new Lu(t,s.Ts),a=o.ma(s.documents),c=uc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),l=o.applyChanges(a,e.isPrimaryClient,c);th(e,n,l.wa);const u=new Mu(t,n,o);return e.Fa.set(t,u),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),l.snapshot}(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&Gl(e.remoteStore,i),a}async function qu(e,t,n){const r=ns(e),i=r.Fa.get(t),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter((e=>!ea(e,t)))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await El(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Kl(r.remoteStore,i.targetId),Zu(r,i.targetId)})).catch(As)):(Zu(r,i.targetId),await El(r.localStore,i.targetId,!0))}async function $u(e,t){const n=ns(e),r=n.Fa.get(t),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Kl(n.remoteStore,r.targetId))}async function Wu(e,t,n){const r=function(e){const t=ns(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Yu.bind(null,t),t}(e);try{const e=await function(e,t){const n=ns(e),r=ys.now(),i=t.reduce(((e,t)=>e.add(t.key)),ya());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=ca(),c=ya();return n.cs.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=za(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Wa(e.key,t,vo(t.value.mapValue),La.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ha(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new Ms(ms)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await ih(r,e.changes),await ou(r.remoteStore)}catch(i){const e=wu(i,"Failed to persist write");n.reject(e)}}async function Gu(e,t){const n=ns(e);try{const e=await _l(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Na.get(t);r&&(ts(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.va=!0:e.modifiedDocuments.size>0?ts(r.va):e.removedDocuments.size>0&&(ts(r.va),r.va=!1))})),await ih(n,e,t)}catch(r){await As(r)}}function Ku(e,t,n){const r=ns(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach(((n,r)=>{const i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=ns(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.j_)i.Z_(t)&&(r=!0)})),r&&ju(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Hu(e,t,n){const r=ns(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Na.get(t),s=i&&i.key;if(s){let e=new Ms(Es.comparator);e=e.insert(s,wo.newNoDocument(s,vs.min()));const n=ya().add(s),i=new lc(vs.min(),new Map,new Ms(ms),e,n);await Gu(r,i),r.Oa=r.Oa.remove(s),r.Na.delete(t),rh(r)}else await El(r.localStore,t,!1).then((()=>Zu(r,t,n))).catch(As)}async function Qu(e,t){const n=ns(e),r=t.batch.batchId;try{const e=await function(e,t){const n=ns(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ks.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);ts(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ya();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Ju(n,r,null),Xu(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ih(n,e)}catch(i){await As(i)}}async function Yu(e,t,n){const r=ns(e);try{const e=await function(e,t){const n=ns(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(ts(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Ju(r,t,n),Xu(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await ih(r,e)}catch(i){await As(i)}}function Xu(e,t){(e.ka.get(t)||[]).forEach((e=>{e.resolve()})),e.ka.delete(t)}function Ju(e,t,n){const r=ns(e);let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function Zu(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach((t=>{e.La.containsKey(t)||eh(e,t)}))}function eh(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(Kl(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),rh(e))}function th(e,t,n){for(const r of n)r instanceof Ru?(e.La.addReference(r.key,t),nh(e,r)):r instanceof Ou?(Yi("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||eh(e,r.key)):es()}function nh(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(Yi("SyncEngine","New document in limbo: "+n),e.xa.add(r),rh(e))}function rh(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new Es(bs.fromString(t)),r=e.qa.next();e.Na.set(r,new Fu(n)),e.Oa=e.Oa.insert(n,r),Gl(e.remoteStore,new Hc(Xo(Ko(n.path)),r,"TargetPurposeLimboResolution",Ds.oe))}}async function ih(e,t,n){const r=ns(e),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach(((e,a)=>{o.push(r.Ka(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=ml.Wi(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.Ca.d_(i),await async function(e,t){const n=ns(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ks.forEach(t,(t=>ks.forEach(t.$i,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>ks.forEach(t.Ui,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(r){if(!js(r))throw r;Yi("LocalStore","Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.os.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(e,i)}}}(r.localStore,s))}async function sh(e,t){const n=ns(e);if(!n.currentUser.isEqual(t)){Yi("SyncEngine","User change. New user:",t.toKey());const e=await wl(n.localStore,t);n.currentUser=t,i="'waitForPendingWrites' promise is rejected due to a user change.",(r=n).ka.forEach((e=>{e.forEach((e=>{e.reject(new is(rs.CANCELLED,i))}))})),r.ka.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await ih(n,e.hs)}var r,i}function oh(e,t){const n=ns(e),r=n.Na.get(t);if(r&&r.va)return ya().add(r.key);{let e=ya();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}function ah(e){const t=ns(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Gu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=oh.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Hu.bind(null,t),t.Ca.d_=Au.bind(null,t.eventManager),t.Ca.$a=ku.bind(null,t.eventManager),t}class ch{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ll(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return function(e,t,n,r){return new vl(e,t,n,r)}(this.persistence,new yl,e.initialUser,this.serializer)}Ga(e){return new dl(pl.Zr,this.serializer)}Wa(e){return new Sl}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ch.provider={build:()=>new ch};class lh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ku(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=sh.bind(null,this.syncEngine),await async function(e,t){const n=ns(e);t?(n.L_.delete(2),await $l(n)):t||(n.L_.add(2),await Wl(n),n.q_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Iu}createDatastore(e){const t=Ll(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Rl(r));var r;return function(e,t,n,r){return new Bl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Ku(this.syncEngine,e,0),s=Al.D()?new Al:new Cl,new ql(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Uu(e,t,n,r,i,s);return o&&(a.Qa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=ns(e);Yi("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await Wl(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}lh.provider={build:()=>new lh};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class uh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Xi("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Gi.UNAUTHENTICATED,this.clientId=ps.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{Yi("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Yi("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ss;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=wu(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function dh(e,t){e.asyncQueue.verifyOperationInProgress(),Yi("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await wl(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function fh(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Yi("FirestoreClient","Using user provided OfflineComponentProvider");try{await dh(e,e._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!("FirebaseError"===(n=i).name?n.code===rs.FAILED_PRECONDITION||n.code===rs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw i;Ji("Error using user provided cache. Falling back to memory cache: "+i),await dh(e,new ch)}}else Yi("FirestoreClient","Using default OfflineComponentProvider"),await dh(e,new ch);var n;return e._offlineComponents}(e);Yi("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>mu(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>mu(t.remoteStore,n))),e._onlineComponents=t}async function ph(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Yi("FirestoreClient","Using user provided OnlineComponentProvider"),await fh(e,e._uninitializedComponentsProvider._online)):(Yi("FirestoreClient","Using default OnlineComponentProvider"),await fh(e,new lh))),e._onlineComponents}async function mh(e){const t=await ph(e),n=t.eventManager;return n.onListen=Vu.bind(null,t.syncEngine),n.onUnlisten=qu.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Bu.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=$u.bind(null,t.syncEngine),n}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function gh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const yh=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vh(e,t,n){if(!n)throw new is(rs.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function wh(e){if(!Es.isDocumentKey(e))throw new is(rs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function bh(e){if(Es.isDocumentKey(e))throw new is(rs.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function _h(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":es()}function xh(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new is(rs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=_h(e);throw new is(rs.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new is(rs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new is(rs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new is(rs.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new is(rs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new is(rs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new is(rs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Ih{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Eh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new is(rs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new is(rs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Eh(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new as;switch(e.type){case"firstParty":return new us(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new is(rs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=yh.get(e);t&&(Yi("ComponentProvider","Removing Datastore"),yh.delete(e),t.terminate())}(this),Promise.resolve()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Th(this.firestore,e,this._query)}}class Sh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ch(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Sh(this.firestore,e,this._key)}}class Ch extends Th{constructor(e,t,n){super(e,t,Ko(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Sh(this.firestore,null,new Es(e))}withConverter(e){return new Ch(this.firestore,e,this._path)}}function Ah(e,t,...n){if(e=sr(e),vh("collection","path",t),e instanceof Ih){const r=bs.fromString(t,...n);return bh(r),new Ch(e,null,r)}{if(!(e instanceof Sh||e instanceof Ch))throw new is(rs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(bs.fromString(t,...n));return bh(r),new Ch(e.firestore,null,r)}}function kh(e,t,...n){if(e=sr(e),1===arguments.length&&(t=ps.newId()),vh("doc","path",t),e instanceof Ih){const r=bs.fromString(t,...n);return wh(r),new Sh(e,null,new Es(r))}{if(!(e instanceof Sh||e instanceof Ch))throw new is(rs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(bs.fromString(t,...n));return wh(r),new Sh(e.firestore,e instanceof Ch?e.converter:null,new Es(r))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ml(this,"async_queue_retry"),this.Vu=()=>{const e=Ol();e&&Yi("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=Ol();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Ol();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new ss;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!js(e))throw e;Yi("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(e){const t=this.mu.then((()=>(this.du=!0,e().catch((e=>{this.Eu=e,this.du=!1;throw Xi("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.du=!1,e))))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=vu.createAndSchedule(this,e,t,n,(e=>this.yu(e)));return this.Tu.push(r),r}fu(){this.Eu&&es()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Dh(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh extends Ih{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new jh,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new jh(e),this._firestoreClient=void 0,await e}}}function Ph(e){if(e._terminated)throw new is(rs.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;const i=e._freezeSettings(),s=(o=e._databaseId,a=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",c=e._persistenceKey,l=i,new Js(o,a,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,gh(l.experimentalLongPollingOptions),l.useFetchStreams));var o,a,c,l;e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new hh(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e),e._firestoreClient}class Rh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Rh($s.fromBase64String(e))}catch(t){throw new is(rs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Rh($s.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new is(rs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e){this._methodName=e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new is(rs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new is(rs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ms(this._lat,e._lat)||ms(this._long,e._long)}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uh=/^__.*__$/;class Vh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Wa(e,this.data,this.fieldMask,t,this.fieldTransforms):new $a(e,this.data,t,this.fieldTransforms)}}class Bh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Wa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw es()}}class qh{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new qh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return nd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(zh(this.Cu)&&Uh.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class $h{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ll(e)}Qu(e,t,n,r=!1){return new qh({Cu:e,methodName:t,qu:n,path:xs.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wh(e){const t=e._freezeSettings(),n=Ll(e._databaseId);return new $h(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Gh(e,t,n,r,i,s={}){const o=e.Qu(s.merge||s.mergeFields?2:0,t,n,i);Jh("Data must be an object, but it was:",o,r);const a=Yh(r,o);let c,l;if(s.merge)c=new zs(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Zh(t,r,n);if(!o.contains(i))throw new is(rs.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);rd(e,i)||e.push(i)}c=new zs(e),l=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=o.fieldTransforms;return new Vh(new yo(a),c,l)}class Kh extends Lh{_toFieldTransform(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Kh}}class Hh extends Lh{_toFieldTransform(e){return new Ra(e.path,new Sa)}isEqual(e){return e instanceof Hh}}function Qh(e,t){if(Xh(e=sr(e)))return Jh("Unsupported field value:",t,e),Yh(e,t);if(e instanceof Lh)return function(e,t){if(!zh(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Qh(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=sr(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return _a(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ys.fromDate(e);return{timestampValue:Ec(t.serializer,n)}}if(e instanceof ys){const n=new ys(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ec(t.serializer,n)}}if(e instanceof Mh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Rh)return{bytesValue:Ic(t.serializer,e._byteString)};if(e instanceof Sh){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Cc(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Fh)return n=t,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw n.Bu("VectorValues must only contain numeric values.");return wa(n.serializer,e)}))}}}}};var n;throw t.Bu(`Unsupported field value: ${_h(e)}`)}(e,t)}function Yh(e,t){const n={};return Ls(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Os(e,((e,r)=>{const i=Qh(r,t.Mu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Xh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ys||e instanceof Mh||e instanceof Rh||e instanceof Sh||e instanceof Lh||e instanceof Fh)}function Jh(e,t,n){if(!Xh(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){const r=_h(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}var r}function Zh(e,t,n){if((t=sr(t))instanceof Oh)return t._internalPath;if("string"==typeof t)return td(e,t);throw nd("Field path arguments must be of type string or ",e,!1,void 0,n)}const ed=new RegExp("[~\\*/\\[\\]]");function td(e,t,n){if(t.search(ed)>=0)throw nd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Oh(...t.split("."))._internalPath}catch(r){throw nd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function nd(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new is(rs.INVALID_ARGUMENT,a+e+c)}function rd(e,t){return e.some((e=>e.isEqual(t)))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Sh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new sd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(od("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class sd extends id{data(){return super.data()}}function od(e,t){return"string"==typeof t?td(e,t):t instanceof Oh?t._internalPath:t._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new is(rs.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cd{}class ld extends cd{}function ud(e,t,...n){let r=[];t instanceof cd&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof fd)).length,n=e.filter((e=>e instanceof hd)).length;if(t>1||t>0&&n>0)throw new is(rs.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)e=i._apply(e);return e}class hd extends ld{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new hd(e,t,n)}_apply(e){const t=this._parse(e);return vd(e._query,t),new Th(e.firestore,e.converter,Jo(e._query,t))}_parse(e){const t=Wh(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new is(rs.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){yd(o,s);const t=[];for(const n of o)t.push(gd(r,e,n));a={arrayValue:{values:t}}}else a=gd(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||yd(o,s),a=function(e,t,n,r=!1){return Qh(n,e.Qu(r?4:3,t))}(n,t,o,"in"===s||"not-in"===s);return So.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function dd(e,t,n){const r=t,i=od("where",e);return hd._create(i,r,n)}class fd extends cd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new fd(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Co.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)vd(n,i),n=Jo(n,i)}(e._query,t),new Th(e.firestore,e.converter,Jo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class pd extends ld{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new pd(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new is(rs.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new is(rs.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Eo(t,n)}(e._query,this._field,this._direction);return new Th(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Go(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function md(e,t="asc"){const n=t,r=od("orderBy",e);return pd._create(r,n)}function gd(e,t,n){if("string"==typeof(n=sr(n))){if(""===n)throw new is(rs.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qo(t)&&-1!==n.indexOf("/"))throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(bs.fromString(n));if(!Es.isDocumentKey(r))throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return lo(e,new Es(r))}if(n instanceof Sh)return lo(e,n._key);throw new is(rs.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_h(n)}.`)}function yd(e,t){if(!Array.isArray(e)||0===e.length)throw new is(rs.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function vd(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new is(rs.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new is(rs.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class wd{convertValue(e,t="none"){switch(to(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ks(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw es()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Os(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>Ks(e.doubleValue)));return new Fh(i)}convertGeoPoint(e){return new Mh(Ks(e.latitude),Ks(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ys(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Xs(e));default:return null}}convertTimestamp(e){const t=Gs(e);return new ys(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=bs.fromString(e);ts(Kc(n));const r=new Zs(n.get(1),n.get(3)),i=new Es(n.popFirst(5));return r.isEqual(t)||Xi(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(e,t,n){let r;return r=e?e.toFirestore(t):t,r
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class _d{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xd extends id{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ed(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(od("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ed extends xd{data(e={}){return super.data(e)}}class Id{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new _d(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Ed(this._firestore,this._userDataWriter,n.key,n,new _d(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new is(rs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Ed(e._firestore,e._userDataWriter,n.doc.key,n.doc,new _d(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Ed(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _d(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Td(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Td(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return es()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(e){e=xh(e,Sh);const t=xh(e.firestore,Nh);return function(e,t,n={}){const r=new ss;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new uh({next:a=>{s.Za(),t.enqueueAndForget((()=>Cu(e,o)));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new is(rs.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new is(rs.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new Pu(Ko(n.path),s,{includeMetadataChanges:!0,_a:!0});return Su(e,o)}(await mh(e),e.asyncQueue,t,n,r))),r.promise}(Ph(t),e._key).then((n=>Pd(t,e,n)))}class Cd extends wd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sh(this.firestore,null,t)}}function Ad(e){e=xh(e,Th);const t=xh(e.firestore,Nh),n=Ph(t),r=new Cd(t);return ad(e._query),function(e,t,n={}){const r=new ss;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new uh({next:n=>{s.Za(),t.enqueueAndForget((()=>Cu(e,o))),n.fromCache&&"server"===r.source?i.reject(new is(rs.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Pu(n,s,{includeMetadataChanges:!0,_a:!0});return Su(e,o)}(await mh(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new Id(t,r,e,n)))}function kd(e,t,n){e=xh(e,Sh);const r=xh(e.firestore,Nh),i=bd(e.converter,t);return Nd(r,[Gh(Wh(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,La.none())])}function jd(e,t,n,...r){e=xh(e,Sh);const i=xh(e.firestore,Nh),s=Wh(i);let o;return o="string"==typeof(t=sr(t))||t instanceof Oh?function(e,t,n,r,i,s){const o=e.Qu(1,t,n),a=[Zh(t,r,n)],c=[i];if(s.length%2!=0)throw new is(rs.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Zh(t,s[d])),c.push(s[d+1]);const l=[],u=yo.empty();for(let d=a.length-1;d>=0;--d)if(!rd(l,a[d])){const e=a[d];let t=c[d];t=sr(t);const n=o.Nu(e);if(t instanceof Kh)l.push(e);else{const r=Qh(t,n);null!=r&&(l.push(e),u.set(e,r))}}const h=new zs(l);return new Bh(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.Qu(1,t,n);Jh("Data must be an object, but it was:",i,r);const s=[],o=yo.empty();Os(r,((e,r)=>{const a=td(t,e,n);r=sr(r);const c=i.Nu(a);if(r instanceof Kh)s.push(a);else{const e=Qh(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new zs(s);return new Bh(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),Nd(i,[o.toMutation(e._key,La.exists(!0))])}function Dd(e,...t){var n,r,i;e=sr(e);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||Dh(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Dh(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,l,u;if(e instanceof Sh)l=xh(e.firestore,Nh),u=Ko(e._key.path),c={next:n=>{t[o]&&t[o](Pd(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=xh(e,Th);l=xh(n.firestore,Nh),u=n._query;const r=new Cd(l);c={next:e=>{t[o]&&t[o](new Id(l,r,n,e))},error:t[o+1],complete:t[o+2]},ad(e._query)}return function(e,t,n,r){const i=new uh(r),s=new Pu(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Su(await mh(e),s))),()=>{i.Za(),e.asyncQueue.enqueueAndForget((async()=>Cu(await mh(e),s)))}}(Ph(l),u,a,c)}function Nd(e,t){return function(e,t){const n=new ss;return e.asyncQueue.enqueueAndForget((async()=>Wu(await function(e){return ph(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Ph(e),t)}function Pd(e,t,n){const r=n.docs.get(t._key),i=new Cd(e);return new xd(e,i,t._key,r,new _d(n.hasPendingWrites,n.fromCache),t.converter)}function Rd(){return new Hh("serverTimestamp")}!function(e,t=!0){Ki=bi,mi(new or("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Nh(new cs(e.getProvider("auth-internal")),new ds(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new is(rs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zs(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),xi(Wi,"4.7.3",e),xi(Wi,"4.7.3","esm2017")}();function Od(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function Ld(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
xi("firebase","10.14.1","app"),"function"==typeof SuppressedError&&SuppressedError;const Md=Ld,Fd=new Yn("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ud=new gr("@firebase/auth");function Vd(e,...t){Ud.logLevel<=ur.ERROR&&Ud.error(`Auth (${bi}): ${e}`,...t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(e,...t){throw Wd(e,...t)}function zd(e,...t){return Wd(e,...t)}function qd(e,t,n){const r=Object.assign(Object.assign({},Md()),{[t]:n});return new Yn("auth","Firebase",r).create(t,{appName:e.name})}function $d(e){return qd(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wd(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Fd.create(e,...t)}function Gd(e,t,...n){if(!e)throw Wd(t,...n)}function Kd(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Vd(t),new Error(t)}function Hd(e,t){e||Kd(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Yd(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Yd()&&"https:"!==Yd()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Jd{constructor(e,t){this.shortDelay=e,this.longDelay=t,Hd(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Kn())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return Xd()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(e,t){Hd(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Kd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Kd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Kd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},nf=new Jd(3e4,6e4);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function sf(e,t,n,r,i={}){return of(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=er(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),ef.fetch()(cf(e,e.config.apiHost,n,o),c)}))}async function of(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},tf),t);try{const t=new uf(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw hf(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw hf(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw hf(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw hf(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw qd(e,a,o);Bd(e,a)}}catch(i){if(i instanceof Qn)throw i;Bd(e,"network-request-failed",{message:String(i)})}}async function af(e,t,n,r,i={}){const s=await sf(e,t,n,r,i);return"mfaPendingCredential"in s&&Bd(e,"multi-factor-auth-required",{_serverResponse:s}),s}function cf(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Zd(e.config,i):`${e.config.apiScheme}://${i}`}function lf(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class uf{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(zd(this.auth,"network-request-failed"))),nf.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function hf(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=zd(e,t,r);return i.customData._tokenResponse=n,i}function df(e){return void 0!==e&&void 0!==e.enterprise}class ff{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return lf(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function pf(e,t){return sf(e,"POST","/v1/accounts:lookup",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mf(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function gf(e){return 1e3*Number(e)}function yf(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Vd("JWT malformed, contained fewer than 3 sections"),null;try{const e=Bn(n);return e?JSON.parse(e):(Vd("Failed to decode base64 JWT payload"),null)}catch(i){return Vd("Caught error parsing JWT payload as JSON",null==i?void 0:i.toString()),null}}function vf(e){const t=yf(e);return Gd(t,"internal-error"),Gd(void 0!==t.exp,"internal-error"),Gd(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wf(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof Qn&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class bf{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=mf(this.lastLoginAt),this.creationTime=mf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xf(e){var t;const n=e.auth,r=await e.getIdToken(),i=await wf(e,pf(n,{idToken:r}));Gd(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?Ef(s.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const u=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!u&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new _f(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function Ef(e){return e.map((e=>{var{providerId:t}=e,n=Od(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class If{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Gd(e.idToken,"internal-error"),Gd(void 0!==e.idToken,"internal-error"),Gd(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):vf(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Gd(0!==e.length,"internal-error");const t=vf(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Gd(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await of(e,{},(async()=>{const n=er({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=cf(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",ef.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new If;return n&&(Gd("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Gd("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Gd("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new If,this.toJSON())}_performRefresh(){return Kd("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tf(e,t){Gd("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Sf{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Od(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new bf(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new _f(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await wf(this,this.stsTokenManager.getToken(this.auth,e));return Gd(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=sr(e),r=await n.getIdToken(t),i=yf(r);Gd(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:mf(gf(i.auth_time)),issuedAtTime:mf(gf(i.iat)),expirationTime:mf(gf(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=sr(e);await xf(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Gd(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Sf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Gd(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await xf(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(yi(this.auth.app))return Promise.reject($d(this.auth));const e=await this.getIdToken();return await wf(this,
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t){return sf(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,l;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:_,stsTokenManager:x}=t;Gd(v&&x,e,"internal-error");const E=If.fromJSON(this.name,x);Gd("string"==typeof v,e,"internal-error"),Tf(u,e.name),Tf(h,e.name),Gd("boolean"==typeof w,e,"internal-error"),Gd("boolean"==typeof b,e,"internal-error"),Tf(d,e.name),Tf(f,e.name),Tf(p,e.name),Tf(m,e.name),Tf(g,e.name),Tf(y,e.name);const I=new Sf({uid:v,auth:e,email:h,emailVerified:w,displayName:u,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(I.providerData=_.map((e=>Object.assign({},e)))),m&&(I._redirectEventId=m),I}static async _fromIdTokenResponse(e,t,n=!1){const r=new If;r.updateFromServerResponse(t);const i=new Sf({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await xf(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Gd(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Ef(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),o=new If;o.updateFromIdToken(n);const a=new Sf({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new _f(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,c),a}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cf=new Map;function Af(e){Hd(e instanceof Function,"Expected a class definition");let t=Cf.get(e);return t?(Hd(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Cf.set(e,t),t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}kf.type="NONE";const jf=kf;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(e,t,n){return`firebase:${e}:${t}:${n}`}class Nf{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Df(this.userKey,r.apiKey,i),this.fullPersistenceKey=Df("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Sf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Nf(Af(jf),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Af(jf);const s=Df(n,e.config.apiKey,e.name);let o=null;for(const l of t)try{const t=await l._get(s);if(t){const n=Sf._fromJSON(e,t);l!==i&&(o=n),i=l;break}}catch(c){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(c){}}))),new Nf(i,e,n)):new Nf(i,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pf(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Mf(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Rf(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Uf(t))return"Blackberry";if(Vf(t))return"Webos";if(Of(t))return"Safari";if((t.includes("chrome/")||Lf(t))&&!t.includes("edge/"))return"Chrome";if(Ff(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Rf(e=Kn()){return/firefox\//i.test(e)}function Of(e=Kn()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Lf(e=Kn()){return/crios\//i.test(e)}function Mf(e=Kn()){return/iemobile/i.test(e)}function Ff(e=Kn()){return/android/i.test(e)}function Uf(e=Kn()){return/blackberry/i.test(e)}function Vf(e=Kn()){return/webos/i.test(e)}function Bf(e=Kn()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function zf(){return function(){const e=Kn();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function qf(e=Kn()){return Bf(e)||Ff(e)||Vf(e)||Uf(e)||/windows phone/i.test(e)||Mf(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $f(e,t=[]){let n;switch(e){case"Browser":n=Pf(Kn());break;case"Worker":n=`${Pf(Kn())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${bi}/${r}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(i){r(i)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==n?void 0:n.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qf(this),this.idTokenSubscription=new Qf(this),this.beforeStateQueue=new Wf(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Af(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Nf.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await pf(this,{idToken:e}),n=await Sf._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(yi(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(s)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Gd(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xf(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(yi(this.app))return Promise.reject($d(this));const t=e?sr(e):null;return t&&Gd(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Gd(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return yi(this.app)?Promise.reject($d(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return yi(this.app)?Promise.reject($d(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Af(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return sf(e,"GET","/v2/passwordPolicy",rf(e,t))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this),t=new Gf(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Yn("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return sf(e,"POST","/v2/accounts:revokeToken",rf(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Af(e)||this._popupRedirectResolver;Gd(t,this,"argument-error"),this.redirectPersistenceManager=await Nf.create(this,[Af(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Gd(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Gd(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$f(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Ud.logLevel<=ur.WARN&&Ud.warn(`Auth (${bi}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Hf(e){return sr(e)}class Qf{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new rr(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Gd(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Xf(e){return Yf.loadJS(e)}class Jf{constructor(e){this.type="recaptcha-enterprise",this.auth=Hf(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return sf(e,"GET","/v2/recaptchaConfig",rf(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new ff(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))}function r(t,n,r){const i=window.grecaptcha;df(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,i)=>{n(this.auth).then((n=>{if(!t&&df(window.grecaptcha))r(n,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Yf.recaptchaEnterpriseScript;0!==t.length&&(t+=n),Xf(t).then((()=>{r(n,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Zf(e,t,n,r=!1){const i=new Jf(e);let s;try{s=await i.verify(n)}catch(a){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function ep(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Zf(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await Zf(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tp(e,t,n){const r=Hf(e);Gd(r._canInitEmulator,r,"emulator-config-failed"),Gd(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=np(t),{host:s,port:o}=function(e){const t=np(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:rp(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:rp(t)}}}(t),a=null===o?"":`:${o}`;r.config.emulator={url:`${i}//${s}${a}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()}function np(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rp(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class ip{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Kd("not implemented")}_getIdTokenResponse(e){return Kd("not implemented")}_linkToIdToken(e,t){return Kd("not implemented")}_getReauthenticationResolver(e){return Kd("not implemented")}}async function sp(e,t){return sf(e,"POST","/v1/accounts:signUp",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function op(e,t){return af(e,"POST","/v1/accounts:signInWithPassword",rf(e,t))}async function ap(e,t){return async function(e,t){return sf(e,"POST","/v1/accounts:sendOobCode",rf(e,t))}(e,t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cp extends ip{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new cp(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new cp(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ep(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",op);case"emailLink":return async function(e,t){return af(e,"POST","/v1/accounts:signInWithEmailLink",rf(e,t))}(e,{email:this._email,oobCode:this._password});default:Bd(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ep(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",sp);case"emailLink":return async function(e,t){return af(e,"POST","/v1/accounts:signInWithEmailLink",rf(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Bd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lp(e,t){return af(e,"POST","/v1/accounts:signInWithIdp",rf(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up extends ip{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new up(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Bd("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Od(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new up(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return lp(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,lp(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,lp(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=er(t)}return e}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp{constructor(e){var t,n,r,i,s,o;const a=tr(nr(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Gd(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=tr(nr(e)).link,n=t?tr(nr(t)).deep_link_id:null,r=tr(nr(e)).deep_link_id;return(r?tr(nr(r)).link:null)||r||n||t||e}(e);try{return new hp(t)}catch(n){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(){this.providerId=dp.PROVIDER_ID}static credential(e,t){return cp._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=hp.parseLink(t);return Gd(n,"argument-error"),cp._fromEmailAndCode(e,n.code,n.tenantId)}}dp.PROVIDER_ID="password",dp.EMAIL_PASSWORD_SIGN_IN_METHOD="password",dp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fp{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp extends fp{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp extends pp{constructor(){super("facebook.com")}static credential(e){return up._fromParams({providerId:mp.PROVIDER_ID,signInMethod:mp.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mp.credentialFromTaggedObject(e)}static credentialFromError(e){return mp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return mp.credential(e.oauthAccessToken)}catch(t){return null}}}mp.FACEBOOK_SIGN_IN_METHOD="facebook.com",mp.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class gp extends pp{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return up._fromParams({providerId:gp.PROVIDER_ID,signInMethod:gp.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return gp.credentialFromTaggedObject(e)}static credentialFromError(e){return gp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return gp.credential(t,n)}catch(r){return null}}}gp.GOOGLE_SIGN_IN_METHOD="google.com",gp.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class yp extends pp{constructor(){super("github.com")}static credential(e){return up._fromParams({providerId:yp.PROVIDER_ID,signInMethod:yp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yp.credentialFromTaggedObject(e)}static credentialFromError(e){return yp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return yp.credential(e.oauthAccessToken)}catch(t){return null}}}yp.GITHUB_SIGN_IN_METHOD="github.com",yp.PROVIDER_ID="github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vp extends pp{constructor(){super("twitter.com")}static credential(e,t){return up._fromParams({providerId:vp.PROVIDER_ID,signInMethod:vp.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return vp.credentialFromTaggedObject(e)}static credentialFromError(e){return vp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return vp.credential(t,n)}catch(r){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function wp(e,t){return af(e,"POST","/v1/accounts:signUp",rf(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vp.TWITTER_SIGN_IN_METHOD="twitter.com",vp.PROVIDER_ID="twitter.com";class bp{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Sf._fromIdTokenResponse(e,n,r),s=_p(n);return new bp({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=_p(n);return new bp({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function _p(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp extends Qn{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,xp.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new xp(e,t,n,r)}}function Ep(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw xp._fromErrorAndOperation(e,n,t,r);throw n}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function Ip(e,t,n=!1){if(yi(e.app))return Promise.reject($d(e));const r="signIn",i=await Ep(e,r,t),s=await bp._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function Tp(e){const t=Hf(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function Sp(e,t,n){return yi(e.app)?Promise.reject($d(e)):async function(e,t){return Ip(Hf(e),t)}(sr(e),dp.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Tp(e),t}))}const Cp="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Cp,"1"),this.storage.removeItem(Cp),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp extends Ap{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qf(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);zf()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}kp.type="LOCAL";const jp=kp;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp extends Ap{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Dp.type="SESSION";const Np=Dp;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Pp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Pp(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Rp(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pp.receivers=[];class Op{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Rp("",20);r.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(l),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(){return window}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Mp(){return void 0!==Lp().WorkerGlobalScope&&"function"==typeof Lp().importScripts}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Fp="firebaseLocalStorageDb",Up="firebaseLocalStorage",Vp="fbase_key";class Bp{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function zp(e,t){return e.transaction([Up],t?"readwrite":"readonly").objectStore(Up)}function qp(){const e=indexedDB.open(Fp,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Up,{keyPath:Vp})}catch(r){n(r)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Up)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Fp);return new Bp(e).toPromise()}(),t(await qp()))}))}))}async function $p(e,t,n){const r=zp(e,!0).put({[Vp]:t,value:n});return new Bp(r).toPromise()}function Wp(e,t){const n=zp(e,!0).delete(t);return new Bp(n).toPromise()}class Gp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await qp()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pp._getInstance(Mp()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Op(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await qp();return await $p(e,Cp,"1"),await Wp(e,Cp),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>$p(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=zp(e,!1).get(t),r=await new Bp(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Wp(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=zp(e,!1).getAll();return new Bp(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Gp.type="LOCAL";const Kp=Gp;
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Hp(e,t){return t?Af(t):(Gd(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Jd(3e4,6e4);class Qp extends ip{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return lp(e,this._buildIdpRequest())}_linkToIdToken(e,t){return lp(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return lp(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Yp(e){return Ip(e.auth,new Qp(e),e.bypassAuthState)}function Xp(e){const{auth:t,user:n}=e;return Gd(n,t,"internal-error"),
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t,n=!1){const{auth:r}=e;if(yi(r.app))return Promise.reject($d(r));const i="reauthenticate";try{const s=await wf(e,Ep(r,i,t,e),n);Gd(s.idToken,r,"internal-error");const o=yf(s.idToken);Gd(o,r,"internal-error");const{sub:a}=o;return Gd(e.uid===a,r,"user-mismatch"),bp._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&Bd(r,"user-mismatch"),s}}(n,new Qp(e),e.bypassAuthState)}async function Jp(e){const{auth:t,user:n}=e;return Gd(n,t,"internal-error"),async function(e,t,n=!1){const r=await wf(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return bp._forOperation(e,"link",r)}(n,new Qp(e),e.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Yp;case"linkViaPopup":case"linkViaRedirect":return Jp;case"reauthViaPopup":case"reauthViaRedirect":return Xp;default:Bd(this.auth,"internal-error")}}resolve(e){Hd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Hd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const em=new Jd(2e3,1e4);async function tm(e,t,n){if(yi(e.app))return Promise.reject(zd(e,"operation-not-supported-in-this-environment"));const r=Hf(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Bd(e,"argument-error"),qd(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,fp);const i=Hp(r,n);return new nm(r,"signInViaPopup",t,i).executeNotNull()}class nm extends Zp{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,nm.currentPopupAction&&nm.currentPopupAction.cancel(),nm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Gd(e,this.auth,"internal-error"),e}async onExecution(){Hd(1===this.filter.length,"Popup operations only handle one event");const e=Rp();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(zd(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(zd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(zd(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,em.get())};e()}}nm.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const rm="pendingRedirect",im=new Map;class sm extends Zp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=im.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Df(rm,e.config.apiKey,e.name)}(t),r=function(e){return Af(e._redirectPersistence)}(e);if(!(await r._isAvailable()))return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}im.set(this.auth._key(),e)}return this.bypassAuthState||im.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function om(e,t){im.set(e._key(),t)}async function am(e,t,n=!1){if(yi(e.app))return Promise.reject($d(e));const r=Hf(e),i=Hp(r,t),s=new sm(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return um(e);default:return!1}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!um(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(zd(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(lm(e))}saveEventToCache(e){this.cachedEventUids.add(lm(e)),this.lastProcessedEventTime=Date.now()}}function lm(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function um({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const hm=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dm=/^https?/;async function fm(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return sf(e,"GET","/v1/projects",t)}(e);for(const r of t)try{if(pm(r))return}catch(n){}Bd(e,"unauthorized-domain")}function pm(e){const t=Qd(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!dm.test(n))return!1;if(hm.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm=new Jd(3e4,6e4);function gm(){const e=Lp().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function ym(e){return new Promise(((t,n)=>{var r,i,s;function o(){gm(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{gm(),n(zd(e,"network-request-failed"))},timeout:mm.get()})}if(null===(i=null===(r=Lp().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Lp().gapi)||void 0===s?void 0:s.load)){const t=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return Lp()[t]=()=>{gapi.load?o():n(zd(e,"network-request-failed"))},Xf(`${Yf.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw vm=null,e}))}let vm=null;
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const wm=new Jd(5e3,15e3),bm={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_m=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xm(e){const t=e.config;Gd(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Zd(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:bi},i=_m.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${er(r).slice(1)}`}async function Em(e){const t=await function(e){return vm=vm||ym(e),vm}(e),n=Lp().gapi;return Gd(n,e,"internal-error"),t.open({where:document.body,url:xm(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bm,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=zd(e,"network-request-failed"),s=Lp().setTimeout((()=>{r(i)}),wm.get());function o(){Lp().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Im={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Tm{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Sm(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Im),{width:r.toString(),height:i.toString(),top:s,left:o}),l=Kn().toLowerCase();n&&(a=Lf(l)?"_blank":n),Rf(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=Kn()){var t;return Bf(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t||"",a),new Tm(null);const h=window.open(t||"",a,u);Gd(h,e,"popup-blocked");try{h.focus()}catch(d){}return new Tm(h)}const Cm="__/auth/handler",Am="emulator/auth/handler",km=encodeURIComponent("fac");async function jm(e,t,n,r,i,s){Gd(e.config.authDomain,e,"auth-domain-config-required"),Gd(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:bi,eventId:i};if(t instanceof fp){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof pp){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const c=await e._getAppCheckToken(),l=c?`#${km}=${encodeURIComponent(c)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${Cm}`;return Zd(e,Am)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)}?${er(a).slice(1)}${l}`}const Dm="webStorageSupport";const Nm=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Np,this._completeRedirectFn=am,this._overrideRedirectResult=om}async _openPopup(e,t,n,r){var i;Hd(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Sm(e,await jm(e,t,n,Qd(),r),Rp())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Lp().location.href=e}(await jm(e,t,n,Qd(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Hd(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await Em(e),n=new cm(e);return t.register("authEvent",(t=>{Gd(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Dm,{type:Dm},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Dm];void 0!==i&&t(!!i),Bd(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=fm(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return qf()||Of()||Bf()}};var Pm="@firebase/auth",Rm="1.7.9";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Om{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Gd(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Lm=Wn("authIdTokenMaxAge")||300;let Mm=null;var Fm;Yf={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=zd("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Fm="Browser",mi(new or("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Gd(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Fm,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$f(Fm)},c=new Kf(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Af);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),mi(new or("auth-internal",(e=>{const t=Hf(e.getProvider("auth").getImmediate());return new Om(t)}),"PRIVATE").setInstantiationMode("EXPLICIT")),xi(Pm,Rm,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Fm)),xi(Pm,Rm,"esm2017");const Um=_i({apiKey:"AIzaSyDLmbfcEK9k_uRjFE0C9fjJ6vFCDgds9m4",authDomain:"puffingood-123f6.firebaseapp.com",projectId:"puffingood-123f6",storageBucket:"puffingood-123f6.firebasestorage.app",messagingSenderId:"893760474100",appId:"1:893760474100:web:82fc82f1491745731047a1"}),Vm=function(e=function(e=li){const t=hi.get(e);if(!t&&e===li&&$n())return _i();if(!t)throw vi.create("no-app",{appName:e});return t}()){const t=gi(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=gi(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Jn(n.getOptions(),null!=t?t:{}))return e;Bd(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Nm,persistence:[Kp,jp,Np]}),r=Wn("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Lm)return;const r=null==t?void 0:t.token;Mm!==r&&(Mm=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){sr(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){sr(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}var i;const s=(o="auth",null===(c=null===(a=qn())||void 0===a?void 0:a.emulatorHosts)||void 0===c?void 0:c[o]);var o,a,c;return s&&tp(n,`http://${s}`),n}(Um),Bm=function(e,t,n){n||(n="(default)");const r=gi(e,"firestore");if(r.isInitialized(n)){const e=r.getImmediate({identifier:n});if(Jn(r.getOptions(n),t))return e;throw new is(rs.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new is(rs.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new is(rs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})}(Um,{cacheSizeBytes:-1,experimentalForceLongPolling:!0}),zm=new gp,qm=async(e,t)=>{try{const n=await async function(e,t,n){if(yi(e.app))return Promise.reject($d(e));const r=Hf(e),i=ep(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",wp),s=await i.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Tp(e),t})),o=await bp._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}(Vm,e,t);return await Wm.createUserProfile(n.user.uid,e),n.user}catch(n){throw n}},$m=async e=>async function(e,t){const n=Hf(e),r={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};await ep(n,r,"getOobCode",ap)}(Vm,e);const Wm=new class{async addFood(e){try{const t=Vm.currentUser;if(!t)throw new Error("Not authenticated");if(!e.name||!e.price||!e.category)throw new Error("Missing required food fields");return(await function(e,t){const n=xh(e.firestore,Nh),r=kh(e),i=bd(e.converter,t);return Nd(n,[Gh(Wh(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,La.exists(!1))]).then((()=>r))}(Ah(Bm,"foods"),{...e,createdAt:Rd(),createdBy:t.email,updatedAt:Rd(),updatedBy:t.email})).id}catch(t){throw console.error("Error adding food:",t),new Error(`Failed to add food: ${t}`)}}subscribeToFoods(e){return Dd(ud(Ah(Bm,"foods"),md("createdAt","desc")),(t=>{const n=t.docs.map((e=>({id:e.id,...e.data()})));e(n)}),(e=>{console.error("Error in foods subscription:",e)}))}async updateFood(e,t){try{const n=Vm.currentUser;if(!n)throw new Error("Not authenticated");const r=kh(Bm,"foods",e);if(!(await Sd(r)).exists())throw new Error("Food not found");await jd(r,{...t,updatedAt:Rd(),updatedBy:n.email})}catch(n){throw console.error("Error updating food:",n),new Error(`Failed to update food: ${n}`)}}async deleteFood(e){try{await(t=kh(Bm,"foods",e),Nd(xh(t.firestore,Nh),[new Qa(t._key,La.none())]))}catch(n){throw new Error(`Failed to delete food: ${n}`)}var t}async createOrder(e){try{const t=Vm.currentUser;if(!t)throw new Error("Not authenticated");if(!e.items||0===e.items.length)throw new Error("Order must contain at least one item");const n=kh(Ah(Bm,"orders"));return await kd(n,{...e,userId:t.uid,createdAt:Rd(),status:"pending"}),n.id}catch(t){throw console.error("Error creating order:",t),new Error(`Failed to create order: ${t}`)}}subscribeToUserOrders(e){const t=Vm.currentUser;if(!t)return()=>{};return Dd(ud(Ah(Bm,"orders"),dd("userId","==",t.uid),md("createdAt","desc")),(t=>{const n=t.docs.map((e=>({id:e.id,...e.data()})));e(n)}),(e=>{console.error("Error in orders subscription:",e)}))}async updateAdminSettings(e){try{const t=Vm.currentUser;if(!t)throw new Error("Not authenticated");const n=kh(Bm,"adminData","settings");await jd(n,{...e,updatedAt:Rd(),updatedBy:t.email})}catch(t){throw console.error("Error updating admin settings:",t),new Error(`Failed to update admin settings: ${t}`)}}subscribeToAdminSettings(e){return Dd(kh(Bm,"adminData","settings"),(t=>{t.exists()&&e(t.data())}),(e=>{console.error("Error in admin settings subscription:",e)}))}async createUserProfile(e,t){try{const n=kh(Bm,"users",e);(await Sd(n)).exists()||await kd(n,{id:e,email:t,name:"",phone:"",address:"",city:"",state:"",zipCode:"",isAdmin:!1,isMarketing:!1,createdAt:Rd(),updatedAt:Rd()})}catch(n){throw console.error("Error creating user profile:",n),new Error(`Failed to create user profile: ${n}`)}}async getUserProfile(e){try{if(!e)return console.warn("getUserProfile called with undefined userId"),null;const t=kh(Bm,"users",e),n=await Sd(t);if(n.exists())return n.data();const r=Vm.currentUser;return r?(await this.createUserProfile(e,r.email),{id:e,email:r.email,name:"",phone:"",address:"",city:"",state:"",zipCode:"",isAdmin:!1,isMarketing:!1,createdAt:new Date,updatedAt:new Date}):null}catch(t){throw console.error("Error getting user profile:",t),new Error(`Failed to get user profile: ${t}`)}}async updateUserProfile(e,t){try{const n=kh(Bm,"users",e);await jd(n,{...t,updatedAt:Rd()})}catch(n){throw console.error("Error updating user profile:",n),new Error(`Failed to update user profile: ${n}`)}}async getDeliveryFee(e){try{const t=await Sd(kh(Bm,"adminData","settings"));if(!t.exists())return 3.5;const n=t.data();return e.toLowerCase().includes("galway")&&n.isGalway?n.galwayFee:n.isOutsideGalway?n.outsideGalwayFee:0}catch(t){throw new Error(`Failed to get delivery fee: ${t}`)}}async updateUserRole(e,t){try{const n=kh(Bm,"users",e);await jd(n,{isAdmin:t,updatedAt:Rd()})}catch(n){throw console.error("Error updating user role:",n),new Error(`Failed to update user role: ${n}`)}}async getAllOrders(){try{const e=ud(Ah(Bm,"orders"),md("createdAt","desc"));return(await Ad(e)).docs.map((e=>({id:e.id,...e.data()})))}catch(e){throw console.error("Error getting all orders:",e),new Error(`Failed to get orders: ${e}`)}}async getUserOrders(e){try{const t=ud(Ah(Bm,"orders"),dd("userId","==",e),md("createdAt","desc"));return(await Ad(t)).docs.map((e=>({id:e.id,...e.data()})))}catch(t){throw console.error("Error getting user orders:",t),new Error(`Failed to get user orders: ${t}`)}}async updateOrderStatus(e,t){try{const n=kh(Bm,"orders",e);await jd(n,{status:t,updatedAt:Rd()})}catch(n){throw console.error("Error updating order status:",n),new Error(`Failed to update order status: ${n}`)}}async getAllUsers(){try{const e=ud(Ah(Bm,"users"),md("createdAt","desc"));return(await Ad(e)).docs.map((e=>({id:e.id,...e.data()})))}catch(e){throw console.error("Error getting all users:",e),new Error(`Failed to get users: ${e}`)}}async updateOrderTrackingNumber(e,t){try{const n=kh(Bm,"orders",e);await jd(n,{trackingNumber:t,updatedAt:Rd()})}catch(n){throw console.error("Error updating order tracking number:",n),n}}async createPaymentIntent(e){try{const t=await fetch("http://localhost:3000/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e})});if(!t.ok)throw new Error("Failed to create payment intent");return(await t.json()).clientSecret}catch(t){throw console.error("Error creating payment intent:",t),t}}},Gm=()=>{const[e,t]=r.useState([]),[n,i]=r.useState(!0),[s,o]=r.useState(null);return r.useEffect((()=>{i(!0);const e=Wm.subscribeToFoods((e=>{t(e),i(!1)}));return()=>e()}),[]),{foods:e,loading:n,error:s}},Km=()=>{const[e,t]=r.useState(null),[n,i]=r.useState(!0),[s,o]=r.useState(null);return r.useEffect((()=>{i(!0);const e=Wm.subscribeToAdminSettings((e=>{t(e),i(!1)}));return()=>e()}),[]),{settings:e,loading:n,error:s}},Hm="/puffingood-frontend/assets/classic-Df91mrOO.jpg",Qm="/puffingood-frontend/assets/premium-Po9zul2F.jpg",Ym="/puffingood-frontend/assets/half-half-DQBYW2BB.jpg",Xm=()=>{const e=o(),{user:t}=ht((e=>e.auth)),{foods:r,loading:i,error:s}=Gm(),{settings:c,loading:l}=Km(),u=r.slice(0,3);return i||l?n.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(S,{})}):s?n.jsx(m,{children:n.jsxs(C,{severity:"error",sx:{mt:2},children:["Error loading featured items: ",s]})}):n.jsxs(a,{children:[(null==c?void 0:c.isDiscount)&&n.jsx(A,{elevation:0,sx:{bgcolor:"secondary.main",color:"white",py:1,textAlign:"center",position:"relative",zIndex:1},children:n.jsxs(E,{variant:"body1",sx:{fontWeight:"bold"},children:["🎉 Save ",c.discountPercentage,"% with code:"," ",n.jsx("span",{style:{backgroundColor:"orange",color:"secondary.main",padding:"2px 8px",borderRadius:4,fontFamily:"monospace",letterSpacing:"1px"},children:c.discountCode})]})}),n.jsx(a,{sx:{bgcolor:"primary.main",color:"white",py:8,mb:6},children:n.jsxs(m,{maxWidth:"md",children:[n.jsx(E,{component:"h1",variant:"h2",align:"center",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Welcome to PuffinGood"}),n.jsx(E,{variant:"h5",align:"center",paragraph:!0,sx:{mb:4},children:"Delicious puff puffs delivered to your doorstep"}),n.jsxs(a,{sx:{display:"flex",justifyContent:"center",gap:2},children:[n.jsx(v,{variant:"contained",size:"large",onClick:()=>e("/menu"),sx:{bgcolor:"white",color:"primary.main","&:hover":{bgcolor:"grey.100"}},children:"Order Now"}),!t&&n.jsx(v,{variant:"outlined",size:"large",onClick:()=>e("/register"),sx:{borderColor:"white",color:"white","&:hover":{borderColor:"white",bgcolor:"rgba(255, 255, 255, 0.1)"}},children:"Sign Up"})]})]})}),n.jsxs(m,{maxWidth:"lg",children:[n.jsx(E,{component:"h2",variant:"h4",align:"center",gutterBottom:!0,sx:{mb:4},children:"Main Menu"}),n.jsx(k,{container:!0,spacing:4,children:u.map((t=>n.jsx(k,{item:!0,xs:12,md:4,children:n.jsxs(j,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[n.jsx(D,{component:"img",height:"200",image:"classic"===t.imagePath?Hm:"premium"===t.imagePath?Qm:Ym,alt:t.name}),n.jsx(N,{children:n.jsx(v,{fullWidth:!0,variant:"contained",onClick:()=>e("/menu"),children:"View Menu"})})]})},t.id)))})]})]})},Jm=Tn({name:"cart",initialState:{items:[],total:0},reducers:{addItem:(e,t)=>{const n=e.items.find((e=>e.id===t.payload.id));n?n.quantity+=t.payload.quantity:e.items.push(t.payload),e.total=e.items.reduce(((e,t)=>e+t.price*t.quantity),0)},updateQuantity:(e,t)=>{const n=e.items.find((e=>e.id===t.payload.id));n&&(n.quantity=t.payload.quantity,e.total=e.items.reduce(((e,t)=>e+t.price*t.quantity),0))},removeItem:(e,t)=>{e.items=e.items.filter((e=>e.id!==t.payload)),e.total=e.items.reduce(((e,t)=>e+t.price*t.quantity),0)},clearCart:e=>{e.items=[],e.total=0}}}),{addItem:Zm,updateQuantity:eg,removeItem:tg,clearCart:ng}=Jm.actions,rg=Jm.reducer,ig=()=>{const e=ct(),{foods:t,loading:i,error:s}=Gm(),[o,c]=r.useState(""),[l,u]=r.useState("all"),[h,d]=r.useState({open:!1,message:""}),[f,p]=r.useState({}),[g,w]=r.useState({});new Set(t.map((e=>e.category)));const b=t.filter((e=>{const t=e.name.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase()),n="all"===l||e.category===l;return t&&n})),_=(e,t)=>{p((n=>({...n,[e]:Math.max(0,(n[e]||0)+t)})))};return i?n.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(S,{})}):s?n.jsx(m,{children:n.jsxs(C,{severity:"error",sx:{mt:2},children:["Error loading menu: ",s]})}):n.jsxs(m,{maxWidth:"lg",children:[n.jsxs(a,{sx:{mb:4},children:[n.jsx(E,{variant:"h4",component:"h1",gutterBottom:!0,children:"Our Menu"}),n.jsx(k,{container:!0,spacing:2,sx:{mb:3}})]}),n.jsx(k,{container:!0,spacing:4,children:b.map((t=>n.jsx(k,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(j,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n.jsx(D,{component:"img",height:"200",image:"classic"==t.imagePath?Hm:"premium"==t.imagePath?Qm:Ym,alt:t.name}),n.jsxs(P,{sx:{flexGrow:1},children:[n.jsx(E,{gutterBottom:!0,variant:"h5",component:"h2",children:t.name}),n.jsx(E,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),n.jsxs(E,{variant:"h6",color:"primary",gutterBottom:!0,children:["€",t.price.toFixed(2)]}),t.addons&&t.addons.length>0&&t.addons.some((e=>e.isAvailable))&&n.jsxs(a,{sx:{mb:2},children:[n.jsx(E,{variant:"subtitle2",gutterBottom:!0,children:"Available Toppings:"}),n.jsx(R,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:t.addons.filter((e=>e.isAvailable)).map((e=>{var r;return n.jsx(O,{label:`${e.name} (€${e.price.toFixed(2)})`,size:"small",color:(null==(r=g[t.id])?void 0:r.includes(e.name))?"primary":"default",onClick:()=>{return n=t.id,r=e.name,void w((e=>{const t=e[n]||[];return{...e,[n]:t.includes(r)?t.filter((e=>e!==r)):[...t,r]}}));var n,r},sx:{mb:1}},e.name)}))})]}),n.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[n.jsx(y,{size:"small",onClick:()=>_(t.id,-1),children:n.jsx(Pe,{})}),n.jsx(E,{children:f[t.id]||0}),n.jsx(y,{size:"small",onClick:()=>_(t.id,1),children:n.jsx(Ie,{})})]}),n.jsx(v,{fullWidth:!0,variant:"contained",startIcon:n.jsx(Ie,{}),onClick:()=>(t=>{const n=f[t.id]||1;if(n>0){const r=g[t.id]||[],i=t.addons.filter((e=>r.includes(e.name)));e(Zm({id:t.id,name:t.name,price:t.price,quantity:n,image:t.imagePath,addons:i})),d({open:!0,message:`${n} ${t.name}(s) added to cart`}),p((e=>({...e,[t.id]:0}))),w((e=>({...e,[t.id]:[]})))}})(t),disabled:!f[t.id],children:"Add to Cart"})]})]})},t.id)))}),n.jsx(L,{open:h.open,autoHideDuration:3e3,onClose:()=>d({open:!1,message:""}),children:n.jsx(C,{severity:"success",sx:{width:"100%"},children:h.message})})]})},sg=()=>{const e=o(),t=ct(),{items:i,total:s}=ht((e=>e.cart)),{user:l}=ht((e=>e.auth)),[u,h]=r.useState(null),[d,f]=r.useState(0),[p,g]=r.useState(null),{settings:w}=Km();r.useEffect((()=>{(async()=>{if(null==l?void 0:l.id)try{const e=await Wm.getUserProfile(l.id);e&&h(e)}catch(e){console.error("Error loading user profile:",e)}})()}),[l]),r.useEffect((()=>{(async()=>{if(u)if(u.city)try{const e=await Wm.getDeliveryFee(u.city);f(e),g(0===e?"Delivery is not available in your area. Please check your delivery address.":null)}catch(e){g("Unable to calculate delivery fee. Please check your delivery address."),console.error("Error calculating delivery fee:",e)}else g("Please set your delivery address in your profile to see delivery fees");else g("Please sign in to see delivery fees")})()}),[u]);const b=(e,n)=>{const r=i.find((t=>t.id===e));if(r){const i=Math.max(1,r.quantity+n);t(eg({id:e,quantity:i}))}},_=i.reduce(((e,t)=>{var n;return e+(t.price+((null==(n=t.addons)?void 0:n.reduce(((t,n)=>e+(n.isAvailable&&n.price>0?n.price:0)),0))||0))*t.quantity}),0),x=(I=_,(null==w?void 0:w.isDiscount)&&w.discountPercentage?I*w.discountPercentage/100:0);var I;const T=_+d-x;return 0===i.length?n.jsx(m,{maxWidth:"md",children:n.jsxs(a,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx(E,{variant:"h5",gutterBottom:!0,children:"Your cart is empty"}),n.jsx(v,{variant:"contained",color:"primary",onClick:()=>e("/menu"),sx:{mt:2},children:"Browse Menu"})]})}):n.jsxs(m,{maxWidth:"md",children:[n.jsx(E,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mt:4},children:"Shopping Cart"}),n.jsxs(k,{container:!0,spacing:3,children:[n.jsx(k,{item:!0,xs:12,md:8,children:i.map((e=>n.jsx(j,{sx:{mb:2},children:n.jsx(P,{children:n.jsxs(k,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(k,{item:!0,xs:3,children:n.jsx(a,{component:"img",src:"classic"===e.image?Hm:"premium"===e.image?Qm:Ym,alt:e.name,sx:{width:"100%",height:"auto",borderRadius:1}})}),n.jsxs(k,{item:!0,xs:9,children:[n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[n.jsxs(a,{children:[n.jsx(E,{variant:"h6",component:"h2",children:e.name}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Base Price: €",e.price.toFixed(2)]}),e.addons&&e.addons.length>0&&n.jsxs(a,{sx:{mt:1},children:[n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Add-ons: ",e.addons.map((e=>`${e.name} (€${e.price.toFixed(2)})`)).join(", ")]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Item Total: €",(e.price+e.addons.reduce(((e,t)=>e+t.price),0)).toFixed(2)]})]})]}),n.jsx(y,{size:"small",onClick:()=>{return n=e.id,void t(tg(n));var n},color:"error",children:n.jsx(Ce,{})})]}),n.jsxs(a,{sx:{display:"flex",alignItems:"center",mt:1},children:[n.jsx(y,{size:"small",onClick:()=>b(e.id,-1),children:n.jsx(Pe,{})}),n.jsx(M,{value:e.quantity,size:"small",sx:{width:60,mx:1},InputProps:{readOnly:!0}}),n.jsx(y,{size:"small",onClick:()=>b(e.id,1),children:n.jsx(Ie,{})})]})]})]})})},e.id)))}),n.jsx(k,{item:!0,xs:12,md:4,children:n.jsx(j,{children:n.jsxs(P,{children:[n.jsx(E,{variant:"h6",gutterBottom:!0,children:"Order Summary"}),p&&n.jsx(C,{severity:"warning",sx:{mb:2},children:p}),n.jsxs(a,{sx:{my:2},children:[n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[n.jsx(E,{children:"Subtotal"}),n.jsxs(E,{children:["€",_.toFixed(2)]})]}),(null==w?void 0:w.isDiscount)&&n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[n.jsxs(E,{color:"success.main",children:["Discount (",w.discountPercentage,"% off)"]}),n.jsxs(E,{color:"success.main",children:["-€",x.toFixed(2)]})]}),n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[n.jsx(E,{children:"Delivery Fee"}),n.jsxs(E,{children:["€",d.toFixed(2)]})]}),n.jsx(c,{sx:{my:1}}),n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[n.jsx(E,{variant:"h6",children:"Total"}),n.jsxs(E,{variant:"h6",children:["€",T.toFixed(2)]})]}),n.jsx(v,{variant:"contained",fullWidth:!0,onClick:()=>{i.length>0&&e("/checkout")},sx:{mb:2},disabled:!u||!u.city||0===d,children:u?u.city?0===d?"Delivery Not Available":"Proceed to Checkout":"Set Delivery Address":"Sign in to Checkout"}),n.jsx(v,{variant:"outlined",fullWidth:!0,onClick:()=>t(ng()),color:"error",children:"Clear Cart"})]})]})})})]})]})},og=ye("pk_test_51R6skWPQK7bS5nYJjLS21zZpUAwYpHT1fcwJzY7xLoKcZxCDnGuI67jPkXHvM4PbZ8P40R73NqEwL59IVMVzpbAn00iUCaWvuV"),ag=({onSuccess:e,onError:t})=>{const i=we(),s=be(),[a,c]=r.useState(!1),l=o();r.useEffect((()=>{if(!i)return;const n=new URLSearchParams(window.location.search).get("payment_intent_client_secret");n&&i.retrievePaymentIntent(n).then((({paymentIntent:n})=>{if(n)switch(n.status){case"succeeded":e();break;case"processing":t("Your payment is processing.");break;case"requires_payment_method":t("Your payment was not successful, please try again.");break;default:t("Something went wrong.")}}))}),[i]);return n.jsxs("form",{onSubmit:async n=>{if(n.preventDefault(),i&&s){c(!0);try{const{error:n,paymentIntent:r}=await i.confirmPayment({elements:s,confirmParams:{return_url:`${window.location.origin}/checkout?step=payment`},redirect:"if_required"});n?t(n.message||"Payment failed"):r&&"succeeded"===r.status&&(e(),l("/orders"))}catch(r){t("An unexpected error occurred")}finally{c(!1)}}},children:[n.jsx(_e,{}),n.jsx(v,{type:"submit",variant:"contained",fullWidth:!0,disabled:!i||a,sx:{mt:2},children:a?n.jsx(S,{size:24}):"Pay Now"})]})},cg=({amount:e,onSuccess:t,onError:i})=>{const[s,o]=r.useState(null),[c,l]=r.useState(!0);return r.useEffect((()=>{(async()=>{try{const t=await Wm.createPaymentIntent(e);o(t)}catch(t){i("Failed to initialize payment")}finally{l(!1)}})()}),[e,i]),c?n.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:n.jsx(S,{})}):s?n.jsx(ve,{stripe:og,options:{clientSecret:s},children:n.jsx(ag,{onSuccess:t,onError:i})}):n.jsx(C,{severity:"error",children:"Failed to initialize payment. Please try again."})},lg=["Delivery Details","Review Order","Payment"],ug=()=>{const e=o(),t=ct(),{items:i,total:s}=ht((e=>e.cart)),{user:l}=ht((e=>e.auth)),[u,h]=r.useState(null),[d,f]=r.useState(0),[p,g]=r.useState({name:"",address:"",city:"",state:"",zipCode:"",phone:"",instructions:""}),[y,w]=r.useState(""),[b,_]=r.useState(0),{settings:x}=Km();r.useEffect((()=>{(async()=>{if(null==l?void 0:l.id)try{const e=await Wm.getUserProfile(l.id);e&&(h(e),g({name:e.name||"",address:e.address||"",city:e.city||"",state:e.state||"",zipCode:e.zipCode||"",phone:e.phone||"",instructions:""}))}catch(e){console.error("Error loading user profile:",e),w("Failed to load user profile. Please try again.")}})()}),[l]),r.useEffect((()=>{(async()=>{if(p.city)try{const e=await Wm.getDeliveryFee(p.city);_(e),w(0===e?"Delivery is not available in this area. Please check your delivery address.":"")}catch(e){w("Unable to calculate delivery fee. Please check your delivery address."),console.error("Error calculating delivery fee:",e)}})()}),[p.city]),r.useEffect((()=>{"payment"===new URLSearchParams(window.location.search).get("step")&&f(2)}),[]);const I=e=>{g({...p,[e.target.name]:e.target.value})},T=i.reduce(((e,t)=>{var n;return e+(t.price+((null==(n=t.addons)?void 0:n.reduce(((t,n)=>e+(n.isAvailable&&n.price>0?n.price:0)),0))||0))*t.quantity}),0),S=(A=T,(null==x?void 0:x.isDiscount)&&x.discountPercentage?A*x.discountPercentage/100:0);var A;const D=T+b-S,N=async()=>{try{if(!u)return void w("Please sign in to place an order");const n={userId:u.id,items:i.map((e=>({foodId:e.id,name:e.name,price:e.price,quantity:e.quantity,addons:e.addons||[]}))),subtotal:T,discount:S,discountCode:(null==x?void 0:x.isDiscount)?x.discountCode:null,discountPercentage:(null==x?void 0:x.isDiscount)?x.discountPercentage:null,totalAmount:D,city:p.city,deliveryFee:b,status:"pending",createdAt:new Date};await Wm.createOrder(n),t(ng()),e("/orders")}catch(n){w("Failed to place order. Please try again.")}},R=e=>{w(e)};return n.jsxs(m,{maxWidth:"md",children:[n.jsx(E,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mt:4},children:"Checkout"}),n.jsx(F,{activeStep:d,sx:{mb:4},children:lg.map((e=>n.jsx(U,{children:n.jsx(V,{children:e})},e)))}),y&&n.jsx(C,{severity:"error",sx:{mb:2},children:y}),n.jsx(j,{children:n.jsxs(P,{children:[0===d&&n.jsxs(k,{container:!0,spacing:3,children:[n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{required:!0,fullWidth:!0,label:"Full Name",name:"name",value:p.name,onChange:I})}),n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{required:!0,fullWidth:!0,label:"Delivery Address",name:"address",value:p.address,onChange:I})}),n.jsx(k,{item:!0,xs:12,sm:6,children:n.jsx(M,{required:!0,fullWidth:!0,label:"City",name:"city",value:p.city,onChange:I})}),n.jsx(k,{item:!0,xs:12,sm:6,children:n.jsx(M,{required:!0,fullWidth:!0,label:"Louth",name:"state",value:p.state,onChange:I})}),n.jsx(k,{item:!0,xs:12,sm:6,children:n.jsx(M,{required:!0,fullWidth:!0,label:"Eircode",name:"zipCode",value:p.zipCode,onChange:I})}),n.jsx(k,{item:!0,xs:12,sm:6,children:n.jsx(M,{required:!0,fullWidth:!0,label:"Phone Number",name:"phone",value:p.phone,onChange:I})}),n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{fullWidth:!0,label:"Delivery Instructions (Optional)",name:"instructions",multiline:!0,rows:3,value:p.instructions,onChange:I})})]}),1===d&&n.jsxs(a,{children:[n.jsx(E,{variant:"h6",gutterBottom:!0,children:"Order Items"}),i.map((e=>{var t;return n.jsxs(a,{sx:{mb:2},children:[n.jsxs(E,{variant:"subtitle1",children:[e.name," x ",e.quantity]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Base Price: €",e.price.toFixed(2)]}),e.addons&&e.addons.length>0&&n.jsxs(a,{sx:{ml:2},children:[n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Add-ons: ",e.addons.map((e=>`${e.name} (€${e.price.toFixed(2)})`)).join(", ")]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Item Total: €",(e.price+e.addons.reduce(((e,t)=>e+t.price),0)).toFixed(2)]})]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Subtotal: €",((e.price+((null==(t=e.addons)?void 0:t.reduce(((e,t)=>e+t.price),0))||0))*e.quantity).toFixed(2)]})]},e.id)})),n.jsx(c,{sx:{my:2}}),n.jsxs(a,{sx:{my:2},children:[n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[n.jsx(E,{children:"Subtotal"}),n.jsxs(E,{children:["€",T.toFixed(2)]})]}),(null==x?void 0:x.isDiscount)&&n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[n.jsxs(E,{color:"success.main",children:["Discount (",x.discountPercentage,"% off - ",x.discountCode,")"]}),n.jsxs(E,{color:"success.main",children:["-€",S.toFixed(2)]})]}),n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[n.jsx(E,{children:"Delivery Fee"}),n.jsxs(E,{children:["€",b.toFixed(2)]})]}),n.jsx(c,{sx:{my:1}}),n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[n.jsx(E,{variant:"h6",children:"Total"}),n.jsxs(E,{variant:"h6",children:["€",D.toFixed(2)]})]})]})]}),2===d&&n.jsxs(a,{children:[n.jsx(E,{variant:"h6",gutterBottom:!0,children:"Payment Details"}),n.jsx(cg,{amount:D,onSuccess:N,onError:R})]}),n.jsxs(a,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:[d>0&&n.jsx(v,{onClick:()=>{f((e=>e-1))},sx:{mr:1},children:"Back"}),d<lg.length-1&&n.jsx(v,{variant:"contained",onClick:()=>{(0!==d||(["name","address","city","state","zipCode","phone"].filter((e=>!p[e])).length>0?(w("Please fill in all required fields"),0):0!==b||(w("Delivery is not available in this area. Please check your delivery address."),0)))&&f((e=>e+1))},children:"Next"})]})]})})]})};var hg={},dg={};const fg=B(z);var pg;var mg=q;Object.defineProperty(hg,"__esModule",{value:!0});var gg=hg.default=void 0;!function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=wg(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}r.default=e,n&&n.set(e,r)}(r);var yg=mg((pg||(pg=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=fg}(dg)),dg)),vg=n;function wg(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(wg=function(e){return e?n:t})(e)}gg=hg.default=(0,yg.default)((0,vg.jsx)("path",{d:"M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"}),"Google");const bg="rememberedEmail",_g=()=>{const e=o(),t=ct(),{loading:i,error:s}=ht((e=>e.auth)),[c,l]=r.useState({email:"",password:""}),[u,d]=r.useState(!1),[f,p]=r.useState(!1),[g,w]=r.useState(""),[b,_]=r.useState(""),[x,I]=r.useState(!1),[T,S]=r.useState(!1);r.useEffect((()=>{const e=localStorage.getItem(bg);e&&(l((t=>({...t,email:e}))),d(!0))}),[]);const k=e=>{l({...c,[e.target.name]:e.target.value})};return n.jsxs(m,{maxWidth:"sm",children:[n.jsx(a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:n.jsxs(A,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[n.jsx(E,{component:"h1",variant:"h5",gutterBottom:!0,children:"Sign In"}),s&&n.jsx(C,{severity:"error",sx:{width:"100%",mb:2},children:s}),n.jsxs(a,{component:"form",onSubmit:async n=>{n.preventDefault(),t(kn());try{const n=await(async(e,t)=>{try{return(await Sp(Vm,e,t)).user}catch(s){throw s}})(c.email,c.password),r=await Wm.getUserProfile(n.uid);if(!r)throw new Error("User data not found");t(jn({id:n.uid,email:n.email,isAdmin:r.isAdmin,isMarketing:r.isMarketing})),e("/")}catch(r){t(Dn(r instanceof Error?r.message:"Login failed"))}},sx:{width:"100%"},children:[n.jsx(M,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:c.email,onChange:k}),n.jsx(M,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:T?"text":"password",id:"password",autoComplete:"current-password",value:c.password,onChange:k,InputProps:{endAdornment:n.jsx($,{position:"end",children:n.jsx(y,{"aria-label":"toggle password visibility",onClick:()=>S(!T),onMouseDown:e=>e.preventDefault(),edge:"end",children:T?n.jsx(Me,{}):n.jsx(Le,{})})})}}),n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1},children:[n.jsx(W,{control:n.jsx(G,{checked:u,onChange:e=>{d(e.target.checked),e.target.checked||localStorage.removeItem(bg)},color:"primary"}),label:"Remember me"}),n.jsx(K,{component:"button",variant:"body2",onClick:()=>p(!0),children:"Forgot password?"})]}),n.jsx(v,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:i,children:i?"Signing in...":"Sign In"}),n.jsx(v,{fullWidth:!0,variant:"outlined",startIcon:n.jsx(gg,{}),onClick:async()=>{t(kn());try{const n=await(async()=>{try{return(await tm(Vm,zm)).user}catch(s){throw s}})(),r=await Wm.getUserProfile(n.uid);if(!r)throw new Error("User data not found");t(jn({id:n.uid,email:n.email,isAdmin:r.isAdmin,isMarketing:r.isMarketing})),e("/")}catch(n){t(Dn(n instanceof Error?n.message:"Login failed"))}},sx:{mb:2},disabled:i,children:"Sign in with Google"}),n.jsx(a,{sx:{textAlign:"center"},children:n.jsx(K,{component:h,to:"/register",variant:"body2",children:"Don't have an account? Sign Up"})})]})]})}),n.jsxs(H,{open:f,onClose:()=>p(!1),children:[n.jsx(Q,{children:"Reset Password"}),n.jsx(Y,{children:x?n.jsx(C,{severity:"success",children:"Password reset email sent! Please check your inbox."}):n.jsxs(n.Fragment,{children:[n.jsx(E,{variant:"body2",sx:{mb:2},children:"Enter your email address and we'll send you a link to reset your password."}),n.jsx(M,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,value:g,onChange:e=>w(e.target.value),error:!!b,helperText:b})]})}),n.jsxs(X,{children:[n.jsx(v,{onClick:()=>p(!1),children:"Cancel"}),!x&&n.jsx(v,{onClick:async()=>{if(g)try{await $m(g),I(!0),_(""),setTimeout((()=>{p(!1),w(""),I(!1)}),3e3)}catch(e){_(e instanceof Error?e.message:"Failed to send reset email")}else _("Please enter your email address")},variant:"contained",children:"Send Reset Link"})]})]})]})},xg=()=>{const e=o(),t=ct(),{loading:i,error:s}=ht((e=>e.auth)),[c,l]=r.useState({name:"",email:"",password:"",confirmPassword:""}),[u,d]=r.useState(""),[f,p]=r.useState(!1),[g,w]=r.useState(!1),b=e=>{l({...c,[e.target.name]:e.target.value}),d("")};return n.jsx(m,{maxWidth:"sm",children:n.jsx(a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:n.jsxs(A,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[n.jsx(E,{component:"h1",variant:"h5",gutterBottom:!0,children:"Sign Up"}),(s||u)&&n.jsx(C,{severity:"error",sx:{width:"100%",mb:2},children:s||u}),n.jsxs(a,{component:"form",onSubmit:async n=>{if(n.preventDefault(),c.password!==c.confirmPassword?(d("Passwords do not match"),0):!(c.password.length<6&&(d("Password must be at least 6 characters long"),1))){t(kn());try{const n=await qm(c.email,c.password),r=await Wm.getUserProfile(n.uid);if(!r)throw new Error("Failed to create user profile");await Wm.updateUserProfile(n.uid,{name:c.name}),t(jn({id:n.uid,email:n.email,name:c.name,isAdmin:r.isAdmin||!1,isMarketing:r.isMarketing||!1,phone:"",address:"",city:"",state:"",zipCode:"",createdAt:new Date,updatedAt:new Date})),e("/")}catch(r){t(Dn(r instanceof Error?r.message:"Registration failed"))}}},sx:{width:"100%"},children:[n.jsxs(k,{container:!0,spacing:2,children:[n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{required:!0,fullWidth:!0,id:"name",label:"Full Name",name:"name",autoComplete:"name",value:c.name,onChange:b})}),n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:c.email,onChange:b})}),n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:f?"text":"password",id:"password",value:c.password,onChange:b,InputProps:{endAdornment:n.jsx($,{position:"end",children:n.jsx(y,{"aria-label":"toggle password visibility",onClick:()=>p(!f),onMouseDown:e=>e.preventDefault(),edge:"end",children:f?n.jsx(Me,{}):n.jsx(Le,{})})})}})}),n.jsx(k,{item:!0,xs:12,children:n.jsx(M,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:g?"text":"password",id:"confirmPassword",value:c.confirmPassword,onChange:b,InputProps:{endAdornment:n.jsx($,{position:"end",children:n.jsx(y,{"aria-label":"toggle confirm password visibility",onClick:()=>w(!g),onMouseDown:e=>e.preventDefault(),edge:"end",children:g?n.jsx(Me,{}):n.jsx(Le,{})})})}})})]}),n.jsx(v,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:i,children:i?"Creating Account...":"Sign Up"}),n.jsx(a,{sx:{textAlign:"center"},children:n.jsx(K,{component:h,to:"/login",variant:"body2",children:"Already have an account? Sign In"})})]})]})})})},Eg=()=>{const{user:e}=ht((e=>e.auth)),[t,i]=r.useState([]),[s,o]=r.useState(!0),[l,u]=r.useState(""),[h,d]=r.useState(null),[f,p]=r.useState({});r.useEffect((()=>{(async()=>{if(e)try{o(!0);const t=await Wm.getUserOrders(e.id);i(t)}catch(t){u("Failed to load orders. Please try again later.")}finally{o(!1)}})()}),[e]);const g=e=>{switch(e){case"pending":return"warning";case"processing":return"info";case"completed":return"success";case"cancelled":return"error";default:return"default"}},w=e=>e?e.toDate?e.toDate().toLocaleDateString():e instanceof Date?e.toLocaleDateString():new Date(e).toLocaleDateString():"No date",b=e=>{if("pending"!==e.status)return!1;let t;t=e.createdAt instanceof ys?e.createdAt.toDate():new Date(e.createdAt);return((new Date).getTime()-t.getTime())/6e4<=10};return s?n.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(S,{})}):l?n.jsx(m,{maxWidth:"md",children:n.jsx(C,{severity:"error",sx:{mt:4},children:l})}):e?0===t.length?n.jsx(m,{maxWidth:"md",children:n.jsx(a,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center"},children:n.jsx(E,{variant:"h5",gutterBottom:!0,children:"No orders found"})})}):n.jsxs(m,{maxWidth:"md",children:[n.jsx(E,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mt:4},children:"Order History"}),n.jsx(k,{container:!0,spacing:3,children:t.map((e=>{var r;return n.jsx(k,{item:!0,xs:12,children:n.jsx(j,{children:n.jsxs(P,{children:[n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[n.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(y,{onClick:()=>{return t=e.id,void p((e=>({...e,[t]:!e[t]})));var t},sx:{transform:f[e.id]?"rotate(180deg)":"none"},children:n.jsx(je,{})}),n.jsxs(E,{variant:"h6",children:["Order #",null==(r=e.id)?void 0:r.slice(-6)]})]}),n.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[n.jsx(O,{label:e.status.charAt(0).toUpperCase()+e.status.slice(1),color:g(e.status),size:"small"}),b(e)&&n.jsx(v,{variant:"outlined",color:"error",size:"small",onClick:()=>(async e=>{try{d(e),await Wm.updateOrderStatus(e,"cancelled"),i(t.map((t=>t.id===e?{...t,status:"cancelled"}:t)))}catch(n){u("Failed to cancel order. Please try again.")}finally{d(null)}})(e.id),disabled:h===e.id,children:h===e.id?"Cancelling...":"Cancel Order"})]})]}),n.jsxs(E,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Placed on ",w(e.createdAt)]}),n.jsxs(J,{in:f[e.id],timeout:"auto",unmountOnExit:!0,children:[b(e)&&n.jsx(E,{variant:"body2",color:"error",gutterBottom:!0,children:"You can cancel this order within 10 minutes of placing it"}),n.jsx(c,{sx:{my:2}}),n.jsx(E,{variant:"subtitle1",gutterBottom:!0,children:"Items"}),e.items.map((t=>{var r;return n.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:1},children:[n.jsxs(a,{sx:{flexGrow:1},children:[n.jsx(E,{variant:"body1",children:t.name}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Quantity: ",t.quantity]}),t.addons&&t.addons.length>0&&n.jsxs(E,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8em"},children:["Addons: ",t.addons.map((e=>e.name)).join(", ")]})]}),n.jsxs(E,{variant:"body1",children:["€",((t.price+((null==(r=t.addons)?void 0:r.reduce(((e,t)=>e+(t.isAvailable&&t.price>0?t.price:0)),0))||0))*t.quantity).toFixed(2)]})]},`${e.id}-${t.foodId}`)})),n.jsx(c,{sx:{my:2}}),n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[n.jsx(E,{variant:"h6",children:"Total"}),n.jsxs(E,{variant:"h6",children:["€",Number(e.totalAmount||0).toFixed(2)]})]}),n.jsx(E,{variant:"subtitle1",gutterBottom:!0,children:"Delivery Details"}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Order ID: ",e.id]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Date: ",w(e.createdAt)]}),e.trackingNumber&&n.jsxs(E,{variant:"body2",color:"primary",children:["Tracking Number: ",e.trackingNumber]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Status: ",e.status]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["City: ",e.city]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Delivery Fee: €",Number(e.deliveryFee||0).toFixed(2)]}),n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Total Amount: €",Number(e.totalAmount||0).toFixed(2)]})]})]})})},e.id)}))})]}):n.jsx(m,{maxWidth:"md",children:n.jsx(a,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center"},children:n.jsx(E,{variant:"h5",gutterBottom:!0,children:"Please sign in to view your orders"})})})},Ig=()=>{const[e,t]=r.useState([]),[i,s]=r.useState(!0),[o,l]=r.useState(null),[u,h]=r.useState(!1),[d,f]=r.useState(null),[p,m]=r.useState(0),{settings:g,loading:w,error:b}=Km(),[_,x]=r.useState({isGalway:!1,isOutsideGalway:!1,isDiscount:!1,discountCode:"",galwayFee:0,outsideGalwayFee:0,galwayDeliveryTime:0,outsideGalwayDeliveryTime:0});r.useEffect((()=>{(async()=>{try{s(!0);const e=await Wm.getAllUsers();t(e)}catch(e){l(e instanceof Error?e.message:"Failed to fetch users")}finally{s(!1)}})()}),[]),r.useEffect((()=>{g&&x(g)}),[g]);const I=()=>{h(!1),f(null)},T=async(n,r)=>{try{await Wm.updateUserRole(n,r),t(e.map((e=>e.id===n?{...e,isAdmin:r}:e)))}catch(i){l(i instanceof Error?i.message:"Failed to update user role")}},j=e=>{const{name:t,value:n,type:r,checked:i}=e.target;x((e=>({...e,[t]:"checkbox"===r?i:"number"===r?Number(n):n})))};return i||w?n.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"20px"},children:n.jsx(S,{})}):o||b?n.jsx(C,{severity:"error",children:o||b}):n.jsxs(n.Fragment,{children:[n.jsx(a,{sx:{mb:3},children:n.jsxs(Z,{value:p,onChange:(e,t)=>m(t),children:[n.jsx(ee,{label:"Users"}),n.jsx(ee,{label:"Settings"})]})}),0===p&&n.jsx(te,{component:A,children:n.jsxs(ne,{children:[n.jsx(re,{children:n.jsxs(ie,{children:[n.jsx(se,{children:"Name"}),n.jsx(se,{children:"Email"}),n.jsx(se,{children:"Phone"}),n.jsx(se,{children:"Admin"}),n.jsx(se,{children:"Actions"})]})}),n.jsx(oe,{children:e.map((e=>n.jsxs(ie,{children:[n.jsx(se,{children:e.name}),n.jsx(se,{children:e.email}),n.jsx(se,{children:e.phone}),n.jsx(se,{children:n.jsx(ae,{checked:e.isAdmin,onChange:t=>T(e.id,t.target.checked)})}),n.jsx(se,{children:n.jsx(y,{onClick:()=>(e=>{f(e),h(!0)})(e),children:n.jsx(Ae,{})})})]},e.id)))})]})}),1===p&&n.jsxs(A,{sx:{p:3},children:[n.jsx(E,{variant:"h6",gutterBottom:!0,children:"Delivery Settings"}),n.jsxs(k,{container:!0,spacing:3,children:[n.jsxs(k,{item:!0,xs:12,md:6,children:[n.jsx(W,{control:n.jsx(ae,{checked:_.isGalway,onChange:j,name:"isGalway"}),label:"Enable Galway Delivery"}),_.isGalway&&n.jsxs(n.Fragment,{children:[n.jsx(M,{fullWidth:!0,label:"Galway Delivery Fee",name:"galwayFee",type:"number",value:_.galwayFee,onChange:j,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Galway Delivery Time (minutes)",name:"galwayDeliveryTime",type:"number",value:_.galwayDeliveryTime,onChange:j,margin:"normal"})]})]}),n.jsxs(k,{item:!0,xs:12,md:6,children:[n.jsx(W,{control:n.jsx(ae,{checked:_.isOutsideGalway,onChange:j,name:"isOutsideGalway"}),label:"Enable Outside Galway Delivery"}),_.isOutsideGalway&&n.jsxs(n.Fragment,{children:[n.jsx(M,{fullWidth:!0,label:"Outside Galway Delivery Fee",name:"outsideGalwayFee",type:"number",value:_.outsideGalwayFee,onChange:j,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Outside Galway Delivery Time (minutes)",name:"outsideGalwayDeliveryTime",type:"number",value:_.outsideGalwayDeliveryTime,onChange:j,margin:"normal"})]})]})]}),n.jsx(c,{sx:{my:3}}),n.jsx(E,{variant:"h6",gutterBottom:!0,children:"Discount Settings"}),n.jsx(k,{container:!0,spacing:3,children:n.jsxs(k,{item:!0,xs:12,children:[n.jsx(W,{control:n.jsx(ae,{checked:_.isDiscount,onChange:j,name:"isDiscount"}),label:"Enable Discount Code"}),_.isDiscount&&n.jsxs(n.Fragment,{children:[n.jsx(M,{fullWidth:!0,label:"Discount Code",name:"discountCode",value:_.discountCode,onChange:j,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Discount Percentage",name:"discountPercentage",type:"number",InputProps:{endAdornment:n.jsx($,{position:"end",children:"%"}),inputProps:{min:0,max:100}},value:_.discountPercentage||0,onChange:j,margin:"normal",helperText:"Enter a value between 0 and 100"})]})]})}),n.jsx(a,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:n.jsx(v,{variant:"contained",onClick:async()=>{try{await Wm.updateAdminSettings(_),l(null)}catch(e){l(e instanceof Error?e.message:"Failed to update settings")}},children:"Save Settings"})})]}),n.jsxs(H,{open:u,onClose:I,children:[n.jsx(Q,{children:"Edit User"}),n.jsx(Y,{children:d&&n.jsxs("div",{children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Name:"})," ",d.name]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Email:"})," ",d.email]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Phone:"})," ",d.phone]}),n.jsx(W,{control:n.jsx(ae,{checked:d.isAdmin,onChange:e=>T(d.id,e.target.checked)}),label:"Admin Access"})]})}),n.jsx(X,{children:n.jsx(v,{onClick:I,children:"Close"})})]})]})},Tg=()=>{const e=o(),{user:t}=ht((e=>e.auth)),{foods:i,loading:s,error:c}=Gm(),{orders:l,loading:u,error:h}=((e=!1)=>{const[t,n]=r.useState([]),[i,s]=r.useState(!0),[o,a]=r.useState(null),{user:c}=ht((e=>e.auth));return r.useEffect((()=>{(async()=>{if(c)try{s(!0);const t=e?await Wm.getAllOrders():await Wm.getUserOrders(c.id);n(t)}catch(t){a(t instanceof Error?t.message:"Failed to fetch orders")}finally{s(!1)}})()}),[c,e]),{orders:t,loading:i,error:o}})(!0),[d,f]=r.useState(0),[p,g]=r.useState(!0),[b,_]=r.useState(""),[I,T]=r.useState(7),[D,N]=r.useState(!1),[R,L]=r.useState(null),[F,U]=r.useState({name:"",description:"",price:"",category:"",imagePath:"",addons:[]}),[V,B]=r.useState({name:"",price:"",isAvailable:!0}),[z,q]=r.useState({}),$=r.useMemo((()=>{if(!l)return[];const e=new Date;return e.setDate(e.getDate()-I),l.filter((t=>(t.createdAt instanceof Date?t.createdAt:t.createdAt.toDate())>=e))}),[l,I]),W=r.useMemo((()=>{if(!$)return null;const e=$.length,t=$.reduce(((e,t)=>e+(Number(t.totalAmount)||0)),0);return{totalOrders:e,totalRevenue:t,averageOrderValue:e>0?t/e:0,statusCounts:$.reduce(((e,t)=>(e[t.status]=(e[t.status]||0)+1,e)),{})}}),[$]);r.useEffect((()=>{t&&(e=>!0===e.isAdmin)(t)?g(!1):e("/")}),[t,e]);const G=e=>{e?(L(e),U({name:e.name,description:e.description,price:e.price.toString(),category:e.category,imagePath:e.imagePath,addons:e.addons||[]})):(L(null),U({name:"",description:"",price:"",category:"",imagePath:"",addons:[]})),N(!0)},K=()=>{N(!1),L(null)},J=e=>{U({...F,[e.target.name]:e.target.value})},he=async(e,t)=>{try{"cancelled"===t?await Wm.updateOrderStatus(e,t):(await Wm.updateOrderStatus(e,t),z[e]&&await Wm.updateOrderTrackingNumber(e,z[e]))}catch(n){_("Failed to update order status. Please try again.")}},de=e=>{switch(e){case"pending":return"warning";case"processing":return"info";case"completed":return"success";case"cancelled":return"error";default:return"default"}},fe=e=>{if("pending"!==e.status)return!1;let t;t=e.createdAt instanceof ys?e.createdAt.toDate():new Date(e.createdAt);return((new Date).getTime()-t.getTime())/6e4>10};return p||s||u?n.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(S,{})}):b||c||h?n.jsx(m,{children:n.jsx(C,{severity:"error",sx:{mt:2},children:b||c||h})}):n.jsx(m,{maxWidth:"lg",children:n.jsxs(a,{sx:{mt:4,mb:4},children:[n.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:3},children:[n.jsx(y,{onClick:()=>e("/"),sx:{mr:2},children:n.jsx(Te,{})}),n.jsx(E,{variant:"h4",component:"h1",children:"Admin Dashboard"})]}),n.jsxs(Z,{value:d,onChange:(e,t)=>{f(t)},sx:{mb:3},children:[n.jsx(ee,{label:"Orders"}),n.jsx(ee,{label:"Menu Items"}),n.jsx(ee,{label:"Settings"})]}),0===d&&n.jsxs(n.Fragment,{children:[n.jsx(a,{sx:{mb:3},children:n.jsxs(ce,{sx:{minWidth:200},children:[n.jsx(le,{children:"Date Range"}),n.jsxs(ue,{value:I,label:"Date Range",onChange:e=>T(Number(e.target.value)),children:[n.jsx(x,{value:1,children:"Last 24 Hours"}),n.jsx(x,{value:7,children:"Last 7 Days"}),n.jsx(x,{value:30,children:"Last 30 Days"}),n.jsx(x,{value:90,children:"Last 90 Days"})]})]})}),W&&n.jsxs(k,{container:!0,spacing:3,sx:{mb:3},children:[n.jsx(k,{item:!0,xs:12,sm:6,md:3,children:n.jsx(j,{children:n.jsxs(P,{children:[n.jsx(E,{color:"textSecondary",gutterBottom:!0,children:"Total Orders"}),n.jsx(E,{variant:"h4",children:W.totalOrders})]})})}),n.jsx(k,{item:!0,xs:12,sm:6,md:3,children:n.jsx(j,{children:n.jsxs(P,{children:[n.jsx(E,{color:"textSecondary",gutterBottom:!0,children:"Total Revenue"}),n.jsxs(E,{variant:"h4",children:["€",Number(W.totalRevenue).toFixed(2)]})]})})}),n.jsx(k,{item:!0,xs:12,sm:6,md:3,children:n.jsx(j,{children:n.jsxs(P,{children:[n.jsx(E,{color:"textSecondary",gutterBottom:!0,children:"Average Order Value"}),n.jsxs(E,{variant:"h4",children:["€",Number(W.averageOrderValue).toFixed(2)]})]})})}),n.jsx(k,{item:!0,xs:12,sm:6,md:3,children:n.jsx(j,{children:n.jsxs(P,{children:[n.jsx(E,{color:"textSecondary",gutterBottom:!0,children:"Order Status"}),n.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:1},children:Object.entries(W.statusCounts).map((([e,t])=>n.jsxs(a,{sx:{display:"flex",justifyContent:"space-between"},children:[n.jsx(O,{label:e,color:de(e),size:"small"}),n.jsx(E,{children:t})]},e)))})]})})})]}),n.jsx(te,{component:A,children:n.jsxs(ne,{children:[n.jsx(re,{children:n.jsxs(ie,{children:[n.jsx(se,{children:"Order ID"}),n.jsx(se,{children:"Date"}),n.jsx(se,{children:"Items"}),n.jsx(se,{children:"Total"}),n.jsx(se,{children:"Status"}),n.jsx(se,{children:"Tracking"}),n.jsx(se,{children:"Actions"})]})}),n.jsx(oe,{children:$.map((e=>n.jsxs(ie,{children:[n.jsx(se,{children:e.id}),n.jsx(se,{children:e.createdAt instanceof ys?e.createdAt.toDate().toLocaleString():new Date(e.createdAt).toLocaleString()}),n.jsx(se,{children:e.items.map(((t,r)=>{var i;return n.jsxs("div",{children:[t.quantity,"x ",t.name,t.addons&&t.addons.length>0&&n.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["Addons: ",t.addons.map((e=>e.name)).join(", ")]}),n.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["€",((t.price+((null==(i=t.addons)?void 0:i.reduce(((e,t)=>e+(t.isAvailable&&t.price>0?t.price:0)),0))||0))*t.quantity).toFixed(2)]})]},`${e.id}-${t.foodId||r}`)}))}),n.jsxs(se,{children:["€",Number(e.totalAmount||0).toFixed(2)]}),n.jsx(se,{children:n.jsx(O,{label:e.status,color:de(e.status),size:"small"})}),n.jsx(se,{children:"cancelled"!==e.status&&n.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:1,mb:1},children:e.trackingNumber?n.jsxs(E,{variant:"body2",color:"text.secondary",children:["Tracking Number: ",e.trackingNumber]}):n.jsxs(n.Fragment,{children:[n.jsx(M,{size:"small",label:"Tracking Number",value:z[e.id]||"",onChange:t=>{return n=e.id,r=t.target.value,void q((e=>({...e,[n]:r})));var n,r},placeholder:"Enter tracking number (optional)",helperText:"Enter tracking number"}),n.jsx(v,{size:"small",variant:"outlined",onClick:()=>(async e=>{try{z[e]&&(await Wm.updateOrderTrackingNumber(e,z[e]),_(""))}catch(t){_("Failed to save tracking number. Please try again.")}})(e.id),disabled:!z[e.id],children:"Save Tracking Number"})]})})}),n.jsxs(se,{children:[n.jsx(w,{title:fe(e)?"":"Can only start processing after 10-minute cancellation window",placement:"top",children:n.jsx("span",{children:n.jsx(v,{size:"small",onClick:()=>he(e.id,"processing"),disabled:!fe(e),sx:{mr:1},children:"Start Processing"})})}),n.jsx(v,{size:"small",onClick:()=>he(e.id,"completed"),disabled:"completed"===e.status||"cancelled"===e.status,sx:{mr:1},children:"Mark Complete"}),n.jsx(v,{size:"small",color:"error",onClick:()=>he(e.id,"cancelled"),disabled:"completed"===e.status||"cancelled"===e.status,children:"Cancel"})]})]},e.id)))})]})})]}),1===d&&n.jsxs(n.Fragment,{children:[n.jsx(a,{sx:{mb:2},children:n.jsx(v,{variant:"contained",startIcon:n.jsx(Ie,{}),onClick:()=>G(),children:"Add Menu Item"})}),n.jsx(k,{container:!0,spacing:3,children:i.map((e=>n.jsx(k,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(j,{children:[n.jsxs(P,{children:[n.jsx(E,{variant:"h6",children:e.name}),n.jsx(E,{color:"textSecondary",children:e.description}),n.jsxs(E,{variant:"h6",children:["€",(e.price||0).toFixed(2)]}),e.addons&&e.addons.length>0&&n.jsxs(a,{sx:{mt:2},children:[n.jsx(E,{variant:"subtitle2",gutterBottom:!0,children:"Add-ons:"}),e.addons.map(((e,t)=>n.jsxs(E,{variant:"body2",color:e.isAvailable?"textPrimary":"text.disabled",children:[e.name," - €",e.price.toFixed(2),!e.isAvailable&&" (Disabled)"]},t)))]})]}),n.jsxs(a,{sx:{p:2},children:[n.jsx(y,{onClick:()=>G(e),children:n.jsx(Ae,{})}),n.jsx(y,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this item?"))try{await Wm.deleteFood(e)}catch(t){_("Failed to delete menu item. Please try again.")}})(e.id),children:n.jsx(Ce,{})})]})]})},e.id)))})]}),2===d&&n.jsx(Ig,{}),n.jsxs(H,{open:D,onClose:K,children:[n.jsx(Q,{children:R?"Edit Menu Item":"Add Menu Item"}),n.jsxs(Y,{children:[n.jsx(M,{fullWidth:!0,label:"Name",name:"name",value:F.name,onChange:J,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Description",name:"description",value:F.description,onChange:J,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Price",name:"price",type:"number",value:F.price,onChange:J,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Category",name:"category",value:F.category,onChange:J,margin:"normal"}),n.jsx(M,{fullWidth:!0,label:"Image Path",name:"imagePath",value:F.imagePath,onChange:J,margin:"normal"}),n.jsx(E,{variant:"h6",sx:{mt:3,mb:2},children:"Add-ons"}),n.jsxs(a,{sx:{display:"flex",gap:1,mb:2},children:[n.jsx(M,{label:"Add-on Name",value:V.name,onChange:e=>B((t=>({...t,name:e.target.value}))),size:"small"}),n.jsx(M,{label:"Price",type:"number",value:V.price,onChange:e=>B((t=>({...t,price:e.target.value}))),size:"small"}),n.jsx(v,{variant:"contained",onClick:()=>{V.name&&V.price&&(U((e=>({...e,addons:[...e.addons,{name:V.name,price:Number(V.price),isAvailable:!0}]}))),B({name:"",price:"",isAvailable:!0}))},children:"Add"})]}),n.jsx(a,{sx:{mb:2},children:F.addons.map(((e,t)=>n.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[n.jsxs(E,{sx:{flex:1},children:[e.name," - €",e.price.toFixed(2)]}),n.jsx(ae,{checked:e.isAvailable,onChange:()=>{U((e=>({...e,addons:e.addons.map(((e,n)=>n===t?{...e,isAvailable:!e.isAvailable}:e))})))}}),n.jsx(y,{size:"small",color:"error",onClick:()=>{U((e=>({...e,addons:e.addons.filter(((e,n)=>n!==t))})))},children:n.jsx(Ce,{})})]},t)))})]}),n.jsxs(X,{children:[n.jsx(v,{onClick:K,children:"Cancel"}),n.jsx(v,{onClick:async()=>{try{R?await Wm.updateFood(R.id,{...F,price:parseFloat(F.price)}):await Wm.addFood({...F,price:parseFloat(F.price),isAvailable:!0,addons:F.addons}),K()}catch(e){_("Failed to save menu item. Please try again.")}},variant:"contained",children:"Save"})]})]})]})})},Sg=()=>{const e=o();ct();const{user:t}=ht((e=>e.auth)),[i,s]=r.useState(!1),[c,l]=r.useState(null),[u,h]=r.useState(null),[d,f]=r.useState({name:"",phone:"",address:"",city:"",state:"",zipCode:""});r.useEffect((()=>{if(null==t?void 0:t.id){(async()=>{try{const e=await Wm.getUserProfile(t.id);e&&f({name:e.name||"",phone:e.phone||"",address:e.address||"",city:e.city||"",state:e.state||"",zipCode:e.zipCode||""})}catch(e){l("Failed to load user data")}})()}}),[t]);return t?n.jsxs(m,{maxWidth:"sm",children:[n.jsxs(a,{sx:{mt:4,mb:4},children:[n.jsx(E,{variant:"h4",component:"h1",gutterBottom:!0,children:"Profile"}),n.jsx(E,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Manage your account information"})]}),c&&n.jsx(C,{severity:"error",sx:{mb:2},children:c}),u&&n.jsx(C,{severity:"success",sx:{mb:2},children:u}),n.jsxs(a,{component:"form",onSubmit:async e=>{if(e.preventDefault(),null==t?void 0:t.id){s(!0),l(null),h(null);try{await Wm.updateUserProfile(t.id,d),h("Profile updated successfully")}catch(n){l("Failed to update profile")}finally{s(!1)}}},sx:{mt:3},children:[n.jsx(M,{fullWidth:!0,label:"Name",value:d.name,onChange:e=>f({...d,name:e.target.value}),margin:"normal",required:!0}),n.jsx(M,{fullWidth:!0,label:"Phone",value:d.phone,onChange:e=>f({...d,phone:e.target.value}),margin:"normal",required:!0}),n.jsx(M,{fullWidth:!0,label:"Address",value:d.address,onChange:e=>f({...d,address:e.target.value}),margin:"normal",required:!0}),n.jsx(M,{fullWidth:!0,label:"City",value:d.city,onChange:e=>f({...d,city:e.target.value}),margin:"normal",required:!0}),n.jsx(M,{fullWidth:!0,label:"Louth",value:d.state,onChange:e=>f({...d,state:e.target.value}),margin:"normal",required:!0}),n.jsx(M,{fullWidth:!0,label:"Eircode",value:d.zipCode,onChange:e=>f({...d,zipCode:e.target.value}),margin:"normal",required:!0}),n.jsxs(a,{sx:{mt:3,display:"flex",gap:2},children:[n.jsx(v,{type:"submit",variant:"contained",disabled:i,sx:{minWidth:120},children:i?n.jsx(S,{size:24}):"Save Changes"}),n.jsx(v,{variant:"outlined",onClick:()=>e("/"),disabled:i,children:"Cancel"})]})]})]}):n.jsx(m,{children:n.jsx(C,{severity:"error",sx:{mt:2},children:"Please log in to view your profile"})})},Cg=()=>n.jsx(m,{maxWidth:"md",children:n.jsx(a,{sx:{my:4},children:n.jsxs(A,{elevation:3,sx:{p:4},children:[n.jsx(E,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Terms and Conditions"}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"1. Introduction"}),n.jsx(E,{paragraph:!0,children:"Welcome to PuffinGood. By accessing or using our website and services, you agree to be bound by these Terms and Conditions."}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"2. Ordering and Payment"}),n.jsx(E,{paragraph:!0,children:"All orders are subject to availability and confirmation of the order price. Payment must be made at the time of ordering. We accept various payment methods as indicated on our checkout page."}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"3. Delivery"}),n.jsx(E,{paragraph:!0,children:"We aim to deliver your order within the timeframe specified during checkout. Delivery times may vary based on your location and other factors. Additional fees may apply for deliveries outside our standard delivery area."}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"4. Cancellations and Refunds"}),n.jsx(E,{paragraph:!0,children:"Orders may be cancelled within a reasonable time before preparation begins. Refunds will be processed according to our refund policy and may take 5-10 business days to appear in your account."}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"5. Privacy"}),n.jsx(E,{paragraph:!0,children:"Your privacy is important to us. Please review our Privacy Policy to understand how we collect, use, and protect your personal information."}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"6. Modifications"}),n.jsx(E,{paragraph:!0,children:"We reserve the right to modify these Terms and Conditions at any time. Changes will be effective immediately upon posting to the website."}),n.jsx(E,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"7. Contact Us"}),n.jsx(E,{paragraph:!0,children:"If you have any questions about these Terms and Conditions, please contact us through the contact information provided on our website."}),n.jsxs(E,{variant:"body2",sx:{mt:4,fontStyle:"italic"},children:["Last updated: ",(new Date).toLocaleDateString()]})]})})}),Ag=function(e){const t=function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{};let s=new mn;return t&&("boolean"==typeof t?s.push(hn):s.push(dn(t.extraArgument))),s},{reducer:n,middleware:r,devTools:i=!0,preloadedState:s,enhancers:o}=e||{};let a,c;if("function"==typeof n)a=n;else{if(!gt(n))throw new Error(Cn(1));a=vt(n)}c="function"==typeof r?r(t):t();let l=wt;i&&(l=fn({trace:!1,..."object"==typeof i&&i}));const u=function(...e){return t=>(n,r)=>{const i=t(n,r);let s=()=>{throw new Error(dt(15))};const o={getState:i.getState,dispatch:(e,...t)=>s(e,...t)},a=e.map((e=>e(o)));return s=wt(...a)(i.dispatch),{...i,dispatch:s}}}(...c),h=wn(u);return yt(a,s,l(..."function"==typeof o?o(h):h()))}({reducer:{auth:Pn,cart:rg}}),kg=he({palette:{primary:{main:"#6FCFCD"},secondary:{main:"#4ECDC4"},background:{default:"#F7F7F7",paper:"#FFFFFF"}},typography:{fontFamily:'"Poppins", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:600},h2:{fontWeight:600},h3:{fontWeight:600},h4:{fontWeight:600},h5:{fontWeight:600},h6:{fontWeight:600}},components:{MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:8}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"}}}}}),jg=de([{path:"/",element:n.jsx(On,{}),children:[{index:!0,element:n.jsx(Xm,{})},{path:"menu",element:n.jsx(ig,{})},{path:"cart",element:n.jsx(sg,{})},{path:"checkout",element:n.jsx(ug,{})},{path:"login",element:n.jsx(_g,{})},{path:"register",element:n.jsx(xg,{})},{path:"orders",element:n.jsx(Eg,{})},{path:"profile",element:n.jsx(Sg,{})},{path:"terms",element:n.jsx(Cg,{})}]},{path:"/admin",element:n.jsx(On,{}),children:[{path:"dashboard",element:n.jsx(Tg,{})},{index:!0,element:n.jsx(Tg,{})}]}],{basename:"/puffingood-frontend"});function Dg(){return n.jsx(nt,{store:Ag,children:n.jsxs(fe,{theme:kg,children:[n.jsx(pe,{}),n.jsx(me,{router:jg})]})})}const Ng=r.createContext({user:null,loading:!0}),Pg=({children:e})=>{const[t,i]=r.useState(null),[s,o]=r.useState(!0);return r.useEffect((()=>Vm.onAuthStateChanged((e=>{i(e),o(!1)}))),[]),n.jsx(Ng.Provider,{value:{user:t,loading:s},children:!s&&e})};xe.createRoot(document.getElementById("root")).render(n.jsx(ge.StrictMode,{children:n.jsx(Pg,{children:n.jsx(Dg,{})})}));
